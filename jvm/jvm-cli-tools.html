<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JVM å‘½ä»¤è¡Œå·¥å…· | JAVACORE</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/javacore/favicon.ico">
    <meta name="description" content="Java æ•™ç¨‹">
    
    <link rel="preload" href="/javacore/assets/css/0.styles.b629dfcc.css" as="style"><link rel="preload" href="/javacore/assets/js/app.62a93b3d.js" as="script"><link rel="preload" href="/javacore/assets/js/4.156ff030.js" as="script"><link rel="preload" href="/javacore/assets/js/64.67d22444.js" as="script"><link rel="preload" href="/javacore/assets/js/5.cb43ecfb.js" as="script"><link rel="prefetch" href="/javacore/assets/js/10.914d71f6.js"><link rel="prefetch" href="/javacore/assets/js/11.d42a0004.js"><link rel="prefetch" href="/javacore/assets/js/12.ebe9232a.js"><link rel="prefetch" href="/javacore/assets/js/13.5288142e.js"><link rel="prefetch" href="/javacore/assets/js/14.9d818b0a.js"><link rel="prefetch" href="/javacore/assets/js/15.b38fe602.js"><link rel="prefetch" href="/javacore/assets/js/16.5241809d.js"><link rel="prefetch" href="/javacore/assets/js/17.78168216.js"><link rel="prefetch" href="/javacore/assets/js/18.c92f16c4.js"><link rel="prefetch" href="/javacore/assets/js/19.099e9533.js"><link rel="prefetch" href="/javacore/assets/js/20.2a48e7e2.js"><link rel="prefetch" href="/javacore/assets/js/21.32368b62.js"><link rel="prefetch" href="/javacore/assets/js/22.5252e8af.js"><link rel="prefetch" href="/javacore/assets/js/23.24096651.js"><link rel="prefetch" href="/javacore/assets/js/24.86b4a663.js"><link rel="prefetch" href="/javacore/assets/js/25.59ab8bc9.js"><link rel="prefetch" href="/javacore/assets/js/26.0721512b.js"><link rel="prefetch" href="/javacore/assets/js/27.c4d59768.js"><link rel="prefetch" href="/javacore/assets/js/28.04551164.js"><link rel="prefetch" href="/javacore/assets/js/29.db12912f.js"><link rel="prefetch" href="/javacore/assets/js/30.0d802d5e.js"><link rel="prefetch" href="/javacore/assets/js/31.9963f4e9.js"><link rel="prefetch" href="/javacore/assets/js/32.fd822274.js"><link rel="prefetch" href="/javacore/assets/js/33.cbd2593d.js"><link rel="prefetch" href="/javacore/assets/js/34.67771b2b.js"><link rel="prefetch" href="/javacore/assets/js/35.fcd73a73.js"><link rel="prefetch" href="/javacore/assets/js/36.3c7702f7.js"><link rel="prefetch" href="/javacore/assets/js/37.b6845161.js"><link rel="prefetch" href="/javacore/assets/js/38.72a934f9.js"><link rel="prefetch" href="/javacore/assets/js/39.38104d31.js"><link rel="prefetch" href="/javacore/assets/js/40.09a7bf54.js"><link rel="prefetch" href="/javacore/assets/js/41.645609ce.js"><link rel="prefetch" href="/javacore/assets/js/42.ec4b0d8c.js"><link rel="prefetch" href="/javacore/assets/js/43.b1fa9ba2.js"><link rel="prefetch" href="/javacore/assets/js/44.fedde9b2.js"><link rel="prefetch" href="/javacore/assets/js/45.48adb696.js"><link rel="prefetch" href="/javacore/assets/js/46.13ace3f9.js"><link rel="prefetch" href="/javacore/assets/js/47.165b1fe4.js"><link rel="prefetch" href="/javacore/assets/js/48.d0429b0d.js"><link rel="prefetch" href="/javacore/assets/js/49.46309662.js"><link rel="prefetch" href="/javacore/assets/js/50.d5b30588.js"><link rel="prefetch" href="/javacore/assets/js/51.e77fd12c.js"><link rel="prefetch" href="/javacore/assets/js/52.46d67c4c.js"><link rel="prefetch" href="/javacore/assets/js/53.1e725d70.js"><link rel="prefetch" href="/javacore/assets/js/54.b9ef9b8e.js"><link rel="prefetch" href="/javacore/assets/js/55.e7b94782.js"><link rel="prefetch" href="/javacore/assets/js/56.3a8f1cf6.js"><link rel="prefetch" href="/javacore/assets/js/57.66e8a115.js"><link rel="prefetch" href="/javacore/assets/js/58.ee387dc3.js"><link rel="prefetch" href="/javacore/assets/js/59.3f67cc42.js"><link rel="prefetch" href="/javacore/assets/js/6.6edee210.js"><link rel="prefetch" href="/javacore/assets/js/60.bc134987.js"><link rel="prefetch" href="/javacore/assets/js/61.0672a9d0.js"><link rel="prefetch" href="/javacore/assets/js/62.e670038b.js"><link rel="prefetch" href="/javacore/assets/js/63.0080282f.js"><link rel="prefetch" href="/javacore/assets/js/65.a136cc8f.js"><link rel="prefetch" href="/javacore/assets/js/66.144da426.js"><link rel="prefetch" href="/javacore/assets/js/67.4959b85e.js"><link rel="prefetch" href="/javacore/assets/js/68.82ee0966.js"><link rel="prefetch" href="/javacore/assets/js/69.1032b73f.js"><link rel="prefetch" href="/javacore/assets/js/7.046e5a1b.js"><link rel="prefetch" href="/javacore/assets/js/8.77fb8967.js"><link rel="prefetch" href="/javacore/assets/js/9.ebfa537e.js"><link rel="prefetch" href="/javacore/assets/js/vendors~flowchart.20a64d45.js"><link rel="prefetch" href="/javacore/assets/js/vendors~notification.ea176280.js">
    <link rel="stylesheet" href="/javacore/assets/css/0.styles.b629dfcc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/javacore/" class="home-link router-link-active"><img src="https://raw.githubusercontent.com/dunwu/images/dev/common/dunwu-logo-200.png" alt="JAVACORE" class="logo"> <span class="site-name can-hide">JAVACORE</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/javacore/basics/" class="nav-link">
  åŸºç¡€ç‰¹æ€§
</a></div><div class="nav-item"><a href="/javacore/advanced/" class="nav-link">
  é«˜çº§ç‰¹æ€§
</a></div><div class="nav-item"><a href="/javacore/container/" class="nav-link">
  å®¹å™¨
</a></div><div class="nav-item"><a href="/javacore/io/" class="nav-link">
  IO
</a></div><div class="nav-item"><a href="/javacore/concurrent/" class="nav-link">
  å¹¶å‘
</a></div><div class="nav-item"><a href="/javacore/jvm/" class="nav-link router-link-active">
  JVM
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">âœ¨ Javaç³»åˆ—</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">âœ¨ Javaç³»åˆ—</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/java-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/javacore/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaCore æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/javatech/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaTech æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-boot-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Boot æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/dunwu/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ğŸ¯ åšå®¢
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/dunwu/javacore" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/javacore/basics/" class="nav-link">
  åŸºç¡€ç‰¹æ€§
</a></div><div class="nav-item"><a href="/javacore/advanced/" class="nav-link">
  é«˜çº§ç‰¹æ€§
</a></div><div class="nav-item"><a href="/javacore/container/" class="nav-link">
  å®¹å™¨
</a></div><div class="nav-item"><a href="/javacore/io/" class="nav-link">
  IO
</a></div><div class="nav-item"><a href="/javacore/concurrent/" class="nav-link">
  å¹¶å‘
</a></div><div class="nav-item"><a href="/javacore/jvm/" class="nav-link router-link-active">
  JVM
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">âœ¨ Javaç³»åˆ—</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">âœ¨ Javaç³»åˆ—</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/java-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/javacore/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaCore æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/javatech/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaTech æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-boot-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Boot æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/dunwu/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ğŸ¯ åšå®¢
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/dunwu/javacore" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>JVM å‘½ä»¤è¡Œå·¥å…·</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/javacore/jvm/jvm-cli-tools.html#_1-jps" class="sidebar-link">1. jps</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javacore/jvm/jvm-cli-tools.html#_1-1-jps-å‘½ä»¤ç”¨æ³•" class="sidebar-link">1.1. jps å‘½ä»¤ç”¨æ³•</a></li><li class="sidebar-sub-header"><a href="/javacore/jvm/jvm-cli-tools.html#_1-2-jps-ä½¿ç”¨ç¤ºä¾‹" class="sidebar-link">1.2. jps ä½¿ç”¨ç¤ºä¾‹</a></li></ul></li><li><a href="/javacore/jvm/jvm-cli-tools.html#_2-jstat" class="sidebar-link">2. jstat</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javacore/jvm/jvm-cli-tools.html#_2-1-jstat-å‘½ä»¤ç”¨æ³•" class="sidebar-link">2.1. jstat å‘½ä»¤ç”¨æ³•</a></li><li class="sidebar-sub-header"><a href="/javacore/jvm/jvm-cli-tools.html#_2-2-jstat-ä½¿ç”¨ç¤ºä¾‹" class="sidebar-link">2.2. jstat ä½¿ç”¨ç¤ºä¾‹</a></li></ul></li><li><a href="/javacore/jvm/jvm-cli-tools.html#_3-jmap" class="sidebar-link">3. jmap</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javacore/jvm/jvm-cli-tools.html#_3-1-jmap-å‘½ä»¤ç”¨æ³•" class="sidebar-link">3.1. jmap å‘½ä»¤ç”¨æ³•</a></li><li class="sidebar-sub-header"><a href="/javacore/jvm/jvm-cli-tools.html#_3-2-jstat-ä½¿ç”¨ç¤ºä¾‹" class="sidebar-link">3.2. jstat ä½¿ç”¨ç¤ºä¾‹</a></li></ul></li><li><a href="/javacore/jvm/jvm-cli-tools.html#_4-jstack" class="sidebar-link">4. jstack</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javacore/jvm/jvm-cli-tools.html#_4-1-jstack-å‘½ä»¤ç”¨æ³•" class="sidebar-link">4.1. jstack å‘½ä»¤ç”¨æ³•</a></li><li class="sidebar-sub-header"><a href="/javacore/jvm/jvm-cli-tools.html#_4-2-thread-dump-æ–‡ä»¶" class="sidebar-link">4.2. thread dump æ–‡ä»¶</a></li><li class="sidebar-sub-header"><a href="/javacore/jvm/jvm-cli-tools.html#_4-3-ç³»ç»Ÿçº¿ç¨‹çŠ¶æ€" class="sidebar-link">4.3. ç³»ç»Ÿçº¿ç¨‹çŠ¶æ€</a></li><li class="sidebar-sub-header"><a href="/javacore/jvm/jvm-cli-tools.html#_4-4-jstack-ä½¿ç”¨ç¤ºä¾‹" class="sidebar-link">4.4. jstack ä½¿ç”¨ç¤ºä¾‹</a></li></ul></li><li><a href="/javacore/jvm/jvm-cli-tools.html#_5-jinfo" class="sidebar-link">5. jinfo</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/javacore/jvm/jvm-cli-tools.html#_6-jhat" class="sidebar-link">6. jhat</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/javacore/jvm/jvm-cli-tools.html#_7-å‚è€ƒèµ„æ–™" class="sidebar-link">7. å‚è€ƒèµ„æ–™</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="jvm-å‘½ä»¤è¡Œå·¥å…·"><a href="#jvm-å‘½ä»¤è¡Œå·¥å…·" class="header-anchor">#</a> JVM å‘½ä»¤è¡Œå·¥å…·</h1> <blockquote><p>Java ç¨‹åºå‘˜å…ä¸äº†æ•…éšœæ’æŸ¥å·¥ä½œï¼Œæ‰€ä»¥ç»å¸¸éœ€è¦ä½¿ç”¨ä¸€äº› JVM å·¥å…·ã€‚</p> <p>JDK è‡ªå¸¦äº†ä¸€äº›å®ç”¨çš„å‘½ä»¤è¡Œå·¥å…·æ¥ç›‘æ§ã€åˆ†æ JVM ä¿¡æ¯ï¼ŒæŒæ¡å®ƒä»¬ï¼Œéå¸¸æœ‰åŠ©äº TroubleShootingã€‚</p></blockquote> <p>ä»¥ä¸‹æ˜¯è¾ƒå¸¸ç”¨çš„ JDK å‘½ä»¤è¡Œå·¥å…·ï¼š</p> <table><thead><tr><th>åç§°</th> <th>æè¿°</th></tr></thead> <tbody><tr><td><code>jps</code></td> <td>JVM è¿›ç¨‹çŠ¶æ€å·¥å…·ã€‚æ˜¾ç¤ºç³»ç»Ÿå†…çš„æ‰€æœ‰ JVM è¿›ç¨‹ã€‚</td></tr> <tr><td><code>jstat</code></td> <td>JVM ç»Ÿè®¡ç›‘æ§å·¥å…·ã€‚ç›‘æ§è™šæ‹Ÿæœºè¿è¡Œæ—¶çŠ¶æ€ä¿¡æ¯ï¼Œå®ƒå¯ä»¥æ˜¾ç¤ºå‡º JVM è¿›ç¨‹ä¸­çš„ç±»è£…è½½ã€å†…å­˜ã€GCã€JIT ç¼–è¯‘ç­‰è¿è¡Œæ•°æ®ã€‚</td></tr> <tr><td><code>jmap</code></td> <td>JVM å †å†…å­˜åˆ†æå·¥å…·ã€‚ç”¨äºæ‰“å° JVM è¿›ç¨‹å¯¹è±¡ç›´æ–¹å›¾ã€ç±»åŠ è½½ç»Ÿè®¡ã€‚å¹¶ä¸”å¯ä»¥ç”Ÿæˆå †è½¬å‚¨å¿«ç…§ï¼ˆä¸€èˆ¬ç§°ä¸º heapdump æˆ– dump æ–‡ä»¶ï¼‰ã€‚</td></tr> <tr><td><code>jstack</code></td> <td>JVM æ ˆæŸ¥çœ‹å·¥å…·ã€‚ç”¨äºæ‰“å° JVM è¿›ç¨‹çš„çº¿ç¨‹å’Œé”çš„æƒ…å†µã€‚å¹¶ä¸”å¯ä»¥ç”Ÿæˆçº¿ç¨‹å¿«ç…§ï¼ˆä¸€èˆ¬ç§°ä¸º threaddump æˆ– javacore æ–‡ä»¶ï¼‰ã€‚</td></tr> <tr><td><code>jhat</code></td> <td>ç”¨æ¥åˆ†æ jmap ç”Ÿæˆçš„ dump æ–‡ä»¶ã€‚</td></tr> <tr><td><code>jinfo</code></td> <td>JVM ä¿¡æ¯æŸ¥çœ‹å·¥å…·ã€‚ç”¨äºå®æ—¶æŸ¥çœ‹å’Œè°ƒæ•´ JVM è¿›ç¨‹å‚æ•°ã€‚</td></tr> <tr><td><code>jcmd</code></td> <td>JVM å‘½ä»¤è¡Œè°ƒè¯• å·¥å…·ã€‚ç”¨äºå‘ JVM è¿›ç¨‹å‘é€è°ƒè¯•å‘½ä»¤ã€‚</td></tr></tbody></table> <ul><li><a href="#1-jps">1. jps</a> <ul><li><a href="#11-jps-%E5%91%BD%E4%BB%A4%E7%94%A8%E6%B3%95">1.1. jps å‘½ä»¤ç”¨æ³•</a></li> <li><a href="#12-jps-%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B">1.2. jps ä½¿ç”¨ç¤ºä¾‹</a></li></ul></li> <li><a href="#2-jstat">2. jstat</a> <ul><li><a href="#21-jstat-%E5%91%BD%E4%BB%A4%E7%94%A8%E6%B3%95">2.1. jstat å‘½ä»¤ç”¨æ³•</a></li> <li><a href="#22-jstat-%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B">2.2. jstat ä½¿ç”¨ç¤ºä¾‹</a></li></ul></li> <li><a href="#3-jmap">3. jmap</a> <ul><li><a href="#31-jmap-%E5%91%BD%E4%BB%A4%E7%94%A8%E6%B3%95">3.1. jmap å‘½ä»¤ç”¨æ³•</a></li> <li><a href="#32-jstat-%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B">3.2. jstat ä½¿ç”¨ç¤ºä¾‹</a></li></ul></li> <li><a href="#4-jstack">4. jstack</a> <ul><li><a href="#41-jstack-%E5%91%BD%E4%BB%A4%E7%94%A8%E6%B3%95">4.1. jstack å‘½ä»¤ç”¨æ³•</a></li> <li><a href="#42-thread-dump-%E6%96%87%E4%BB%B6">4.2. thread dump æ–‡ä»¶</a></li> <li><a href="#43-%E7%B3%BB%E7%BB%9F%E7%BA%BF%E7%A8%8B%E7%8A%B6%E6%80%81">4.3. ç³»ç»Ÿçº¿ç¨‹çŠ¶æ€</a></li> <li><a href="#44-jstack-%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B">4.4. jstack ä½¿ç”¨ç¤ºä¾‹</a></li></ul></li> <li><a href="#5-jinfo">5. jinfo</a></li> <li><a href="#6-jhat">6. jhat</a></li> <li><a href="#7-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">7. å‚è€ƒèµ„æ–™</a></li></ul> <h2 id="_1-jps"><a href="#_1-jps" class="header-anchor">#</a> 1. jps</h2> <blockquote><p><strong><a href="https://docs.oracle.com/en/java/javase/11/tools/jps.html#GUID-6EB65B96-F9DD-4356-B825-6146E9EEC81E" target="_blank" rel="noopener noreferrer">jps(JVM Process Status Tool)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> æ˜¯è™šæ‹Ÿæœºè¿›ç¨‹çŠ¶æ€å·¥å…·</strong>ã€‚å®ƒå¯ä»¥æ˜¾ç¤ºæŒ‡å®šç³»ç»Ÿå†…æ‰€æœ‰çš„ HotSpot è™šæ‹Ÿæœºè¿›ç¨‹çŠ¶æ€ä¿¡æ¯ã€‚jps é€šè¿‡ RMI åè®®æŸ¥è¯¢å¼€å¯äº† RMI æœåŠ¡çš„è¿œç¨‹è™šæ‹Ÿæœºè¿›ç¨‹çŠ¶æ€ã€‚</p></blockquote> <h3 id="_1-1-jps-å‘½ä»¤ç”¨æ³•"><a href="#_1-1-jps-å‘½ä»¤ç”¨æ³•" class="header-anchor">#</a> 1.1. jps å‘½ä»¤ç”¨æ³•</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>jps <span class="token punctuation">[</span>option<span class="token punctuation">]</span> <span class="token punctuation">[</span>hostid<span class="token punctuation">]</span>
jps <span class="token punctuation">[</span>-help<span class="token punctuation">]</span>
</code></pre></div><p>å¦‚æœä¸æŒ‡å®š hostid å°±é»˜è®¤ä¸ºå½“å‰ä¸»æœºæˆ–æœåŠ¡å™¨ã€‚</p> <p>å¸¸ç”¨å‚æ•°ï¼š</p> <ul><li><code>option</code> - é€‰é¡¹å‚æ•°
<ul><li><code>-m</code> - è¾“å‡º JVM å¯åŠ¨æ—¶ä¼ é€’ç»™ main() çš„å‚æ•°ã€‚</li> <li><code>-l</code> - è¾“å‡ºä¸»ç±»çš„å…¨åï¼Œå¦‚æœè¿›ç¨‹æ‰§è¡Œçš„æ˜¯ jar åŒ…ï¼Œè¾“å‡º jar è·¯å¾„ã€‚</li> <li><code>-v</code> - æ˜¾ç¤ºä¼ é€’ç»™ JVM çš„å‚æ•°ã€‚</li> <li><code>-q</code> - ä»…è¾“å‡ºæœ¬åœ° JVM è¿›ç¨‹ IDã€‚</li> <li><code>-V</code> - ä»…è¾“å‡ºæœ¬åœ° JVM æ ‡è¯†ç¬¦ã€‚</li></ul></li> <li><code>hostid</code> - RMI æ³¨å†Œè¡¨ä¸­æ³¨å†Œçš„ä¸»æœºåã€‚å¦‚æœä¸æŒ‡å®š hostid å°±é»˜è®¤ä¸ºå½“å‰ä¸»æœºæˆ–æœåŠ¡å™¨ã€‚</li></ul> <p>å…¶ä¸­ <code>option</code>ã€<code>hostid</code> å‚æ•°ä¹Ÿå¯ä»¥ä¸å†™ã€‚</p> <h3 id="_1-2-jps-ä½¿ç”¨ç¤ºä¾‹"><a href="#_1-2-jps-ä½¿ç”¨ç¤ºä¾‹" class="header-anchor">#</a> 1.2. jps ä½¿ç”¨ç¤ºä¾‹</h3> <p>ã€ç¤ºä¾‹ã€‘åˆ—å‡ºæœ¬åœ° Java è¿›ç¨‹</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ jps
<span class="token number">18027</span> Java2Demo.JAR
<span class="token number">18032</span> jps
<span class="token number">18005</span> jstat
</code></pre></div><p>ã€ç¤ºä¾‹ã€‘åˆ—å‡ºæœ¬åœ° Java è¿›ç¨‹ ID</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ jps -q
<span class="token number">8841</span>
<span class="token number">1292</span>
<span class="token number">5398</span>
</code></pre></div><p>ã€ç¤ºä¾‹ã€‘åˆ—å‡ºæœ¬åœ° Java è¿›ç¨‹ IDï¼Œå¹¶è¾“å‡ºä¸»ç±»çš„å…¨åï¼Œå¦‚æœè¿›ç¨‹æ‰§è¡Œçš„æ˜¯ jar åŒ…ï¼Œè¾“å‡º jar è·¯å¾„</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ jps -l remote.domain
<span class="token number">3002</span> /opt/jdk1.7.0/demo/jfc/Java2D/Java2Demo.JAR
<span class="token number">2857</span> sun.tools.jstatd.jstatd
</code></pre></div><h2 id="_2-jstat"><a href="#_2-jstat" class="header-anchor">#</a> 2. jstat</h2> <blockquote><p><strong><a href="https://docs.oracle.com/en/java/javase/11/tools/jstat.html" target="_blank" rel="noopener noreferrer">jstat(JVM statistics Monitoring)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ï¼Œæ˜¯è™šæ‹Ÿæœºç»Ÿè®¡ä¿¡æ¯ç›‘è§†å·¥å…·</strong>ã€‚jstat ç”¨äºç›‘è§†è™šæ‹Ÿæœºè¿è¡Œæ—¶çŠ¶æ€ä¿¡æ¯ï¼Œå®ƒå¯ä»¥æ˜¾ç¤ºå‡ºè™šæ‹Ÿæœºè¿›ç¨‹ä¸­çš„ç±»è£…è½½ã€å†…å­˜ã€åƒåœ¾æ”¶é›†ã€JIT ç¼–è¯‘ç­‰è¿è¡Œæ•°æ®ã€‚</p></blockquote> <h3 id="_2-1-jstat-å‘½ä»¤ç”¨æ³•"><a href="#_2-1-jstat-å‘½ä»¤ç”¨æ³•" class="header-anchor">#</a> 2.1. jstat å‘½ä»¤ç”¨æ³•</h3> <p>å‘½ä»¤æ ¼å¼ï¼š</p> <div class="language-shell extra-class"><pre class="language-shell"><code>jstat <span class="token punctuation">[</span>option<span class="token punctuation">]</span> VMID <span class="token punctuation">[</span>interval<span class="token punctuation">]</span> <span class="token punctuation">[</span>count<span class="token punctuation">]</span>
</code></pre></div><p>å¸¸ç”¨å‚æ•°ï¼š</p> <ul><li><code>option</code> - é€‰é¡¹å‚æ•°ï¼Œç”¨äºæŒ‡å®šç”¨æˆ·éœ€è¦æŸ¥è¯¢çš„è™šæ‹Ÿæœºä¿¡æ¯
<ul><li><code>-class</code> - ç›‘è§†ç±»è£…è½½ã€å¸è½½æ•°é‡ã€æ€»ç©ºé—´ä»¥åŠç±»è£…è½½æ‰€è€—è´¹çš„æ—¶é—´</li> <li><code>-compiler</code>ï¼šæ˜¾ç¤º JIT ç¼–è¯‘çš„ç›¸å…³ä¿¡æ¯ï¼›</li> <li><code>-gc</code>ï¼šç›‘è§† Java å †çŠ¶å†µï¼ŒåŒ…æ‹¬ Eden åŒºã€ä¸¤ä¸ª survivor åŒºã€è€å¹´ä»£ã€æ°¸ä¹…ä»£ç­‰åŒºçš„å®¹é‡ã€å·²ç”¨ç©ºé—´ã€GC æ—¶é—´åˆè®¡ç­‰ä¿¡æ¯ã€‚</li> <li><code>-gccapacity</code>ï¼šæ˜¾ç¤ºå„ä¸ªä»£çš„å®¹é‡ä»¥åŠä½¿ç”¨æƒ…å†µï¼›</li> <li><code>-gcmetacapacity</code>ï¼šæ˜¾ç¤º Metaspace çš„å¤§å°ï¼›</li> <li><code>-gcnew</code>ï¼šæ˜¾ç¤ºæ–°ç”Ÿä»£ä¿¡æ¯ï¼›</li> <li><code>-gcnewcapacity</code>ï¼šæ˜¾ç¤ºæ–°ç”Ÿä»£å¤§å°å’Œä½¿ç”¨æƒ…å†µï¼›</li> <li><code>-gcold</code>ï¼šæ˜¾ç¤ºè€å¹´ä»£å’Œæ°¸ä¹…ä»£çš„ä¿¡æ¯ï¼›</li> <li><code>-gcoldcapacity</code>ï¼šæ˜¾ç¤ºè€å¹´ä»£çš„å¤§å°ï¼›</li> <li><code>-gcutil</code>ï¼šæ˜¾ç¤ºåƒåœ¾å›æ”¶ç»Ÿè®¡ä¿¡æ¯ï¼›</li> <li><code>-gccause</code>ï¼šæ˜¾ç¤ºåƒåœ¾å›æ”¶çš„ç›¸å…³ä¿¡æ¯ï¼ˆé€š -gcutilï¼‰ï¼ŒåŒæ—¶æ˜¾ç¤ºæœ€åä¸€æ¬¡æˆ–å½“å‰æ­£åœ¨å‘ç”Ÿçš„åƒåœ¾å›æ”¶çš„è¯±å› ï¼›</li> <li><code>-printcompilation</code>ï¼šè¾“å‡º JIT ç¼–è¯‘çš„æ–¹æ³•ä¿¡æ¯ã€‚</li></ul></li> <li><code>VMID</code> - å¦‚æœæ˜¯æœ¬åœ°è™šæ‹Ÿæœºè¿›ç¨‹ï¼Œåˆ™ VMID ä¸ LVMID æ˜¯ä¸€è‡´çš„ï¼›å¦‚æœæ˜¯è¿œç¨‹è™šæ‹Ÿæœºè¿›ç¨‹ï¼Œé‚£ VMID çš„æ ¼å¼åº”å½“æ˜¯ï¼š<code>[protocol:][//]lvmid[@hostname[:port]/servername]</code></li> <li><code>interval</code> - æŸ¥è¯¢é—´éš”</li> <li><code>count</code> - æŸ¥è¯¢æ¬¡æ•°</li></ul> <blockquote><p>ã€å‚è€ƒã€‘æ›´è¯¦ç»†è¯´æ˜å¯ä»¥å‚è€ƒï¼š<a href="https://www.cnblogs.com/yjd_hycf_space/p/7755633.html" target="_blank" rel="noopener noreferrer">jstat å‘½ä»¤æŸ¥çœ‹ jvm çš„ GC æƒ…å†µ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h3 id="_2-2-jstat-ä½¿ç”¨ç¤ºä¾‹"><a href="#_2-2-jstat-ä½¿ç”¨ç¤ºä¾‹" class="header-anchor">#</a> 2.2. jstat ä½¿ç”¨ç¤ºä¾‹</h3> <h4 id="ç±»åŠ è½½ç»Ÿè®¡"><a href="#ç±»åŠ è½½ç»Ÿè®¡" class="header-anchor">#</a> ç±»åŠ è½½ç»Ÿè®¡</h4> <p>ä½¿ç”¨ <code>jstat -class pid</code> å‘½ä»¤å¯ä»¥æŸ¥çœ‹ç¼–è¯‘ç»Ÿè®¡ä¿¡æ¯ã€‚</p> <p>ã€å‚æ•°ã€‘</p> <ul><li>Loaded - åŠ è½½ class çš„æ•°é‡</li> <li>Bytes - æ‰€å ç”¨ç©ºé—´å¤§å°</li> <li>Unloaded - æœªåŠ è½½æ•°é‡</li> <li>Bytes - æœªåŠ è½½å ç”¨ç©ºé—´</li> <li>Time - æ—¶é—´</li></ul> <p>ã€ç¤ºä¾‹ã€‘æŸ¥çœ‹ç±»åŠ è½½ä¿¡æ¯</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ jstat -class <span class="token number">7129</span>
Loaded  Bytes  Unloaded  Bytes     Time
 <span class="token number">26749</span> <span class="token number">50405.3</span>      <span class="token number">873</span>  <span class="token number">1216.8</span>      <span class="token number">19.75</span>
</code></pre></div><h4 id="ç¼–è¯‘ç»Ÿè®¡"><a href="#ç¼–è¯‘ç»Ÿè®¡" class="header-anchor">#</a> ç¼–è¯‘ç»Ÿè®¡</h4> <p>ä½¿ç”¨ <code>jstat -compiler pid</code> å‘½ä»¤å¯ä»¥æŸ¥çœ‹ç¼–è¯‘ç»Ÿè®¡ä¿¡æ¯ã€‚</p> <p>ã€ç¤ºä¾‹ã€‘</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ jstat -compiler <span class="token number">7129</span>
Compiled Failed Invalid   Time   FailedType FailedMethod
   <span class="token number">42030</span>      <span class="token number">2</span>       <span class="token number">0</span>   <span class="token number">302.53</span>          <span class="token number">1</span> org/apache/felix/framework/BundleWiringImpl<span class="token variable">$BundleClassLoader</span> findClass
</code></pre></div><p>ã€å‚æ•°ã€‘</p> <ul><li>Compiled - ç¼–è¯‘æ•°é‡</li> <li>Failed - å¤±è´¥æ•°é‡</li> <li>Invalid - ä¸å¯ç”¨æ•°é‡</li> <li>Time - æ—¶é—´</li> <li>FailedType - å¤±è´¥ç±»å‹</li> <li>FailedMethod - å¤±è´¥çš„æ–¹æ³•</li></ul> <h4 id="gc-ç»Ÿè®¡"><a href="#gc-ç»Ÿè®¡" class="header-anchor">#</a> GC ç»Ÿè®¡</h4> <p>ä½¿ç”¨ <code>jstat -gc pid time</code> å‘½ä»¤å¯ä»¥æŸ¥çœ‹ GC ç»Ÿè®¡ä¿¡æ¯ã€‚</p> <p>ã€ç¤ºä¾‹ã€‘ä»¥ 250 æ¯«ç§’çš„é—´éš”è¿›è¡Œ 7 ä¸ªé‡‡æ ·ï¼Œå¹¶æ˜¾ç¤º-gcutil é€‰é¡¹æŒ‡å®šçš„è¾“å‡ºã€‚</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ jstat -gcutil <span class="token number">21891</span> <span class="token number">250</span> <span class="token number">7</span>
  S0     S1     E      O      M     CCS    YGC     YGCT    FGC    FGCT     GCT
  <span class="token number">0.00</span>  <span class="token number">97.02</span>  <span class="token number">70.31</span>  <span class="token number">66.80</span>  <span class="token number">95.52</span>  <span class="token number">89.14</span>      <span class="token number">7</span>    <span class="token number">0.300</span>     <span class="token number">0</span>    <span class="token number">0.000</span>    <span class="token number">0.300</span>
  <span class="token number">0.00</span>  <span class="token number">97.02</span>  <span class="token number">86.23</span>  <span class="token number">66.80</span>  <span class="token number">95.52</span>  <span class="token number">89.14</span>      <span class="token number">7</span>    <span class="token number">0.300</span>     <span class="token number">0</span>    <span class="token number">0.000</span>    <span class="token number">0.300</span>
  <span class="token number">0.00</span>  <span class="token number">97.02</span>  <span class="token number">96.53</span>  <span class="token number">66.80</span>  <span class="token number">95.52</span>  <span class="token number">89.14</span>      <span class="token number">7</span>    <span class="token number">0.300</span>     <span class="token number">0</span>    <span class="token number">0.000</span>    <span class="token number">0.300</span>
 <span class="token number">91.03</span>   <span class="token number">0.00</span>   <span class="token number">1.98</span>  <span class="token number">68.19</span>  <span class="token number">95.89</span>  <span class="token number">91.24</span>      <span class="token number">8</span>    <span class="token number">0.378</span>     <span class="token number">0</span>    <span class="token number">0.000</span>    <span class="token number">0.378</span>
 <span class="token number">91.03</span>   <span class="token number">0.00</span>  <span class="token number">15.82</span>  <span class="token number">68.19</span>  <span class="token number">95.89</span>  <span class="token number">91.24</span>      <span class="token number">8</span>    <span class="token number">0.378</span>     <span class="token number">0</span>    <span class="token number">0.000</span>    <span class="token number">0.378</span>
 <span class="token number">91.03</span>   <span class="token number">0.00</span>  <span class="token number">17.80</span>  <span class="token number">68.19</span>  <span class="token number">95.89</span>  <span class="token number">91.24</span>      <span class="token number">8</span>    <span class="token number">0.378</span>     <span class="token number">0</span>    <span class="token number">0.000</span>    <span class="token number">0.378</span>
 <span class="token number">91.03</span>   <span class="token number">0.00</span>  <span class="token number">17.80</span>  <span class="token number">68.19</span>  <span class="token number">95.89</span>  <span class="token number">91.24</span>      <span class="token number">8</span>    <span class="token number">0.378</span>     <span class="token number">0</span>    <span class="token number">0.000</span>    <span class="token number">0.378</span>
</code></pre></div><p>ã€ç¤ºä¾‹ã€‘ä»¥ 1 ç§’çš„é—´éš”è¿›è¡Œ 4 ä¸ªé‡‡æ ·ï¼Œå¹¶æ˜¾ç¤º-gc é€‰é¡¹æŒ‡å®šçš„è¾“å‡ºã€‚</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ jstat -gc <span class="token number">25196</span> 1s <span class="token number">4</span>
 S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT     GCT
<span class="token number">20928.0</span> <span class="token number">20928.0</span>  <span class="token number">0.0</span>    <span class="token number">0.0</span>   <span class="token number">167936.0</span>  <span class="token number">8880.5</span>   <span class="token number">838912.0</span>   <span class="token number">80291.2</span>   <span class="token number">106668.0</span> <span class="token number">100032.1</span> <span class="token number">12772.0</span> <span class="token number">11602.2</span>    <span class="token number">760</span>   <span class="token number">14.332</span>  <span class="token number">580</span>   <span class="token number">656.218</span>  <span class="token number">670.550</span>
<span class="token number">20928.0</span> <span class="token number">20928.0</span>  <span class="token number">0.0</span>    <span class="token number">0.0</span>   <span class="token number">167936.0</span>  <span class="token number">8880.5</span>   <span class="token number">838912.0</span>   <span class="token number">80291.2</span>   <span class="token number">106668.0</span> <span class="token number">100032.1</span> <span class="token number">12772.0</span> <span class="token number">11602.2</span>    <span class="token number">760</span>   <span class="token number">14.332</span>  <span class="token number">580</span>   <span class="token number">656.218</span>  <span class="token number">670.550</span>
<span class="token number">20928.0</span> <span class="token number">20928.0</span>  <span class="token number">0.0</span>    <span class="token number">0.0</span>   <span class="token number">167936.0</span>  <span class="token number">8880.5</span>   <span class="token number">838912.0</span>   <span class="token number">80291.2</span>   <span class="token number">106668.0</span> <span class="token number">100032.1</span> <span class="token number">12772.0</span> <span class="token number">11602.2</span>    <span class="token number">760</span>   <span class="token number">14.332</span>  <span class="token number">580</span>   <span class="token number">656.218</span>  <span class="token number">670.550</span>
<span class="token number">20928.0</span> <span class="token number">20928.0</span>  <span class="token number">0.0</span>    <span class="token number">0.0</span>   <span class="token number">167936.0</span>  <span class="token number">8880.5</span>   <span class="token number">838912.0</span>   <span class="token number">80291.2</span>   <span class="token number">106668.0</span> <span class="token number">100032.1</span> <span class="token number">12772.0</span> <span class="token number">11602.2</span>    <span class="token number">760</span>   <span class="token number">14.332</span>  <span class="token number">580</span>   <span class="token number">656.218</span>  <span class="token number">670.550</span>
</code></pre></div><p>å‚æ•°è¯´æ˜ï¼š</p> <ul><li><code>S0C</code>ï¼šå¹´è½»ä»£ä¸­ To Survivor çš„å®¹é‡ï¼ˆå•ä½ KBï¼‰ï¼›</li> <li><code>S1C</code>ï¼šå¹´è½»ä»£ä¸­ From Survivor çš„å®¹é‡ï¼ˆå•ä½ KBï¼‰ï¼›</li> <li><code>S0U</code>ï¼šå¹´è½»ä»£ä¸­ To Survivor ç›®å‰å·²ä½¿ç”¨ç©ºé—´ï¼ˆå•ä½ KBï¼‰ï¼›</li> <li><code>S1U</code>ï¼šå¹´è½»ä»£ä¸­ From Survivor ç›®å‰å·²ä½¿ç”¨ç©ºé—´ï¼ˆå•ä½ KBï¼‰ï¼›</li> <li><code>EC</code>ï¼šå¹´è½»ä»£ä¸­ Eden çš„å®¹é‡ï¼ˆå•ä½ KBï¼‰ï¼›</li> <li><code>EU</code>ï¼šå¹´è½»ä»£ä¸­ Eden ç›®å‰å·²ä½¿ç”¨ç©ºé—´ï¼ˆå•ä½ KBï¼‰ï¼›</li> <li><code>OC</code>ï¼šOld ä»£çš„å®¹é‡ï¼ˆå•ä½ KBï¼‰ï¼›</li> <li><code>OU</code>ï¼šOld ä»£ç›®å‰å·²ä½¿ç”¨ç©ºé—´ï¼ˆå•ä½ KBï¼‰ï¼›</li> <li><code>MC</code>ï¼šMetaspace çš„å®¹é‡ï¼ˆå•ä½ KBï¼‰ï¼›</li> <li><code>MU</code>ï¼šMetaspace ç›®å‰å·²ä½¿ç”¨ç©ºé—´ï¼ˆå•ä½ KBï¼‰ï¼›</li> <li><code>YGC</code>ï¼šä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶å¹´è½»ä»£ä¸­ gc æ¬¡æ•°ï¼›</li> <li><code>YGCT</code>ï¼šä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶å¹´è½»ä»£ä¸­ gc æ‰€ç”¨æ—¶é—´ (s)ï¼›</li> <li><code>FGC</code>ï¼šä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶ old ä»£ï¼ˆå…¨ gcï¼‰gc æ¬¡æ•°ï¼›</li> <li><code>FGCT</code>ï¼šä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶ old ä»£ï¼ˆå…¨ gcï¼‰gc æ‰€ç”¨æ—¶é—´ (s)ï¼›</li> <li><code>GCT</code>ï¼šä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶ gc ç”¨çš„æ€»æ—¶é—´ (s)ã€‚</li></ul> <blockquote><p>æ³¨ï¼šæ›´è¯¦ç»†çš„å‚æ•°å«ä¹‰å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šhttp://docs.oracle.com/javase/8/docs/technotes/tools/unix/jstat.html</p></blockquote> <h2 id="_3-jmap"><a href="#_3-jmap" class="header-anchor">#</a> 3. jmap</h2> <blockquote><p><strong><a href="https://docs.oracle.com/en/java/javase/11/tools/jmap.html" target="_blank" rel="noopener noreferrer">jmap(JVM Memory Map)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> æ˜¯ Java å†…å­˜æ˜ åƒå·¥å…·</strong>ã€‚jmap ç”¨äºç”Ÿæˆå †è½¬å‚¨å¿«ç…§ï¼ˆä¸€èˆ¬ç§°ä¸º heapdump æˆ– dump æ–‡ä»¶ï¼‰ã€‚jmap ä¸ä»…èƒ½ç”Ÿæˆ dump æ–‡ä»¶ï¼Œè¿˜å¯ä»¥æŸ¥è¯¢ <code>finalize</code> æ‰§è¡Œé˜Ÿåˆ—ã€Java å †å’Œæ°¸ä¹…ä»£çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚å½“å‰ä½¿ç”¨ç‡ã€å½“å‰ä½¿ç”¨çš„æ˜¯å“ªç§æ”¶é›†å™¨ç­‰ã€‚</p> <p>å¦‚æœä¸ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ <code>-XX:+HeapDumpOnOutOfMemoryError</code> å‚æ•°æ¥è®©è™šæ‹Ÿæœºå‡ºç° OOM çš„æ—¶å€™ï¼Œè‡ªåŠ¨ç”Ÿæˆ dump æ–‡ä»¶ã€‚</p></blockquote> <h3 id="_3-1-jmap-å‘½ä»¤ç”¨æ³•"><a href="#_3-1-jmap-å‘½ä»¤ç”¨æ³•" class="header-anchor">#</a> 3.1. jmap å‘½ä»¤ç”¨æ³•</h3> <p>å‘½ä»¤æ ¼å¼ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>jmap [option] pid
</code></pre></div><p><code>option</code> é€‰é¡¹å‚æ•°ï¼š</p> <ul><li><code>-dump</code> - ç”Ÿæˆå †è½¬å‚¨å¿«ç…§ã€‚<code>-dump:live</code> åªä¿å­˜å †ä¸­çš„å­˜æ´»å¯¹è±¡ã€‚</li> <li><code>-finalizerinfo</code> - æ˜¾ç¤ºåœ¨ F-Queue é˜Ÿåˆ—ç­‰å¾…æ‰§è¡Œ <code>finalizer</code> æ–¹æ³•çš„å¯¹è±¡</li> <li><code>-heap</code> - æ˜¾ç¤º Java å †è¯¦ç»†ä¿¡æ¯ã€‚</li> <li><code>-histo</code> - æ˜¾ç¤ºå †ä¸­å¯¹è±¡çš„ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç±»ã€å®ä¾‹æ•°é‡ã€åˆè®¡å®¹é‡ã€‚<code>-histo:live</code> åªç»Ÿè®¡å †ä¸­çš„å­˜æ´»å¯¹è±¡ã€‚</li> <li><code>-permstat</code> - to print permanent generation statistics</li> <li><code>-F</code> - å½“-dump æ²¡æœ‰å“åº”æ—¶ï¼Œå¼ºåˆ¶ç”Ÿæˆ dump å¿«ç…§</li></ul> <h3 id="_3-2-jstat-ä½¿ç”¨ç¤ºä¾‹"><a href="#_3-2-jstat-ä½¿ç”¨ç¤ºä¾‹" class="header-anchor">#</a> 3.2. jstat ä½¿ç”¨ç¤ºä¾‹</h3> <h4 id="ç”Ÿæˆ-heapdump-å¿«ç…§"><a href="#ç”Ÿæˆ-heapdump-å¿«ç…§" class="header-anchor">#</a> ç”Ÿæˆ heapdump å¿«ç…§</h4> <p>dump å †åˆ°æ–‡ä»¶ï¼Œformat æŒ‡å®šè¾“å‡ºæ ¼å¼ï¼Œlive æŒ‡æ˜æ˜¯æ´»ç€çš„å¯¹è±¡ï¼Œfile æŒ‡å®šæ–‡ä»¶å</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ jmap -dump:live,format<span class="token operator">=</span>b,file<span class="token operator">=</span>dump.hprof <span class="token number">28920</span>
Dumping heap to /home/xxx/dump.hprof <span class="token punctuation">..</span>.
Heap dump <span class="token function">file</span> created
</code></pre></div><p>dump.hprof è¿™ä¸ªåç¼€æ˜¯ä¸ºäº†åç»­å¯ä»¥ç›´æ¥ç”¨ MAT(Memory Anlysis Tool)ç­‰å·¥å…·æ‰“å¼€ã€‚</p> <h4 id="æŸ¥çœ‹å®ä¾‹æ•°æœ€å¤šçš„ç±»"><a href="#æŸ¥çœ‹å®ä¾‹æ•°æœ€å¤šçš„ç±»" class="header-anchor">#</a> æŸ¥çœ‹å®ä¾‹æ•°æœ€å¤šçš„ç±»</h4> <div class="language-shell extra-class"><pre class="language-shell"><code>$ jmap -histo <span class="token number">29527</span> <span class="token operator">|</span> <span class="token function">head</span> -n <span class="token number">6</span>

 num     <span class="token comment">#instances         #bytes  class name</span>
----------------------------------------------
   <span class="token number">1</span>:      <span class="token number">13673280</span>     <span class="token number">1438961864</span>  <span class="token punctuation">[</span>C
   <span class="token number">2</span>:       <span class="token number">1207166</span>      <span class="token number">411277184</span>  <span class="token punctuation">[</span>I
   <span class="token number">3</span>:       <span class="token number">7382322</span>      <span class="token number">347307096</span>  <span class="token punctuation">[</span>Ljava.lang.Object<span class="token punctuation">;</span>
</code></pre></div><h4 id="æŸ¥çœ‹æŒ‡å®šè¿›ç¨‹çš„å †ä¿¡æ¯"><a href="#æŸ¥çœ‹æŒ‡å®šè¿›ç¨‹çš„å †ä¿¡æ¯" class="header-anchor">#</a> æŸ¥çœ‹æŒ‡å®šè¿›ç¨‹çš„å †ä¿¡æ¯</h4> <p>æ³¨æ„ï¼šä½¿ç”¨ CMS GC æƒ…å†µä¸‹ï¼Œ<code>jmap -heap PID</code> çš„æ‰§è¡Œæœ‰å¯èƒ½ä¼šå¯¼è‡´ java è¿›ç¨‹æŒ‚èµ·ã€‚</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ jmap -heap <span class="token number">12379</span>
Attaching to process ID <span class="token number">12379</span>, please wait<span class="token punctuation">..</span>.
Debugger attached successfully.
Server compiler detected.
JVM version is <span class="token number">17.0</span>-b16

using thread-local object allocation.
Parallel GC with <span class="token number">6</span> thread<span class="token punctuation">(</span>s<span class="token punctuation">)</span>

Heap Configuration:
   MinHeapFreeRatio <span class="token operator">=</span> <span class="token number">40</span>
   MaxHeapFreeRatio <span class="token operator">=</span> <span class="token number">70</span>
   MaxHeapSize      <span class="token operator">=</span> <span class="token number">83886080</span> <span class="token punctuation">(</span><span class="token number">80</span>.0MB<span class="token punctuation">)</span>
   NewSize          <span class="token operator">=</span> <span class="token number">1310720</span> <span class="token punctuation">(</span><span class="token number">1</span>.25MB<span class="token punctuation">)</span>
   MaxNewSize       <span class="token operator">=</span> <span class="token number">17592186044415</span> MB
   OldSize          <span class="token operator">=</span> <span class="token number">5439488</span> <span class="token punctuation">(</span><span class="token number">5</span>.1875MB<span class="token punctuation">)</span>
   NewRatio         <span class="token operator">=</span> <span class="token number">2</span>
   SurvivorRatio    <span class="token operator">=</span> <span class="token number">8</span>
   PermSize         <span class="token operator">=</span> <span class="token number">20971520</span> <span class="token punctuation">(</span><span class="token number">20</span>.0MB<span class="token punctuation">)</span>
   MaxPermSize      <span class="token operator">=</span> <span class="token number">88080384</span> <span class="token punctuation">(</span><span class="token number">84</span>.0MB<span class="token punctuation">)</span>

Heap Usage:
PS Young Generation
Eden Space:
   capacity <span class="token operator">=</span> <span class="token number">9306112</span> <span class="token punctuation">(</span><span class="token number">8</span>.875MB<span class="token punctuation">)</span>
   used     <span class="token operator">=</span> <span class="token number">5375360</span> <span class="token punctuation">(</span><span class="token number">5</span>.1263427734375MB<span class="token punctuation">)</span>
   <span class="token function">free</span>     <span class="token operator">=</span> <span class="token number">3930752</span> <span class="token punctuation">(</span><span class="token number">3</span>.7486572265625MB<span class="token punctuation">)</span>
   <span class="token number">57.761608714788736</span>% used
From Space:
   capacity <span class="token operator">=</span> <span class="token number">9306112</span> <span class="token punctuation">(</span><span class="token number">8</span>.875MB<span class="token punctuation">)</span>
   used     <span class="token operator">=</span> <span class="token number">3425240</span> <span class="token punctuation">(</span><span class="token number">3</span>.2665634155273438MB<span class="token punctuation">)</span>
   <span class="token function">free</span>     <span class="token operator">=</span> <span class="token number">5880872</span> <span class="token punctuation">(</span><span class="token number">5</span>.608436584472656MB<span class="token punctuation">)</span>
   <span class="token number">36.80634834397007</span>% used
To Space:
   capacity <span class="token operator">=</span> <span class="token number">9306112</span> <span class="token punctuation">(</span><span class="token number">8</span>.875MB<span class="token punctuation">)</span>
   used     <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0</span>.0MB<span class="token punctuation">)</span>
   <span class="token function">free</span>     <span class="token operator">=</span> <span class="token number">9306112</span> <span class="token punctuation">(</span><span class="token number">8</span>.875MB<span class="token punctuation">)</span>
   <span class="token number">0.0</span>% used
PS Old Generation
   capacity <span class="token operator">=</span> <span class="token number">55967744</span> <span class="token punctuation">(</span><span class="token number">53</span>.375MB<span class="token punctuation">)</span>
   used     <span class="token operator">=</span> <span class="token number">48354640</span> <span class="token punctuation">(</span><span class="token number">46</span>.11457824707031MB<span class="token punctuation">)</span>
   <span class="token function">free</span>     <span class="token operator">=</span> <span class="token number">7613104</span> <span class="token punctuation">(</span><span class="token number">7</span>.2604217529296875MB<span class="token punctuation">)</span>
   <span class="token number">86.39733629427693</span>% used
PS Perm Generation
   capacity <span class="token operator">=</span> <span class="token number">62062592</span> <span class="token punctuation">(</span><span class="token number">59</span>.1875MB<span class="token punctuation">)</span>
   used     <span class="token operator">=</span> <span class="token number">60243112</span> <span class="token punctuation">(</span><span class="token number">57</span>.452308654785156MB<span class="token punctuation">)</span>
   <span class="token function">free</span>     <span class="token operator">=</span> <span class="token number">1819480</span> <span class="token punctuation">(</span><span class="token number">1</span>.7351913452148438MB<span class="token punctuation">)</span>
   <span class="token number">97.06831451706046</span>% used
</code></pre></div><h2 id="_4-jstack"><a href="#_4-jstack" class="header-anchor">#</a> 4. jstack</h2> <blockquote><p><strong><a href="https://docs.oracle.com/en/java/javase/11/tools/jstack.html" target="_blank" rel="noopener noreferrer">jstack(Stack Trace for java)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> æ˜¯ Java å †æ ˆè·Ÿè¸ªå·¥å…·</strong>ã€‚jstack ç”¨æ¥æ‰“å°ç›®æ ‡ Java è¿›ç¨‹ä¸­å„ä¸ªçº¿ç¨‹çš„æ ˆè½¨è¿¹ï¼Œä»¥åŠè¿™äº›çº¿ç¨‹æ‰€æŒæœ‰çš„é”ï¼Œå¹¶å¯ä»¥ç”Ÿæˆ java è™šæ‹Ÿæœºå½“å‰æ—¶åˆ»çš„çº¿ç¨‹å¿«ç…§ï¼ˆä¸€èˆ¬ç§°ä¸º threaddump æˆ– javacore æ–‡ä»¶ï¼‰ã€‚</p> <p><strong>çº¿ç¨‹å¿«ç…§æ˜¯å½“å‰è™šæ‹Ÿæœºå†…æ¯ä¸€æ¡çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•å †æ ˆçš„é›†åˆï¼Œç”Ÿæˆçº¿ç¨‹å¿«ç…§çš„ä¸»è¦ç›®çš„æ˜¯å®šä½çº¿ç¨‹å‡ºç°é•¿æ—¶é—´åœé¡¿çš„åŸå› ï¼Œå¦‚çº¿ç¨‹é—´æ­»é”ã€æ­»å¾ªç¯ã€è¯·æ±‚å¤–éƒ¨èµ„æºå¯¼è‡´çš„é•¿æ—¶é—´ç­‰å¾…ç­‰</strong>ã€‚</p></blockquote> <p><code>jstack</code> é€šå¸¸ä¼šç»“åˆ <code>top -Hp pid</code> æˆ– <code>pidstat -p pid -t</code> ä¸€èµ·æŸ¥çœ‹å…·ä½“çº¿ç¨‹çš„çŠ¶æ€ï¼Œä¹Ÿç»å¸¸ç”¨æ¥æ’æŸ¥ä¸€äº›æ­»é”çš„å¼‚å¸¸ã€‚</p> <p>çº¿ç¨‹å‡ºç°åœé¡¿çš„æ—¶å€™é€šè¿‡ jstack æ¥æŸ¥çœ‹å„ä¸ªçº¿ç¨‹çš„è°ƒç”¨å †æ ˆï¼Œå°±å¯ä»¥çŸ¥é“æ²¡æœ‰å“åº”çš„çº¿ç¨‹åˆ°åº•åœ¨åå°åšä»€ä¹ˆäº‹æƒ…ï¼Œæˆ–è€…ç­‰å¾…ä»€ä¹ˆèµ„æºã€‚ å¦‚æœ java ç¨‹åºå´©æºƒç”Ÿæˆ core æ–‡ä»¶ï¼Œjstack å·¥å…·å¯ä»¥ç”¨æ¥è·å¾— core æ–‡ä»¶çš„ java stack å’Œ native stack çš„ä¿¡æ¯ï¼Œä»è€Œå¯ä»¥è½»æ¾åœ°çŸ¥é“ java ç¨‹åºæ˜¯å¦‚ä½•å´©æºƒå’Œåœ¨ç¨‹åºä½•å¤„å‘ç”Ÿé—®é¢˜ã€‚å¦å¤–ï¼Œjstack å·¥å…·è¿˜å¯ä»¥é™„å±åˆ°æ­£åœ¨è¿è¡Œçš„ java ç¨‹åºä¸­ï¼Œçœ‹åˆ°å½“æ—¶è¿è¡Œçš„ java ç¨‹åºçš„ java stack å’Œ native stack çš„ä¿¡æ¯, å¦‚æœç°åœ¨è¿è¡Œçš„ java ç¨‹åºå‘ˆç° hung çš„çŠ¶æ€ï¼Œjstack æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚</p> <h3 id="_4-1-jstack-å‘½ä»¤ç”¨æ³•"><a href="#_4-1-jstack-å‘½ä»¤ç”¨æ³•" class="header-anchor">#</a> 4.1. jstack å‘½ä»¤ç”¨æ³•</h3> <p>å‘½ä»¤æ ¼å¼ï¼š</p> <div class="language-shell extra-class"><pre class="language-shell"><code>jstack <span class="token punctuation">[</span>option<span class="token punctuation">]</span> pid
</code></pre></div><p><code>option</code> é€‰é¡¹å‚æ•°</p> <ul><li><code>-F</code> - å½“æ­£å¸¸è¾“å‡ºè¯·æ±‚ä¸è¢«å“åº”æ—¶ï¼Œå¼ºåˆ¶è¾“å‡ºçº¿ç¨‹å †æ ˆ</li> <li><code>-l</code> - é™¤å †æ ˆå¤–ï¼Œæ˜¾ç¤ºå…³äºé”çš„é™„åŠ ä¿¡æ¯</li> <li><code>-m</code> - æ‰“å° java å’Œ jni æ¡†æ¶çš„æ‰€æœ‰æ ˆä¿¡æ¯</li></ul> <h3 id="_4-2-thread-dump-æ–‡ä»¶"><a href="#_4-2-thread-dump-æ–‡ä»¶" class="header-anchor">#</a> 4.2. thread dump æ–‡ä»¶</h3> <p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20200730112431.png" alt="img"></p> <p>ä¸€ä¸ª Thread Dump æ–‡ä»¶å¤§è‡´å¯ä»¥åˆ†ä¸ºäº”ä¸ªéƒ¨åˆ†ã€‚</p> <h4 id="ç¬¬ä¸€éƒ¨åˆ†-full-thread-dump-identifier"><a href="#ç¬¬ä¸€éƒ¨åˆ†-full-thread-dump-identifier" class="header-anchor">#</a> ç¬¬ä¸€éƒ¨åˆ†ï¼šFull thread dump identifier</h4> <p>è¿™ä¸€éƒ¨åˆ†æ˜¯å†…å®¹æœ€å¼€å§‹çš„éƒ¨åˆ†ï¼Œå±•ç¤ºäº†å¿«ç…§æ–‡ä»¶çš„ç”Ÿæˆæ—¶é—´å’Œ JVM çš„ç‰ˆæœ¬ä¿¡æ¯ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>2017-10-19 10:46:44
Full thread dump Java HotSpot(TM) 64-Bit Server VM (24.79-b02 mixed mode):
</code></pre></div><h4 id="ç¬¬äºŒéƒ¨åˆ†-java-ee-middleware-third-party-custom-application-threads"><a href="#ç¬¬äºŒéƒ¨åˆ†-java-ee-middleware-third-party-custom-application-threads" class="header-anchor">#</a> ç¬¬äºŒéƒ¨åˆ†ï¼šJava EE middleware, third party &amp; custom application Threads</h4> <p>è¿™æ˜¯æ•´ä¸ªæ–‡ä»¶çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œé‡Œé¢å±•ç¤ºäº† JavaEE å®¹å™¨ï¼ˆå¦‚ tomcatã€resin ç­‰ï¼‰ã€è‡ªå·±çš„ç¨‹åºä¸­æ‰€ä½¿ç”¨çš„çº¿ç¨‹ä¿¡æ¯ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>&quot;resin-22129&quot; daemon prio=10 tid=0x00007fbe5c34e000 nid=0x4cb1 waiting on condition [0x00007fbe4ff7c000]
   java.lang.Thread.State: WAITING (parking)
    at sun.misc.Unsafe.park(Native Method)
    at java.util.concurrent.locks.LockSupport.park(LockSupport.java:315)
    at com.caucho.env.thread2.ResinThread2.park(ResinThread2.java:196)
    at com.caucho.env.thread2.ResinThread2.runTasks(ResinThread2.java:147)
    at com.caucho.env.thread2.ResinThread2.run(ResinThread2.java:118)
</code></pre></div><p>å‚æ•°è¯´æ˜ï¼š</p> <ul><li><code>&quot;resin-22129&quot;</code> **çº¿ç¨‹åç§°ï¼š**å¦‚æœä½¿ç”¨ java.lang.Thread ç±»ç”Ÿæˆä¸€ä¸ªçº¿ç¨‹çš„æ—¶å€™ï¼Œçº¿ç¨‹åç§°ä¸º Thread-(æ•°å­—) çš„å½¢å¼ï¼Œè¿™é‡Œæ˜¯ resin ç”Ÿæˆçš„çº¿ç¨‹ï¼›</li> <li><code>daemon</code> **çº¿ç¨‹ç±»å‹ï¼š**çº¿ç¨‹åˆ†ä¸ºå®ˆæŠ¤çº¿ç¨‹ (daemon) å’Œéå®ˆæŠ¤çº¿ç¨‹ (non-daemon) ä¸¤ç§ï¼Œé€šå¸¸éƒ½æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼›</li> <li><code>prio=10</code> **çº¿ç¨‹ä¼˜å…ˆçº§ï¼š**é»˜è®¤ä¸º 5ï¼Œæ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼›</li> <li><code>tid=0x00007fbe5c34e000</code> **JVM çº¿ç¨‹çš„ idï¼š**JVM å†…éƒ¨çº¿ç¨‹çš„å”¯ä¸€æ ‡è¯†ï¼Œé€šè¿‡ java.lang.Thread.getId()è·å–ï¼Œé€šå¸¸ç”¨è‡ªå¢çš„æ–¹å¼å®ç°ï¼›</li> <li><code>nid=0x4cb1</code> **ç³»ç»Ÿçº¿ç¨‹ idï¼š**å¯¹åº”çš„ç³»ç»Ÿçº¿ç¨‹ idï¼ˆNative Thread ID)ï¼Œå¯ä»¥é€šè¿‡ top å‘½ä»¤è¿›è¡ŒæŸ¥çœ‹ï¼Œç°åœº id æ˜¯åå…­è¿›åˆ¶çš„å½¢å¼ï¼›</li> <li><code>waiting on condition</code> **ç³»ç»Ÿçº¿ç¨‹çŠ¶æ€ï¼š**è¿™é‡Œæ˜¯ç³»ç»Ÿçš„çº¿ç¨‹çŠ¶æ€ï¼›</li> <li><code>[0x00007fbe4ff7c000]</code> **èµ·å§‹æ ˆåœ°å€ï¼š**çº¿ç¨‹å †æ ˆè°ƒç”¨çš„å…¶å®å†…å­˜åœ°å€ï¼›</li> <li><code>java.lang.Thread.State: WAITING (parking)</code> **JVM çº¿ç¨‹çŠ¶æ€ï¼š**è¿™é‡Œæ ‡æ˜äº†çº¿ç¨‹åœ¨ä»£ç çº§åˆ«çš„çŠ¶æ€ã€‚</li> <li>**çº¿ç¨‹è°ƒç”¨æ ˆä¿¡æ¯ï¼š**ä¸‹é¢å°±æ˜¯å½“å‰çº¿ç¨‹è°ƒç”¨çš„è¯¦ç»†æ ˆä¿¡æ¯ï¼Œç”¨äºä»£ç çš„åˆ†æã€‚å †æ ˆä¿¡æ¯åº”è¯¥ä»ä¸‹å‘ä¸Šè§£è¯»ï¼Œå› ä¸ºç¨‹åºè°ƒç”¨çš„é¡ºåºæ˜¯ä»ä¸‹å‘ä¸Šçš„ã€‚</li></ul> <h4 id="ç¬¬ä¸‰éƒ¨åˆ†-hotspot-vm-thread"><a href="#ç¬¬ä¸‰éƒ¨åˆ†-hotspot-vm-thread" class="header-anchor">#</a> ç¬¬ä¸‰éƒ¨åˆ†ï¼šHotSpot VM Thread</h4> <p>è¿™ä¸€éƒ¨åˆ†å±•ç¤ºäº† JVM å†…éƒ¨çº¿ç¨‹çš„ä¿¡æ¯ï¼Œç”¨äºæ‰§è¡Œå†…éƒ¨çš„åŸç”Ÿæ“ä½œã€‚ä¸‹é¢å¸¸è§çš„é›†ä¸­å†…ç½®çº¿ç¨‹ï¼š</p> <h5 id="attach-listener"><a href="#attach-listener" class="header-anchor">#</a> &quot;Attach Listener&quot;</h5> <p>è¯¥çº¿ç¨‹è´Ÿè´£æ¥æ”¶å¤–éƒ¨å‘½ä»¤ï¼Œæ‰§è¡Œè¯¥å‘½ä»¤å¹¶æŠŠç»“æœè¿”å›ç»™è°ƒç”¨è€…ï¼Œæ­¤ç§ç±»å‹çš„çº¿ç¨‹é€šå¸¸åœ¨æ¡Œé¢ç¨‹åºä¸­å‡ºç°ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>&quot;Attach Listener&quot; daemon prio=5 tid=0x00007fc6b6800800 nid=0x3b07 waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE
</code></pre></div><h5 id="destroyjavavm"><a href="#destroyjavavm" class="header-anchor">#</a> &quot;DestroyJavaVM&quot;</h5> <p>æ‰§è¡Œ <code>main()</code> çš„çº¿ç¨‹åœ¨æ‰§è¡Œå®Œä¹‹åè°ƒç”¨ JNI ä¸­çš„ <code>jni_DestroyJavaVM()</code> æ–¹æ³•ä¼šå”¤èµ· <code>DestroyJavaVM</code> çº¿ç¨‹ï¼Œå¤„äºç­‰å¾…çŠ¶æ€ï¼Œç­‰å¾…å…¶å®ƒçº¿ç¨‹ï¼ˆjava çº¿ç¨‹å’Œ native çº¿ç¨‹ï¼‰é€€å‡ºæ—¶é€šçŸ¥å®ƒå¸è½½ JVMã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>&quot;DestroyJavaVM&quot; prio=5 tid=0x00007fc6b3001000 nid=0x1903 waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE
</code></pre></div><h5 id="service-thread"><a href="#service-thread" class="header-anchor">#</a> &quot;Service Thread&quot;</h5> <p>ç”¨äºå¯åŠ¨æœåŠ¡çš„çº¿ç¨‹</p> <div class="language- extra-class"><pre class="language-text"><code>&quot;Service Thread&quot; daemon prio=10 tid=0x00007fbea81b3000 nid=0x5f2 runnable [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE
</code></pre></div><h5 id="compilerthread"><a href="#compilerthread" class="header-anchor">#</a> &quot;CompilerThread&quot;</h5> <p>ç”¨æ¥è°ƒç”¨ JITingï¼Œå®æ—¶ç¼–è¯‘è£…å¸ç±»ã€‚é€šå¸¸ JVM ä¼šå¯åŠ¨å¤šä¸ªçº¿ç¨‹æ¥å¤„ç†è¿™éƒ¨åˆ†å·¥ä½œï¼Œçº¿ç¨‹åç§°åé¢çš„æ•°å­—ä¹Ÿä¼šç´¯åŠ ï¼Œæ¯”å¦‚ CompilerThread1ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>&quot;C2 CompilerThread1&quot; daemon prio=10 tid=0x00007fbea814b000 nid=0x5f1 waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

&quot;C2 CompilerThread0&quot; daemon prio=10 tid=0x00007fbea8142000 nid=0x5f0 waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE
</code></pre></div><h5 id="signal-dispatcher"><a href="#signal-dispatcher" class="header-anchor">#</a> &quot;Signal Dispatcher&quot;</h5> <p>Attach Listener çº¿ç¨‹çš„èŒè´£æ˜¯æ¥æ”¶å¤–éƒ¨ jvm å‘½ä»¤ï¼Œå½“å‘½ä»¤æ¥æ”¶æˆåŠŸåï¼Œä¼šäº¤ç»™ signal dispather çº¿ç¨‹å»è¿›è¡Œåˆ†å‘åˆ°å„ä¸ªä¸åŒçš„æ¨¡å—å¤„ç†å‘½ä»¤ï¼Œå¹¶ä¸”è¿”å›å¤„ç†ç»“æœã€‚
signal dispather çº¿ç¨‹ä¹Ÿæ˜¯åœ¨ç¬¬ä¸€æ¬¡æ¥æ”¶å¤–éƒ¨ jvm å‘½ä»¤æ—¶ï¼Œè¿›è¡Œåˆå§‹åŒ–å·¥ä½œã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>&quot;Signal Dispatcher&quot; daemon prio=10 tid=0x00007fbea81bf800 nid=0x5ef runnable [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE
</code></pre></div><h5 id="finalizer"><a href="#finalizer" class="header-anchor">#</a> &quot;Finalizer&quot;</h5> <p>è¿™ä¸ªçº¿ç¨‹ä¹Ÿæ˜¯åœ¨ main çº¿ç¨‹ä¹‹ååˆ›å»ºçš„ï¼Œå…¶ä¼˜å…ˆçº§ä¸º 10ï¼Œä¸»è¦ç”¨äºåœ¨åƒåœ¾æ”¶é›†å‰ï¼Œè°ƒç”¨å¯¹è±¡çš„ <code>finalize()</code> æ–¹æ³•ï¼›å…³äº Finalizer çº¿ç¨‹çš„å‡ ç‚¹ï¼š</p> <ul><li>åªæœ‰å½“å¼€å§‹ä¸€è½®åƒåœ¾æ”¶é›†æ—¶ï¼Œæ‰ä¼šå¼€å§‹è°ƒç”¨ finalize()æ–¹æ³•ï¼›å› æ­¤å¹¶ä¸æ˜¯æ‰€æœ‰å¯¹è±¡çš„ finalize()æ–¹æ³•éƒ½ä¼šè¢«æ‰§è¡Œï¼›</li> <li>è¯¥çº¿ç¨‹ä¹Ÿæ˜¯ daemon çº¿ç¨‹ï¼Œå› æ­¤å¦‚æœè™šæ‹Ÿæœºä¸­æ²¡æœ‰å…¶ä»–é daemon çº¿ç¨‹ï¼Œä¸ç®¡è¯¥çº¿ç¨‹æœ‰æ²¡æœ‰æ‰§è¡Œå®Œ finalize()æ–¹æ³•ï¼ŒJVM ä¹Ÿä¼šé€€å‡ºï¼›</li> <li>JVM åœ¨åƒåœ¾æ”¶é›†æ—¶ä¼šå°†å¤±å»å¼•ç”¨çš„å¯¹è±¡åŒ…è£…æˆ Finalizer å¯¹è±¡ï¼ˆReference çš„å®ç°ï¼‰ï¼Œå¹¶æ”¾å…¥ ReferenceQueueï¼Œç”± Finalizer çº¿ç¨‹æ¥å¤„ç†ï¼›æœ€åå°†è¯¥ Finalizer å¯¹è±¡çš„å¼•ç”¨ç½®ä¸º nullï¼Œç”±åƒåœ¾æ”¶é›†å™¨æ¥å›æ”¶ï¼›</li></ul> <p>JVM ä¸ºä»€ä¹ˆè¦å•ç‹¬ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œ <code>finalize()</code> æ–¹æ³•å‘¢ï¼Ÿ</p> <p>å¦‚æœ JVM çš„åƒåœ¾æ”¶é›†çº¿ç¨‹è‡ªå·±æ¥åšï¼Œå¾ˆæœ‰å¯èƒ½ç”±äºåœ¨ finalize()æ–¹æ³•ä¸­è¯¯æ“ä½œå¯¼è‡´ GC çº¿ç¨‹åœæ­¢æˆ–ä¸å¯æ§ï¼Œè¿™å¯¹ GC çº¿ç¨‹æ¥è¯´æ˜¯ä¸€ç§ç¾éš¾ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>&quot;Finalizer&quot; daemon prio=10 tid=0x00007fbea80da000 nid=0x5eb in Object.wait() [0x00007fbeac044000]
   java.lang.Thread.State: WAITING (on object monitor)
    at java.lang.Object.wait(Native Method)
    at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:135)
    - locked &lt;0x00000006d173c1a8&gt; (a java.lang.ref.ReferenceQueue$Lock)
    at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:151)
    at java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:209)
</code></pre></div><h5 id="reference-handler"><a href="#reference-handler" class="header-anchor">#</a> &quot;Reference Handler&quot;</h5> <p>JVM åœ¨åˆ›å»º main çº¿ç¨‹åå°±åˆ›å»º Reference Handler çº¿ç¨‹ï¼Œå…¶ä¼˜å…ˆçº§æœ€é«˜ï¼Œä¸º 10ï¼Œå®ƒä¸»è¦ç”¨äºå¤„ç†å¼•ç”¨å¯¹è±¡æœ¬èº«ï¼ˆè½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨ï¼‰çš„åƒåœ¾å›æ”¶é—®é¢˜ ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>&quot;Reference Handler&quot; daemon prio=10 tid=0x00007fbea80d8000 nid=0x5ea in Object.wait() [0x00007fbeac085000]
   java.lang.Thread.State: WAITING (on object monitor)
    at java.lang.Object.wait(Native Method)
    at java.lang.Object.wait(Object.java:503)
    at java.lang.ref.Reference$ReferenceHandler.run(Reference.java:133)
    - locked &lt;0x00000006d173c1f0&gt; (a java.lang.ref.Reference$Lock)
</code></pre></div><h5 id="vm-thread"><a href="#vm-thread" class="header-anchor">#</a> &quot;VM Thread&quot;</h5> <p>JVM ä¸­çº¿ç¨‹çš„æ¯ä½“ï¼Œæ ¹æ® HotSpot æºç ä¸­å…³äº vmThread.hpp é‡Œé¢çš„æ³¨é‡Šï¼Œå®ƒæ˜¯ä¸€ä¸ªå•ä¾‹çš„å¯¹è±¡ï¼ˆæœ€åŸå§‹çš„çº¿ç¨‹ï¼‰ä¼šäº§ç”Ÿæˆ–è§¦å‘æ‰€æœ‰å…¶ä»–çš„çº¿ç¨‹ï¼Œè¿™ä¸ªå•ä¾‹çš„ VM çº¿ç¨‹æ˜¯ä¼šè¢«å…¶ä»–çº¿ç¨‹æ‰€ä½¿ç”¨æ¥åšä¸€äº› VM æ“ä½œï¼ˆå¦‚æ¸…æ‰«åƒåœ¾ç­‰ï¼‰ã€‚
åœ¨ VM Thread çš„ç»“æ„ä½“é‡Œæœ‰ä¸€ä¸ª VMOperationQueue åˆ—é˜Ÿï¼Œæ‰€æœ‰çš„ VM çº¿ç¨‹æ“ä½œ(vm_operation)éƒ½ä¼šè¢«ä¿å­˜åˆ°è¿™ä¸ªåˆ—é˜Ÿå½“ä¸­ï¼ŒVMThread æœ¬èº«å°±æ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼Œå®ƒçš„çº¿ç¨‹è´Ÿè´£æ‰§è¡Œä¸€ä¸ªè‡ªè½®è¯¢çš„ loop å‡½æ•°(å…·ä½“å¯ä»¥å‚è€ƒï¼šVMThread.cpp é‡Œé¢çš„ void VMThread::loop()) ï¼Œè¯¥ loop å‡½æ•°ä» VMOperationQueue åˆ—é˜Ÿä¸­æŒ‰ç…§ä¼˜å…ˆçº§å–å‡ºå½“å‰éœ€è¦æ‰§è¡Œçš„æ“ä½œå¯¹è±¡(VM_Operation)ï¼Œå¹¶ä¸”è°ƒç”¨ VM_Operation-&gt;evaluate å‡½æ•°å»æ‰§è¡Œè¯¥æ“ä½œç±»å‹æœ¬èº«çš„ä¸šåŠ¡é€»è¾‘ã€‚
VM æ“ä½œç±»å‹è¢«å®šä¹‰åœ¨ vm_operations.hpp æ–‡ä»¶å†…ï¼Œåˆ—ä¸¾å‡ ä¸ªï¼šThreadStopã€ThreadDumpã€PrintThreadsã€GenCollectFullã€GenCollectFullConcurrentã€CMS_Initial_Markã€CMS_Final_Remarkâ€¦.. æœ‰å…´è¶£çš„åŒå­¦ï¼Œå¯ä»¥è‡ªå·±å»æŸ¥çœ‹æºæ–‡ä»¶ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>&quot;VM Thread&quot; prio=10 tid=0x00007fbea80d3800 nid=0x5e9 runnable
</code></pre></div><h4 id="ç¬¬å››éƒ¨åˆ†-hotspot-gc-thread"><a href="#ç¬¬å››éƒ¨åˆ†-hotspot-gc-thread" class="header-anchor">#</a> ç¬¬å››éƒ¨åˆ†ï¼šHotSpot GC Thread</h4> <p>JVM ä¸­ç”¨äºè¿›è¡Œèµ„æºå›æ”¶çš„çº¿ç¨‹ï¼ŒåŒ…æ‹¬ä»¥ä¸‹å‡ ç§ç±»å‹çš„çº¿ç¨‹ï¼š</p> <h5 id="vm-periodic-task-thread"><a href="#vm-periodic-task-thread" class="header-anchor">#</a> &quot;VM Periodic Task Thread&quot;</h5> <p>è¯¥çº¿ç¨‹æ˜¯ JVM å‘¨æœŸæ€§ä»»åŠ¡è°ƒåº¦çš„çº¿ç¨‹ï¼Œå®ƒç”± WatcherThread åˆ›å»ºï¼Œæ˜¯ä¸€ä¸ªå•ä¾‹å¯¹è±¡ã€‚è¯¥çº¿ç¨‹åœ¨ JVM å†…ä½¿ç”¨å¾—æ¯”è¾ƒé¢‘ç¹ï¼Œæ¯”å¦‚ï¼šå®šæœŸçš„å†…å­˜ç›‘æ§ã€JVM è¿è¡ŒçŠ¶å†µç›‘æ§ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>&quot;VM Periodic Task Thread&quot; prio=10 tid=0x00007fbea82ae800 nid=0x5fa waiting on condition
</code></pre></div><p>å¯ä»¥ä½¿ç”¨ jstat å‘½ä»¤æŸ¥çœ‹ GC çš„æƒ…å†µï¼Œæ¯”å¦‚æŸ¥çœ‹æŸä¸ªè¿›ç¨‹æ²¡æœ‰å­˜æ´»å¿…è¦çš„å¼•ç”¨å¯ä»¥ä½¿ç”¨å‘½ä»¤ <code>jstat -gcutil 250 7</code> å‚æ•°ä¸­ pid æ˜¯è¿›ç¨‹ idï¼Œåé¢çš„ 250 å’Œ 7 è¡¨ç¤ºæ¯ 250 æ¯«ç§’æ‰“å°ä¸€æ¬¡ï¼Œæ€»å…±æ‰“å° 7 æ¬¡ã€‚
è¿™å¯¹äºé˜²æ­¢å› ä¸ºåº”ç”¨ä»£ç ä¸­ç›´æ¥ä½¿ç”¨ native åº“æˆ–è€…ç¬¬ä¸‰æ–¹çš„ä¸€äº›ç›‘æ§å·¥å…·çš„å†…å­˜æ³„æ¼æœ‰éå¸¸å¤§çš„å¸®åŠ©ã€‚</p> <h5 id="gc-task-thread-0-parallelgc"><a href="#gc-task-thread-0-parallelgc" class="header-anchor">#</a> &quot;GC task thread#0 (ParallelGC)&quot;</h5> <p>åƒåœ¾å›æ”¶çº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹ä¼šè´Ÿè´£è¿›è¡Œåƒåœ¾å›æ”¶ã€‚é€šå¸¸ JVM ä¼šå¯åŠ¨å¤šä¸ªçº¿ç¨‹æ¥å¤„ç†è¿™ä¸ªå·¥ä½œï¼Œçº¿ç¨‹åç§°ä¸­#åé¢çš„æ•°å­—ä¹Ÿä¼šç´¯åŠ ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>&quot;GC task thread#0 (ParallelGC)&quot; prio=5 tid=0x00007fc6b480d000 nid=0x2503 runnable

&quot;GC task thread#1 (ParallelGC)&quot; prio=5 tid=0x00007fc6b2812000 nid=0x2703 runnable

&quot;GC task thread#2 (ParallelGC)&quot; prio=5 tid=0x00007fc6b2812800 nid=0x2903 runnable

&quot;GC task thread#3 (ParallelGC)&quot; prio=5 tid=0x00007fc6b2813000 nid=0x2b03 runnable
</code></pre></div><p>å¦‚æœåœ¨ JVM ä¸­å¢åŠ äº† <code>-XX:+UseConcMarkSweepGC</code> å‚æ•°å°†ä¼šå¯ç”¨ CMS ï¼ˆConcurrent Mark-Sweepï¼‰GC Thread æ–¹å¼ï¼Œä»¥ä¸‹æ˜¯è¯¥æ¨¡å¼ä¸‹çš„çº¿ç¨‹ç±»å‹ï¼š</p> <h5 id="gang-worker-0-parallel-gc-threads"><a href="#gang-worker-0-parallel-gc-threads" class="header-anchor">#</a> &quot;Gang worker#0 (Parallel GC Threads)&quot;</h5> <p>åŸæ¥åƒåœ¾å›æ”¶çº¿ç¨‹ GC task thread#0 (ParallelGC) è¢«æ›¿æ¢ä¸º Gang worker#0 (Parallel GC Threads)ã€‚Gang worker æ˜¯ JVM ç”¨äºå¹´è½»ä»£åƒåœ¾å›æ”¶(minor gc)çš„çº¿ç¨‹ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>&quot;Gang worker#0 (Parallel GC Threads)&quot; prio=10 tid=0x00007fbea801b800 nid=0x5e4 runnable

&quot;Gang worker#1 (Parallel GC Threads)&quot; prio=10 tid=0x00007fbea801d800 nid=0x5e7 runnable
</code></pre></div><h5 id="concurrent-mark-sweep-gc-thread"><a href="#concurrent-mark-sweep-gc-thread" class="header-anchor">#</a> &quot;Concurrent Mark-Sweep GC Thread&quot;</h5> <p>å¹¶å‘æ ‡è®°æ¸…é™¤åƒåœ¾å›æ”¶å™¨ï¼ˆå°±æ˜¯é€šå¸¸æ‰€è¯´çš„ CMS GCï¼‰çº¿ç¨‹ï¼Œ è¯¥çº¿ç¨‹ä¸»è¦é’ˆå¯¹äºå¹´è€ä»£åƒåœ¾å›æ”¶ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>&quot;Concurrent Mark-Sweep GC Thread&quot; prio=10 tid=0x00007fbea8073800 nid=0x5e8 runnable
</code></pre></div><h5 id="surrogate-locker-thread-concurrent-gc"><a href="#surrogate-locker-thread-concurrent-gc" class="header-anchor">#</a> &quot;Surrogate Locker Thread (Concurrent GC)&quot;</h5> <p>æ­¤çº¿ç¨‹ä¸»è¦é…åˆ CMS åƒåœ¾å›æ”¶å™¨æ¥ä½¿ç”¨ï¼Œæ˜¯ä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹ï¼Œä¸»è¦è´Ÿè´£å¤„ç† GC è¿‡ç¨‹ä¸­ Java å±‚çš„ Referenceï¼ˆæŒ‡è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ç­‰ç­‰ï¼‰ä¸ jvm å†…éƒ¨å±‚é¢çš„å¯¹è±¡çŠ¶æ€åŒæ­¥ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>&quot;Surrogate Locker Thread (Concurrent GC)&quot; daemon prio=10 tid=0x00007fbea8158800 nid=0x5ee waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE
</code></pre></div><p>è¿™é‡Œä»¥ WeakHashMap ä¸ºä¾‹è¿›è¡Œè¯´æ˜ï¼Œé¦–å…ˆæ˜¯ä¸€ä¸ªå…³é”®ç‚¹ï¼š</p> <ul><li>WeakHashMap å’Œ HashMap ä¸€æ ·ï¼Œå†…éƒ¨æœ‰ä¸€ä¸ª Entry[]æ•°ç»„;</li> <li>WeakHashMap çš„ Entry æ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒçš„ç»§æ‰¿ä½“ç³»ç»“æ„ä¸º Entry-&gt;WeakReference-&gt;Reference;</li> <li>Reference é‡Œé¢æœ‰ä¸€ä¸ªå…¨å±€é”å¯¹è±¡ï¼šLockï¼Œå®ƒä¹Ÿè¢«ç§°ä¸º pending_lockï¼Œæ³¨æ„ï¼šå®ƒæ˜¯é™æ€å¯¹è±¡ï¼›</li> <li>Reference é‡Œé¢æœ‰ä¸€ä¸ªé™æ€å˜é‡ï¼špendingï¼›</li> <li>Reference é‡Œé¢æœ‰ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ï¼šReferenceHandler çš„çº¿ç¨‹ï¼Œå®ƒåœ¨ static å—é‡Œé¢è¢«åˆå§‹åŒ–å¹¶ä¸”å¯åŠ¨ï¼Œå¯åŠ¨å®Œæˆåå¤„äº wait çŠ¶æ€ï¼Œå®ƒåœ¨ä¸€ä¸ª Lock åŒæ­¥é”æ¨¡å—ä¸­ç­‰å¾…ï¼›</li> <li>WeakHashMap é‡Œé¢è¿˜å®ä¾‹åŒ–äº†ä¸€ä¸ª ReferenceQueue åˆ—é˜Ÿ</li></ul> <p>å‡è®¾ï¼ŒWeakHashMap å¯¹è±¡é‡Œé¢å·²ç»ä¿å­˜äº†å¾ˆå¤šå¯¹è±¡çš„å¼•ç”¨ï¼ŒJVM åœ¨è¿›è¡Œ CMS GC çš„æ—¶å€™ä¼šåˆ›å»ºä¸€ä¸ª ConcurrentMarkSweepThreadï¼ˆç®€ç§° CMSTï¼‰çº¿ç¨‹å»è¿›è¡Œ GCã€‚ConcurrentMarkSweepThread çº¿ç¨‹è¢«åˆ›å»ºçš„åŒæ—¶ä¼šåˆ›å»ºä¸€ä¸ª SurrogateLockerThreadï¼ˆç®€ç§° SLTï¼‰çº¿ç¨‹å¹¶ä¸”å¯åŠ¨å®ƒï¼ŒSLT å¯åŠ¨ä¹‹åï¼Œå¤„äºç­‰å¾…é˜¶æ®µã€‚
CMST å¼€å§‹ GC æ—¶ï¼Œä¼šå‘ä¸€ä¸ªæ¶ˆæ¯ç»™ SLT è®©å®ƒå»è·å– Java å±‚ Reference å¯¹è±¡çš„å…¨å±€é”ï¼šLockã€‚ç›´åˆ° CMS GC å®Œæ¯•ä¹‹åï¼ŒJVM ä¼šå°† WeakHashMap ä¸­æ‰€æœ‰è¢«å›æ”¶çš„å¯¹è±¡æ‰€å±çš„ WeakReference å®¹å™¨å¯¹è±¡æ”¾å…¥åˆ° Reference çš„ pending å±æ€§å½“ä¸­ï¼ˆæ¯æ¬¡ GC å®Œæ¯•ä¹‹åï¼Œpending å±æ€§åŸºæœ¬ä¸Šéƒ½ä¸ä¼šä¸º null äº†ï¼‰ï¼Œç„¶åé€šçŸ¥ SLT é‡Šæ”¾å¹¶ä¸” notify å…¨å±€é”:Lockã€‚æ­¤æ—¶æ¿€æ´»äº† ReferenceHandler çº¿ç¨‹çš„ run æ–¹æ³•ï¼Œä½¿å…¶è„±ç¦» wait çŠ¶æ€ï¼Œå¼€å§‹å·¥ä½œäº†ã€‚
ReferenceHandler è¿™ä¸ªçº¿ç¨‹ä¼šå°† pending ä¸­çš„æ‰€æœ‰ WeakReference å¯¹è±¡éƒ½ç§»åŠ¨åˆ°å®ƒä»¬å„è‡ªçš„åˆ—é˜Ÿå½“ä¸­ï¼Œæ¯”å¦‚å½“å‰è¿™ä¸ª WeakReference å±äºæŸä¸ª WeakHashMap å¯¹è±¡ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šè¢«æ”¾å…¥ç›¸åº”çš„ ReferenceQueue åˆ—é˜Ÿé‡Œé¢ï¼ˆè¯¥åˆ—é˜Ÿæ˜¯é“¾è¡¨ç»“æ„ï¼‰ã€‚ å½“æˆ‘ä»¬ä¸‹æ¬¡ä» WeakHashMap å¯¹è±¡é‡Œé¢ getã€put æ•°æ®æˆ–è€…è°ƒç”¨ size æ–¹æ³•çš„æ—¶å€™ï¼ŒWeakHashMap å°±ä¼šå°† ReferenceQueue åˆ—é˜Ÿä¸­çš„ WeakReference ä¾ä¾ poll å‡ºæ¥å»å’Œ Entry[]æ•°æ®åšæ¯”è¾ƒï¼Œå¦‚æœå‘ç°ç›¸åŒçš„ï¼Œåˆ™è¯´æ˜è¿™ä¸ª Entry æ‰€ä¿å­˜çš„å¯¹è±¡å·²ç»è¢« GC æ‰äº†ï¼Œé‚£ä¹ˆå°† Entry[]å†…çš„ Entry å¯¹è±¡å‰”é™¤æ‰ã€‚</p> <h4 id="ç¬¬äº”éƒ¨åˆ†-jni-global-references-count"><a href="#ç¬¬äº”éƒ¨åˆ†-jni-global-references-count" class="header-anchor">#</a> ç¬¬äº”éƒ¨åˆ†ï¼šJNI global references count</h4> <p>è¿™ä¸€éƒ¨åˆ†ä¸»è¦å›æ”¶é‚£äº›åœ¨ native ä»£ç ä¸Šè¢«å¼•ç”¨ï¼Œä½†åœ¨ java ä»£ç ä¸­å´æ²¡æœ‰å­˜æ´»å¿…è¦çš„å¼•ç”¨ï¼Œå¯¹äºé˜²æ­¢å› ä¸ºåº”ç”¨ä»£ç ä¸­ç›´æ¥ä½¿ç”¨ native åº“æˆ–ç¬¬ä¸‰æ–¹çš„ä¸€äº›ç›‘æ§å·¥å…·çš„å†…å­˜æ³„æ¼æœ‰éå¸¸å¤§çš„å¸®åŠ©ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>JNI global references: 830
</code></pre></div><p>ä¸‹ä¸€ç¯‡æ–‡ç« å°†è¦è®²è¿°ä¸€ä¸ªç›´æ¥æ‰¾å‡º CPU 100% çº¿ç¨‹çš„ä¾‹å­ã€‚</p> <h3 id="_4-3-ç³»ç»Ÿçº¿ç¨‹çŠ¶æ€"><a href="#_4-3-ç³»ç»Ÿçº¿ç¨‹çŠ¶æ€" class="header-anchor">#</a> 4.3. ç³»ç»Ÿçº¿ç¨‹çŠ¶æ€</h3> <p>ç³»ç»Ÿçº¿ç¨‹æœ‰å¦‚ä¸‹çŠ¶æ€ï¼š</p> <h4 id="deadlock"><a href="#deadlock" class="header-anchor">#</a> deadlock</h4> <p>æ­»é”çº¿ç¨‹ï¼Œä¸€èˆ¬æŒ‡å¤šä¸ªçº¿ç¨‹è°ƒç”¨æœŸé—´è¿›å…¥äº†ç›¸äº’èµ„æºå ç”¨ï¼Œå¯¼è‡´ä¸€ç›´ç­‰å¾…æ— æ³•é‡Šæ”¾çš„æƒ…å†µã€‚</p> <p>ã€ç¤ºä¾‹ã€‘deadlock ç¤ºä¾‹</p> <div class="language- extra-class"><pre class="language-text"><code>&quot;DEADLOCK_TEST-1&quot; daemon prio=6 tid=0x000000000690f800 nid=0x1820 waiting for monitor entry [0x000000000805f000]
   java.lang.Thread.State: BLOCKED (on object monitor)
                at com.nbp.theplatform.threaddump.ThreadDeadLockState$DeadlockThread.goMonitorDeadlock(ThreadDeadLockState.java:197)
                - waiting to lock &lt;0x00000007d58f5e60&gt; (a com.nbp.theplatform.threaddump.ThreadDeadLockState$Monitor)
                at com.nbp.theplatform.threaddump.ThreadDeadLockState$DeadlockThread.monitorOurLock(ThreadDeadLockState.java:182)
                - locked &lt;0x00000007d58f5e48&gt; (a com.nbp.theplatform.threaddump.ThreadDeadLockState$Monitor)
                at com.nbp.theplatform.threaddump.ThreadDeadLockState$DeadlockThread.run(ThreadDeadLockState.java:135)

   Locked ownable synchronizers:
                - None

&quot;DEADLOCK_TEST-2&quot; daemon prio=6 tid=0x0000000006858800 nid=0x17b8 waiting for monitor entry [0x000000000815f000]
   java.lang.Thread.State: BLOCKED (on object monitor)
                at com.nbp.theplatform.threaddump.ThreadDeadLockState$DeadlockThread.goMonitorDeadlock(ThreadDeadLockState.java:197)
                - waiting to lock &lt;0x00000007d58f5e78&gt; (a com.nbp.theplatform.threaddump.ThreadDeadLockState$Monitor)
                at com.nbp.theplatform.threaddump.ThreadDeadLockState$DeadlockThread.monitorOurLock(ThreadDeadLockState.java:182)
                - locked &lt;0x00000007d58f5e60&gt; (a com.nbp.theplatform.threaddump.ThreadDeadLockState$Monitor)
                at com.nbp.theplatform.threaddump.ThreadDeadLockState$DeadlockThread.run(ThreadDeadLockState.java:135)

   Locked ownable synchronizers:
                - None

&quot;DEADLOCK_TEST-3&quot; daemon prio=6 tid=0x0000000006859000 nid=0x25dc waiting for monitor entry [0x000000000825f000]
   java.lang.Thread.State: BLOCKED (on object monitor)
                at com.nbp.theplatform.threaddump.ThreadDeadLockState$DeadlockThread.goMonitorDeadlock(ThreadDeadLockState.java:197)
                - waiting to lock &lt;0x00000007d58f5e48&gt; (a com.nbp.theplatform.threaddump.ThreadDeadLockState$Monitor)
                at com.nbp.theplatform.threaddump.ThreadDeadLockState$DeadlockThread.monitorOurLock(ThreadDeadLockState.java:182)
                - locked &lt;0x00000007d58f5e78&gt; (a com.nbp.theplatform.threaddump.ThreadDeadLockState$Monitor)
                at com.nbp.theplatform.threaddump.ThreadDeadLockState$DeadlockThread.run(ThreadDeadLockState.java:135)

   Locked ownable synchronizers:
                - None
</code></pre></div><h4 id="runnable"><a href="#runnable" class="header-anchor">#</a> runnable</h4> <p>ä¸€èˆ¬æŒ‡è¯¥çº¿ç¨‹æ­£åœ¨æ‰§è¡ŒçŠ¶æ€ä¸­ï¼Œè¯¥çº¿ç¨‹å ç”¨äº†èµ„æºï¼Œæ­£åœ¨å¤„ç†æŸä¸ªæ“ä½œï¼Œå¦‚é€šè¿‡ SQL è¯­å¥æŸ¥è¯¢æ•°æ®åº“ã€å¯¹æŸä¸ªæ–‡ä»¶è¿›è¡Œå†™å…¥ç­‰ã€‚</p> <h4 id="blocked"><a href="#blocked" class="header-anchor">#</a> blocked</h4> <p>çº¿ç¨‹æ­£å¤„äºé˜»å¡çŠ¶æ€ï¼ŒæŒ‡å½“å‰çº¿ç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ‰€éœ€è¦çš„èµ„æºé•¿æ—¶é—´ç­‰å¾…å´ä¸€ç›´æœªèƒ½è·å–åˆ°ï¼Œè¢«å®¹å™¨çš„çº¿ç¨‹ç®¡ç†å™¨æ ‡è¯†ä¸ºé˜»å¡çŠ¶æ€ï¼Œå¯ä»¥ç†è§£ä¸ºç­‰å¾…èµ„æºè¶…æ—¶çš„çº¿ç¨‹ã€‚</p> <p>ã€ç¤ºä¾‹ã€‘blocked ç¤ºä¾‹</p> <div class="language- extra-class"><pre class="language-text"><code>&quot;BLOCKED_TEST pool-1-thread-2&quot; prio=6 tid=0x0000000007673800 nid=0x260c waiting for monitor entry [0x0000000008abf000]
   java.lang.Thread.State: BLOCKED (on object monitor)
                at com.nbp.theplatform.threaddump.ThreadBlockedState.monitorLock(ThreadBlockedState.java:43)
                - waiting to lock &lt;0x0000000780a000b0&gt; (a com.nbp.theplatform.threaddump.ThreadBlockedState)
                at com.nbp.theplatform.threaddump.ThreadBlockedState$2.run(ThreadBlockedState.java:26)
                at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
                at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
                at java.lang.Thread.run(Thread.java:662)
   Locked ownable synchronizers:
                - &lt;0x0000000780b0c6a0&gt; (a java.util.concurrent.locks.ReentrantLock$NonfairSync)
&quot;BLOCKED_TEST pool-1-thread-3&quot; prio=6 tid=0x00000000074f5800 nid=0x1994 waiting for monitor entry [0x0000000008bbf000]
   java.lang.Thread.State: BLOCKED (on object monitor)
                at com.nbp.theplatform.threaddump.ThreadBlockedState.monitorLock(ThreadBlockedState.java:42)
                - waiting to lock &lt;0x0000000780a000b0&gt; (a com.nbp.theplatform.threaddump.ThreadBlockedState)
                at com.nbp.theplatform.threaddump.ThreadBlockedState$3.run(ThreadBlockedState.java:34)
                at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886
                at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
                at java.lang.Thread.run(Thread.java:662)
   Locked ownable synchronizers:
                - &lt;0x0000000780b0e1b8&gt; (a java.util.concurrent.locks.ReentrantLock$NonfairSync)
</code></pre></div><h4 id="waiting-on-condition"><a href="#waiting-on-condition" class="header-anchor">#</a> waiting on condition</h4> <p>çº¿ç¨‹æ­£å¤„äºç­‰å¾…èµ„æºæˆ–ç­‰å¾…æŸä¸ªæ¡ä»¶çš„å‘ç”Ÿï¼Œå…·ä½“çš„åŸå› éœ€è¦ç»“åˆä¸‹é¢å †æ ˆä¿¡æ¯è¿›è¡Œåˆ†æã€‚</p> <p>ï¼ˆ1ï¼‰å¦‚æœå †æ ˆä¿¡æ¯æ˜ç¡®æ˜¯åº”ç”¨ä»£ç ï¼Œåˆ™è¯æ˜è¯¥çº¿ç¨‹æ­£åœ¨ç­‰å¾…èµ„æºï¼Œä¸€èˆ¬æ˜¯å¤§é‡è¯»å–æŸç§èµ„æºä¸”è¯¥èµ„æºé‡‡ç”¨äº†èµ„æºé”çš„æƒ…å†µä¸‹ï¼Œçº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç­‰å¾…èµ„æºçš„è¯»å–ï¼Œæˆ–è€…æ­£åœ¨ç­‰å¾…å…¶ä»–çº¿ç¨‹çš„æ‰§è¡Œç­‰ã€‚</p> <p>ï¼ˆ2ï¼‰å¦‚æœå‘ç°æœ‰å¤§é‡çš„çº¿ç¨‹éƒ½æ­£å¤„äºè¿™ç§çŠ¶æ€ï¼Œå¹¶ä¸”å †æ ˆä¿¡æ¯ä¸­å¾—çŸ¥æ­£ç­‰å¾…ç½‘ç»œè¯»å†™ï¼Œè¿™æ˜¯å› ä¸ºç½‘ç»œé˜»å¡å¯¼è‡´çº¿ç¨‹æ— æ³•æ‰§è¡Œï¼Œå¾ˆæœ‰å¯èƒ½æ˜¯ä¸€ä¸ªç½‘ç»œç“¶é¢ˆçš„å¾å…†ï¼š</p> <ul><li><p>ç½‘ç»œéå¸¸ç¹å¿™ï¼Œå‡ ä¹æ¶ˆè€—äº†æ‰€æœ‰çš„å¸¦å®½ï¼Œä»ç„¶æœ‰å¤§é‡æ•°æ®ç­‰å¾…ç½‘ç»œè¯»å†™ï¼›</p></li> <li><p>ç½‘ç»œå¯èƒ½æ˜¯ç©ºé—²çš„ï¼Œä½†ç”±äºè·¯ç”±æˆ–é˜²ç«å¢™ç­‰åŸå› ï¼Œå¯¼è‡´åŒ…æ— æ³•æ­£å¸¸åˆ°è¾¾ï¼›</p></li></ul> <p>æ‰€ä»¥ä¸€å®šè¦ç»“åˆç³»ç»Ÿçš„ä¸€äº›æ€§èƒ½è§‚å¯Ÿå·¥å…·è¿›è¡Œç»¼åˆåˆ†æï¼Œæ¯”å¦‚ netstat ç»Ÿè®¡å•ä½æ—¶é—´çš„å‘é€åŒ…çš„æ•°é‡ï¼Œçœ‹æ˜¯å¦å¾ˆæ˜æ˜¾è¶…è¿‡äº†æ‰€åœ¨ç½‘ç»œå¸¦å®½çš„é™åˆ¶ï¼›è§‚å¯Ÿ CPU çš„åˆ©ç”¨ç‡ï¼Œçœ‹ç³»ç»Ÿæ€çš„ CPU æ—¶é—´æ˜¯å¦æ˜æ˜¾å¤§äºç”¨æˆ·æ€çš„ CPU æ—¶é—´ã€‚è¿™äº›éƒ½æŒ‡å‘ç”±äºç½‘ç»œå¸¦å®½æ‰€é™å¯¼è‡´çš„ç½‘ç»œç“¶é¢ˆã€‚</p> <p>ï¼ˆ3ï¼‰è¿˜æœ‰ä¸€ç§å¸¸è§çš„æƒ…å†µæ˜¯è¯¥çº¿ç¨‹åœ¨ sleepï¼Œç­‰å¾… sleep çš„æ—¶é—´åˆ°äº†ï¼Œå°†è¢«å”¤é†’ã€‚</p> <p>ã€ç¤ºä¾‹ã€‘ç­‰å¾…çŠ¶æ€æ ·ä¾‹</p> <div class="language- extra-class"><pre class="language-text"><code> &quot;IoWaitThread&quot; prio=6 tid=0x0000000007334800 nid=0x2b3c waiting on condition [0x000000000893f000]
   java.lang.Thread.State: WAITING (parking)
                at sun.misc.Unsafe.park(Native Method)
                - parking to wait for  &lt;0x00000007d5c45850&gt; (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)
                at java.util.concurrent.locks.LockSupport.park(LockSupport.java:156)
                at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:1987)
                at java.util.concurrent.LinkedBlockingDeque.takeFirst(LinkedBlockingDeque.java:440)
                at java.util.concurrent.LinkedBlockingDeque.take(LinkedBlockingDeque.java:629)
                at com.nbp.theplatform.threaddump.ThreadIoWaitState$IoWaitHandler2.run(ThreadIoWaitState.java:89)
                at java.lang.Thread.run(Thread.java:662)
</code></pre></div><h4 id="waiting-for-monitor-entry-æˆ–-in-object-wait"><a href="#waiting-for-monitor-entry-æˆ–-in-object-wait" class="header-anchor">#</a> waiting for monitor entry æˆ– in Object.wait()</h4> <p>Moniter æ˜¯ Java ä¸­ç”¨ä»¥å®ç°çº¿ç¨‹ä¹‹é—´çš„äº’æ–¥ä¸åä½œçš„ä¸»è¦æ‰‹æ®µï¼Œå®ƒå¯ä»¥çœ‹æˆæ˜¯å¯¹è±¡æˆ–è€… class çš„é”ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰ï¼Œä¹Ÿä»…æœ‰ä¸€ä¸ª Monitorã€‚</p> <p><img src="https://www.javatang.com/wp-content/uploads/2017/10/java-monitor.png" alt="img"></p> <p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œæ¯ä¸ª Monitor åœ¨æŸä¸ªæ—¶åˆ»åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æ‹¥æœ‰ï¼Œè¯¥çº¿ç¨‹å°±æ˜¯ &quot;Active Thread&quot;ï¼Œè€Œå…¶ä»–çº¿ç¨‹éƒ½æ˜¯ &quot;Waiting Thread&quot;ï¼Œåˆ†åˆ«åœ¨ä¸¤ä¸ªé˜Ÿåˆ— &quot;Entry Set&quot;å’Œ&quot;Waint Set&quot;é‡Œé¢ç­‰å¾…ã€‚å…¶ä¸­åœ¨ &quot;Entry Set&quot; ä¸­ç­‰å¾…çš„çº¿ç¨‹çŠ¶æ€æ˜¯ <code>waiting for monitor entry</code>ï¼Œåœ¨ &quot;Wait Set&quot; ä¸­ç­‰å¾…çš„çº¿ç¨‹çŠ¶æ€æ˜¯ <code>in Object.wait()</code>ã€‚</p> <p>ï¼ˆ1ï¼‰&quot;Entry Set&quot;é‡Œé¢çš„çº¿ç¨‹ã€‚</p> <p>æˆ‘ä»¬ç§°è¢« <code>synchronized</code> ä¿æŠ¤èµ·æ¥çš„ä»£ç æ®µä¸ºä¸´ç•ŒåŒºï¼Œå¯¹åº”çš„ä»£ç å¦‚ä¸‹ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">synchronized</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å½“ä¸€ä¸ªçº¿ç¨‹ç”³è¯·è¿›å…¥ä¸´ç•ŒåŒºæ—¶ï¼Œå®ƒå°±è¿›å…¥äº† &quot;Entry Set&quot; é˜Ÿåˆ—ä¸­ï¼Œè¿™æ—¶å€™æœ‰ä¸¤ç§å¯èƒ½æ€§ï¼š</p> <ul><li>è¯¥ Monitor ä¸è¢«å…¶ä»–çº¿ç¨‹æ‹¥æœ‰ï¼Œ&quot;Entry Set&quot;é‡Œé¢ä¹Ÿæ²¡æœ‰å…¶ä»–ç­‰å¾…çš„çº¿ç¨‹ã€‚æœ¬çº¿ç¨‹å³æˆä¸ºç›¸åº”ç±»æˆ–è€…å¯¹è±¡çš„ Monitor çš„ Ownerï¼Œæ‰§è¡Œä¸´ç•ŒåŒºé‡Œé¢çš„ä»£ç ï¼›æ­¤æ—¶åœ¨ Thread Dump ä¸­æ˜¾ç¤ºçº¿ç¨‹å¤„äº &quot;Runnable&quot; çŠ¶æ€ã€‚</li> <li>è¯¥ Monitor è¢«å…¶ä»–çº¿ç¨‹æ‹¥æœ‰ï¼Œæœ¬çº¿ç¨‹åœ¨ &quot;Entry Set&quot; é˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚æ­¤æ—¶åœ¨ Thread Dump ä¸­æ˜¾ç¤ºçº¿ç¨‹å¤„äº &quot;waiting for monity entry&quot; çŠ¶æ€ã€‚</li></ul> <p>ä¸´ç•ŒåŒºçš„è®¾ç½®æ˜¯ä¸ºäº†ä¿è¯å…¶å†…éƒ¨çš„ä»£ç æ‰§è¡Œçš„åŸå­æ€§å’Œå®Œæ•´æ€§ï¼Œä½†å› ä¸ºä¸´ç•ŒåŒºåœ¨ä»»ä½•æ—¶é—´åªå…è®¸çº¿ç¨‹ä¸²è¡Œé€šè¿‡ï¼Œè¿™å’Œæˆ‘ä»¬ä½¿ç”¨å¤šçº¿ç¨‹çš„åˆè¡·æ˜¯ç›¸åçš„ã€‚å¦‚æœåœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­å¤§é‡ä½¿ç”¨ synchronizedï¼Œæˆ–è€…ä¸é€‚å½“çš„ä½¿ç”¨å®ƒï¼Œä¼šé€ æˆå¤§é‡çº¿ç¨‹åœ¨ä¸´ç•ŒåŒºçš„å…¥å£ç­‰å¾…ï¼Œé€ æˆç³»ç»Ÿçš„æ€§èƒ½å¤§å¹…ä¸‹é™ã€‚å¦‚æœåœ¨ Thread Dump ä¸­å‘ç°è¿™ä¸ªæƒ…å†µï¼Œåº”è¯¥å®¡è§†æºç å¹¶å¯¹å…¶è¿›è¡Œæ”¹è¿›ã€‚</p> <p>ï¼ˆ2ï¼‰&quot;Wait Set&quot;é‡Œé¢çš„çº¿ç¨‹</p> <p>å½“çº¿ç¨‹è·å¾—äº† Monitorï¼Œè¿›å…¥äº†ä¸´ç•ŒåŒºä¹‹åï¼Œå¦‚æœå‘ç°çº¿ç¨‹ç»§ç»­è¿è¡Œçš„æ¡ä»¶æ²¡æœ‰æ»¡è¶³ï¼Œå®ƒåˆ™è°ƒç”¨å¯¹è±¡ï¼ˆé€šå¸¸æ˜¯è¢« synchronized çš„å¯¹è±¡ï¼‰çš„ wait()æ–¹æ³•ï¼Œæ”¾å¼ƒ Monitorï¼Œè¿›å…¥ &quot;Wait Set&quot;é˜Ÿåˆ—ã€‚åªæœ‰å½“åˆ«çš„çº¿ç¨‹åœ¨è¯¥å¯¹è±¡ä¸Šè°ƒç”¨äº† notify()æˆ–è€… notifyAll()æ–¹æ³•ï¼Œ&quot;Wait Set&quot;é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹æ‰å¾—åˆ°æœºä¼šå»ç«äº‰ï¼Œä½†æ˜¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹è·å¾—å¯¹è±¡çš„ Monitorï¼Œæ¢å¤åˆ°è¿è¡Œæ€ã€‚&quot;Wait Set&quot;ä¸­çš„çº¿ç¨‹åœ¨ Thread Dump ä¸­æ˜¾ç¤ºçš„çŠ¶æ€ä¸º in Object.wait()ã€‚é€šå¸¸æ¥è¯´ï¼Œå½“ CPU å¾ˆå¿™çš„æ—¶å€™å…³æ³¨ Runnable çŠ¶æ€çš„çº¿ç¨‹ï¼Œåä¹‹åˆ™å…³æ³¨ waiting for monitor entry çŠ¶æ€çš„çº¿ç¨‹ã€‚</p> <h3 id="_4-4-jstack-ä½¿ç”¨ç¤ºä¾‹"><a href="#_4-4-jstack-ä½¿ç”¨ç¤ºä¾‹" class="header-anchor">#</a> 4.4. jstack ä½¿ç”¨ç¤ºä¾‹</h3> <h4 id="æ‰¾å‡ºæŸ-java-è¿›ç¨‹ä¸­æœ€è€—è´¹-cpu-çš„-java-çº¿ç¨‹"><a href="#æ‰¾å‡ºæŸ-java-è¿›ç¨‹ä¸­æœ€è€—è´¹-cpu-çš„-java-çº¿ç¨‹" class="header-anchor">#</a> æ‰¾å‡ºæŸ Java è¿›ç¨‹ä¸­æœ€è€—è´¹ CPU çš„ Java çº¿ç¨‹</h4> <p>ï¼ˆ1ï¼‰æ‰¾å‡º Java è¿›ç¨‹</p> <p>å‡è®¾åº”ç”¨åç§°ä¸º myappï¼š</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ jps <span class="token operator">|</span> <span class="token function">grep</span> myapp
<span class="token number">29527</span> myapp.jar
</code></pre></div><p>å¾—åˆ°è¿›ç¨‹ ID ä¸º 21711</p> <p>ï¼ˆ2ï¼‰æ‰¾å‡ºè¯¥è¿›ç¨‹å†…æœ€è€—è´¹ CPU çš„çº¿ç¨‹ï¼Œå¯ä»¥ä½¿ç”¨ <code>ps -Lfp pid</code> æˆ–è€… <code>ps -mp pid -o THREAD, tid, time</code> æˆ–è€… <code>top -Hp pid</code></p> <p><img src="http://static.oschina.net/uploads/space/2014/0128/170402_A57i_111708.png" alt="img">
TIME åˆ—å°±æ˜¯å„ä¸ª Java çº¿ç¨‹è€—è´¹çš„ CPU æ—¶é—´ï¼ŒCPU æ—¶é—´æœ€é•¿çš„æ˜¯çº¿ç¨‹ ID ä¸º 21742 çš„çº¿ç¨‹ï¼Œç”¨</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">printf</span> <span class="token string">&quot;%x<span class="token entity" title="\n">\n</span>&quot;</span> <span class="token number">21742</span>
</code></pre></div><p>å¾—åˆ° 21742 çš„åå…­è¿›åˆ¶å€¼ä¸º 54eeï¼Œä¸‹é¢ä¼šç”¨åˆ°ã€‚</p> <p>ï¼ˆ3ï¼‰ä½¿ç”¨ jstack æ‰“å°çº¿ç¨‹å †æ ˆä¿¡æ¯</p> <p>ä¸‹ä¸€æ­¥ç»ˆäºè½®åˆ° jstack ä¸Šåœºäº†ï¼Œå®ƒç”¨æ¥è¾“å‡ºè¿›ç¨‹ 21711 çš„å †æ ˆä¿¡æ¯ï¼Œç„¶åæ ¹æ®çº¿ç¨‹ ID çš„åå…­è¿›åˆ¶å€¼ grepï¼Œå¦‚ä¸‹ï¼š</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ jstack <span class="token number">21711</span> <span class="token operator">|</span> <span class="token function">grep</span> 54ee
<span class="token string">&quot;PollIntervalRetrySchedulerThread&quot;</span> <span class="token assign-left variable">prio</span><span class="token operator">=</span><span class="token number">10</span> <span class="token assign-left variable">tid</span><span class="token operator">=</span>0x00007f950043e000 <span class="token assign-left variable">nid</span><span class="token operator">=</span>0x54ee <span class="token keyword">in</span> Object.wait<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>0x00007f94c6eda000<span class="token punctuation">]</span>
</code></pre></div><p>å¯ä»¥çœ‹åˆ° CPU æ¶ˆè€—åœ¨ <code>PollIntervalRetrySchedulerThread</code> è¿™ä¸ªç±»çš„ <code>Object.wait()</code>ã€‚</p> <blockquote><p>æ³¨ï¼šä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œé»˜è®¤åªæ˜¾ç¤ºäº†ä¸€è¡Œä¿¡æ¯ï¼Œä½†å¾ˆå¤šæ—¶å€™æˆ‘ä»¬å¸Œæœ›æŸ¥çœ‹æ›´è¯¦ç»†çš„è°ƒç”¨æ ˆã€‚å¯ä»¥é€šè¿‡æŒ‡å®š <code>-A &lt;num&gt;</code> çš„æ–¹å¼æ¥æ˜¾ç¤ºè¡Œæ•°ã€‚ä¾‹å¦‚ï¼š<code>jstack -l &lt;pid&gt; | grep &lt;thread-hex-id&gt; -A 10</code></p></blockquote> <p>ï¼ˆ4ï¼‰åˆ†æä»£ç </p> <p>æˆ‘æ‰¾äº†ä¸‹æˆ‘çš„ä»£ç ï¼Œå®šä½åˆ°ä¸‹é¢çš„ä»£ç ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Idle wait</span>
<span class="token function">getLog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Thread [&quot;</span> <span class="token operator">+</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;] is idle waiting...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
schedulerThreadState <span class="token operator">=</span> <span class="token class-name">PollTaskSchedulerThreadState<span class="token punctuation">.</span>IdleWaiting</span><span class="token punctuation">;</span>
<span class="token keyword">long</span> now <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">long</span> waitTime <span class="token operator">=</span> now <span class="token operator">+</span> <span class="token function">getIdleWaitTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">long</span> timeUntilContinue <span class="token operator">=</span> waitTime <span class="token operator">-</span> now<span class="token punctuation">;</span>
<span class="token keyword">synchronized</span><span class="token punctuation">(</span>sigLock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">try</span> <span class="token punctuation">{</span>
    	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>halted<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    		sigLock<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span>timeUntilContinue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> ignore<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å®ƒæ˜¯è½®è¯¢ä»»åŠ¡çš„ç©ºé—²ç­‰å¾…ä»£ç ï¼Œä¸Šé¢çš„ <code>sigLock.wait(timeUntilContinue)</code> å°±å¯¹åº”äº†å‰é¢çš„ <code>Object.wait()</code>ã€‚</p> <h4 id="ç”Ÿæˆ-threaddump-æ–‡ä»¶"><a href="#ç”Ÿæˆ-threaddump-æ–‡ä»¶" class="header-anchor">#</a> ç”Ÿæˆ threaddump æ–‡ä»¶</h4> <p>å¯ä»¥ä½¿ç”¨ <code>jstack -l &lt;pid&gt; &gt; &lt;file-path&gt;</code> å‘½ä»¤ç”Ÿæˆ threaddump æ–‡ä»¶</p> <p>ã€ç¤ºä¾‹ã€‘ç”Ÿæˆè¿›ç¨‹ ID ä¸º 8841 çš„ Java è¿›ç¨‹çš„ threaddump æ–‡ä»¶ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>jstack -l 8841 &gt; /home/threaddump.txt
</code></pre></div><h2 id="_5-jinfo"><a href="#_5-jinfo" class="header-anchor">#</a> 5. jinfo</h2> <blockquote><p><strong><a href="https://docs.oracle.com/en/java/javase/11/tools/jinfo.html" target="_blank" rel="noopener noreferrer">jinfo(JVM Configuration info)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ï¼Œæ˜¯ Java é…ç½®ä¿¡æ¯å·¥å…·</strong>ã€‚jinfo ç”¨äºå®æ—¶æŸ¥çœ‹å’Œè°ƒæ•´è™šæ‹Ÿæœºè¿è¡Œå‚æ•°ã€‚å¦‚ä¼ é€’ç»™ Java è™šæ‹Ÿæœºçš„<code>-X</code>ï¼ˆå³è¾“å‡ºä¸­çš„ jvm_argsï¼‰ã€<code>-XX</code>å‚æ•°ï¼ˆå³è¾“å‡ºä¸­çš„ VM Flagsï¼‰ï¼Œä»¥åŠå¯åœ¨ Java å±‚é¢é€šè¿‡<code>System.getProperty</code>è·å–çš„<code>-D</code>å‚æ•°ï¼ˆå³è¾“å‡ºä¸­çš„ System Propertiesï¼‰ã€‚</p></blockquote> <p>ä¹‹å‰çš„ <code>jps -v</code> å£ä»¤åªèƒ½æŸ¥çœ‹åˆ°æ˜¾ç¤ºæŒ‡å®šçš„å‚æ•°ï¼Œå¦‚æœæƒ³è¦æŸ¥çœ‹æœªè¢«æ˜¾ç¤ºæŒ‡å®šçš„å‚æ•°çš„å€¼å°±è¦ä½¿ç”¨ jinfo å£ä»¤ã€‚</p> <p>jinfo å‘½ä»¤æ ¼å¼ï¼š</p> <div class="language-shell extra-class"><pre class="language-shell"><code>jinfo <span class="token punctuation">[</span>option<span class="token punctuation">]</span> pid
</code></pre></div><p><code>option</code> é€‰é¡¹å‚æ•°ï¼š</p> <ul><li><code>-flag</code> - è¾“å‡ºæŒ‡å®š args å‚æ•°çš„å€¼</li> <li><code>-sysprops</code> - è¾“å‡ºç³»ç»Ÿå±æ€§ï¼Œç­‰åŒäº <code>System.getProperties()</code></li></ul> <p>ã€ç¤ºä¾‹ã€‘jinfo ä½¿ç”¨ç¤ºä¾‹</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ jinfo -sysprops <span class="token number">29527</span>
Attaching to process ID <span class="token number">29527</span>, please wait<span class="token punctuation">..</span>.
Debugger attached successfully.
Server compiler detected.
JVM version is <span class="token number">25.222</span>-b10
<span class="token punctuation">..</span>.
</code></pre></div><h2 id="_6-jhat"><a href="#_6-jhat" class="header-anchor">#</a> 6. jhat</h2> <blockquote><p><strong>jhat(JVM Heap Analysis Tool)ï¼Œæ˜¯è™šæ‹Ÿæœºå †è½¬å‚¨å¿«ç…§åˆ†æå·¥å…·</strong>ã€‚jhat ä¸ jmap æ­é…ä½¿ç”¨ï¼Œç”¨æ¥åˆ†æ jmap ç”Ÿæˆçš„ dump æ–‡ä»¶ã€‚jhat å†…ç½®äº†ä¸€ä¸ªå¾®å‹çš„ HTTP/HTML æœåŠ¡å™¨ï¼Œç”Ÿæˆ dump çš„åˆ†æç»“æœåï¼Œå¯ä»¥åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹ã€‚</p> <p>æ³¨æ„ï¼šä¸€èˆ¬ä¸ä¼šç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šè¿›è¡Œåˆ†æï¼Œå› ä¸º jhat æ˜¯ä¸€ä¸ªè€—æ—¶å¹¶ä¸”è€—è´¹ç¡¬ä»¶èµ„æºçš„è¿‡ç¨‹ï¼Œä¸€èˆ¬æŠŠæœåŠ¡å™¨ç”Ÿæˆçš„ dump æ–‡ä»¶ï¼Œç”¨ jvisualvm ã€Eclipse Memory Analyzerã€IBM HeapAnalyzer ç­‰å·¥å…·æ¥åˆ†æã€‚</p></blockquote> <p>å‘½ä»¤æ ¼å¼ï¼š</p> <div class="language-shell extra-class"><pre class="language-shell"><code>jhat <span class="token punctuation">[</span>dumpfile<span class="token punctuation">]</span>
</code></pre></div><h2 id="_7-å‚è€ƒèµ„æ–™"><a href="#_7-å‚è€ƒèµ„æ–™" class="header-anchor">#</a> 7. å‚è€ƒèµ„æ–™</h2> <ul><li><a href="https://book.douban.com/subject/34907497/" target="_blank" rel="noopener noreferrer">ã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºã€‹<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://time.geekbang.org/column/intro/100028001" target="_blank" rel="noopener noreferrer">ã€ŠJava æ€§èƒ½è°ƒä¼˜å®æˆ˜ã€‹<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://my.oschina.net/feichexia/blog/196575" target="_blank" rel="noopener noreferrer">JVM æ€§èƒ½è°ƒä¼˜ç›‘æ§å·¥å…· jpsã€jstackã€jmapã€jhatã€jstatã€hprof ä½¿ç”¨è¯¦è§£<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://docs.oracle.com/javase/8/docs/technotes/guides/management/jconsole.html" target="_blank" rel="noopener noreferrer">jconsole å®˜æ–¹æ–‡æ¡£<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.cnblogs.com/kongzhongqijing/articles/3621441.html" target="_blank" rel="noopener noreferrer">jconsole å·¥å…·ä½¿ç”¨<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.cnblogs.com/yjd_hycf_space/p/7755633.html" target="_blank" rel="noopener noreferrer">jstat å‘½ä»¤æŸ¥çœ‹ jvm çš„ GC æƒ…å†µ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://blog.csdn.net/wanghuiqi2008/article/details/50724676" target="_blank" rel="noopener noreferrer">åˆ©ç”¨å†…å­˜åˆ†æå·¥å…·ï¼ˆMemory Analyzer Toolï¼ŒMATï¼‰åˆ†æ java é¡¹ç›®å†…å­˜æ³„éœ²<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.javatang.com/archives/2017/10/19/33151873.html" target="_blank" rel="noopener noreferrer">JVM æ•…éšœåˆ†æåŠæ€§èƒ½ä¼˜åŒ–ç³»åˆ—ä¹‹ä¸€ï¼šä½¿ç”¨ jstack å®šä½çº¿ç¨‹å †æ ˆä¿¡æ¯<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/dunwu/javacore/edit/master/docs/jvm/jvm-cli-tools.md" target="_blank" rel="noopener noreferrer">å¸®åŠ©æˆ‘ä»¬æ”¹å–„æ­¤é¡µé¢ï¼</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">3 minutes ago</span></div></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/javacore/assets/js/app.62a93b3d.js" defer></script><script src="/javacore/assets/js/4.156ff030.js" defer></script><script src="/javacore/assets/js/64.67d22444.js" defer></script><script src="/javacore/assets/js/5.cb43ecfb.js" defer></script>
  </body>
</html>
