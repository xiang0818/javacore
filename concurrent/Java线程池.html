<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Java çº¿ç¨‹æ±  | JAVACORE</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/javacore/favicon.ico">
    <meta name="description" content="Java æ•™ç¨‹">
    
    <link rel="preload" href="/javacore/assets/css/0.styles.b629dfcc.css" as="style"><link rel="preload" href="/javacore/assets/js/app.62a93b3d.js" as="script"><link rel="preload" href="/javacore/assets/js/4.156ff030.js" as="script"><link rel="preload" href="/javacore/assets/js/40.09a7bf54.js" as="script"><link rel="preload" href="/javacore/assets/js/5.cb43ecfb.js" as="script"><link rel="prefetch" href="/javacore/assets/js/10.914d71f6.js"><link rel="prefetch" href="/javacore/assets/js/11.d42a0004.js"><link rel="prefetch" href="/javacore/assets/js/12.ebe9232a.js"><link rel="prefetch" href="/javacore/assets/js/13.5288142e.js"><link rel="prefetch" href="/javacore/assets/js/14.9d818b0a.js"><link rel="prefetch" href="/javacore/assets/js/15.b38fe602.js"><link rel="prefetch" href="/javacore/assets/js/16.5241809d.js"><link rel="prefetch" href="/javacore/assets/js/17.78168216.js"><link rel="prefetch" href="/javacore/assets/js/18.c92f16c4.js"><link rel="prefetch" href="/javacore/assets/js/19.099e9533.js"><link rel="prefetch" href="/javacore/assets/js/20.2a48e7e2.js"><link rel="prefetch" href="/javacore/assets/js/21.32368b62.js"><link rel="prefetch" href="/javacore/assets/js/22.5252e8af.js"><link rel="prefetch" href="/javacore/assets/js/23.24096651.js"><link rel="prefetch" href="/javacore/assets/js/24.86b4a663.js"><link rel="prefetch" href="/javacore/assets/js/25.59ab8bc9.js"><link rel="prefetch" href="/javacore/assets/js/26.0721512b.js"><link rel="prefetch" href="/javacore/assets/js/27.c4d59768.js"><link rel="prefetch" href="/javacore/assets/js/28.04551164.js"><link rel="prefetch" href="/javacore/assets/js/29.db12912f.js"><link rel="prefetch" href="/javacore/assets/js/30.0d802d5e.js"><link rel="prefetch" href="/javacore/assets/js/31.9963f4e9.js"><link rel="prefetch" href="/javacore/assets/js/32.fd822274.js"><link rel="prefetch" href="/javacore/assets/js/33.cbd2593d.js"><link rel="prefetch" href="/javacore/assets/js/34.67771b2b.js"><link rel="prefetch" href="/javacore/assets/js/35.fcd73a73.js"><link rel="prefetch" href="/javacore/assets/js/36.3c7702f7.js"><link rel="prefetch" href="/javacore/assets/js/37.b6845161.js"><link rel="prefetch" href="/javacore/assets/js/38.72a934f9.js"><link rel="prefetch" href="/javacore/assets/js/39.38104d31.js"><link rel="prefetch" href="/javacore/assets/js/41.645609ce.js"><link rel="prefetch" href="/javacore/assets/js/42.ec4b0d8c.js"><link rel="prefetch" href="/javacore/assets/js/43.b1fa9ba2.js"><link rel="prefetch" href="/javacore/assets/js/44.fedde9b2.js"><link rel="prefetch" href="/javacore/assets/js/45.48adb696.js"><link rel="prefetch" href="/javacore/assets/js/46.13ace3f9.js"><link rel="prefetch" href="/javacore/assets/js/47.165b1fe4.js"><link rel="prefetch" href="/javacore/assets/js/48.d0429b0d.js"><link rel="prefetch" href="/javacore/assets/js/49.46309662.js"><link rel="prefetch" href="/javacore/assets/js/50.d5b30588.js"><link rel="prefetch" href="/javacore/assets/js/51.e77fd12c.js"><link rel="prefetch" href="/javacore/assets/js/52.46d67c4c.js"><link rel="prefetch" href="/javacore/assets/js/53.1e725d70.js"><link rel="prefetch" href="/javacore/assets/js/54.b9ef9b8e.js"><link rel="prefetch" href="/javacore/assets/js/55.e7b94782.js"><link rel="prefetch" href="/javacore/assets/js/56.3a8f1cf6.js"><link rel="prefetch" href="/javacore/assets/js/57.66e8a115.js"><link rel="prefetch" href="/javacore/assets/js/58.ee387dc3.js"><link rel="prefetch" href="/javacore/assets/js/59.3f67cc42.js"><link rel="prefetch" href="/javacore/assets/js/6.6edee210.js"><link rel="prefetch" href="/javacore/assets/js/60.bc134987.js"><link rel="prefetch" href="/javacore/assets/js/61.0672a9d0.js"><link rel="prefetch" href="/javacore/assets/js/62.e670038b.js"><link rel="prefetch" href="/javacore/assets/js/63.0080282f.js"><link rel="prefetch" href="/javacore/assets/js/64.67d22444.js"><link rel="prefetch" href="/javacore/assets/js/65.a136cc8f.js"><link rel="prefetch" href="/javacore/assets/js/66.144da426.js"><link rel="prefetch" href="/javacore/assets/js/67.4959b85e.js"><link rel="prefetch" href="/javacore/assets/js/68.82ee0966.js"><link rel="prefetch" href="/javacore/assets/js/69.1032b73f.js"><link rel="prefetch" href="/javacore/assets/js/7.046e5a1b.js"><link rel="prefetch" href="/javacore/assets/js/8.77fb8967.js"><link rel="prefetch" href="/javacore/assets/js/9.ebfa537e.js"><link rel="prefetch" href="/javacore/assets/js/vendors~flowchart.20a64d45.js"><link rel="prefetch" href="/javacore/assets/js/vendors~notification.ea176280.js">
    <link rel="stylesheet" href="/javacore/assets/css/0.styles.b629dfcc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/javacore/" class="home-link router-link-active"><img src="https://raw.githubusercontent.com/dunwu/images/dev/common/dunwu-logo-200.png" alt="JAVACORE" class="logo"> <span class="site-name can-hide">JAVACORE</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/javacore/basics/" class="nav-link">
  åŸºç¡€ç‰¹æ€§
</a></div><div class="nav-item"><a href="/javacore/advanced/" class="nav-link">
  é«˜çº§ç‰¹æ€§
</a></div><div class="nav-item"><a href="/javacore/container/" class="nav-link">
  å®¹å™¨
</a></div><div class="nav-item"><a href="/javacore/io/" class="nav-link">
  IO
</a></div><div class="nav-item"><a href="/javacore/concurrent/" class="nav-link router-link-active">
  å¹¶å‘
</a></div><div class="nav-item"><a href="/javacore/jvm/" class="nav-link">
  JVM
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">âœ¨ Javaç³»åˆ—</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">âœ¨ Javaç³»åˆ—</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/java-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/javacore/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaCore æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/javatech/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaTech æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-boot-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Boot æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/dunwu/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ğŸ¯ åšå®¢
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/dunwu/javacore" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/javacore/basics/" class="nav-link">
  åŸºç¡€ç‰¹æ€§
</a></div><div class="nav-item"><a href="/javacore/advanced/" class="nav-link">
  é«˜çº§ç‰¹æ€§
</a></div><div class="nav-item"><a href="/javacore/container/" class="nav-link">
  å®¹å™¨
</a></div><div class="nav-item"><a href="/javacore/io/" class="nav-link">
  IO
</a></div><div class="nav-item"><a href="/javacore/concurrent/" class="nav-link router-link-active">
  å¹¶å‘
</a></div><div class="nav-item"><a href="/javacore/jvm/" class="nav-link">
  JVM
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">âœ¨ Javaç³»åˆ—</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">âœ¨ Javaç³»åˆ—</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/java-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/javacore/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaCore æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/javatech/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaTech æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-boot-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Boot æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/dunwu/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ğŸ¯ åšå®¢
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/dunwu/javacore" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Java çº¿ç¨‹æ± </span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_1-ç®€ä»‹" class="sidebar-link">1. ç®€ä»‹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_1-1-ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± " class="sidebar-link">1.1. ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± </a></li><li class="sidebar-sub-header"><a href="/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_1-2-ä¸ºä»€ä¹ˆè¦ç”¨çº¿ç¨‹æ± " class="sidebar-link">1.2. ä¸ºä»€ä¹ˆè¦ç”¨çº¿ç¨‹æ± </a></li></ul></li><li><a href="/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_2-executor-æ¡†æ¶" class="sidebar-link">2. Executor æ¡†æ¶</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_2-1-æ ¸å¿ƒ-api-æ¦‚è¿°" class="sidebar-link">2.1. æ ¸å¿ƒ API æ¦‚è¿°</a></li><li class="sidebar-sub-header"><a href="/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_2-2-executor" class="sidebar-link">2.2. Executor</a></li><li class="sidebar-sub-header"><a href="/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_2-3-executorservice" class="sidebar-link">2.3. ExecutorService</a></li><li class="sidebar-sub-header"><a href="/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_2-4-scheduledexecutorservice" class="sidebar-link">2.4. ScheduledExecutorService</a></li></ul></li><li><a href="/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_3-threadpoolexecutor" class="sidebar-link">3. ThreadPoolExecutor</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_3-1-é‡è¦å­—æ®µ" class="sidebar-link">3.1. é‡è¦å­—æ®µ</a></li><li class="sidebar-sub-header"><a href="/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_3-2-æ„é€ æ–¹æ³•" class="sidebar-link">3.2. æ„é€ æ–¹æ³•</a></li><li class="sidebar-sub-header"><a href="/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_3-3-execute-æ–¹æ³•" class="sidebar-link">3.3. execute æ–¹æ³•</a></li><li class="sidebar-sub-header"><a href="/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_3-4-å…¶ä»–é‡è¦æ–¹æ³•" class="sidebar-link">3.4. å…¶ä»–é‡è¦æ–¹æ³•</a></li><li class="sidebar-sub-header"><a href="/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_3-5-ä½¿ç”¨ç¤ºä¾‹" class="sidebar-link">3.5. ä½¿ç”¨ç¤ºä¾‹</a></li></ul></li><li><a href="/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_4-executors" class="sidebar-link">4. Executors</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_4-1-newsinglethreadexecutor" class="sidebar-link">4.1. newSingleThreadExecutor</a></li><li class="sidebar-sub-header"><a href="/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_4-2-newfixedthreadpool" class="sidebar-link">4.2. newFixedThreadPool</a></li><li class="sidebar-sub-header"><a href="/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_4-3-newcachedthreadpool" class="sidebar-link">4.3. newCachedThreadPool</a></li><li class="sidebar-sub-header"><a href="/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_4-4-newschedulethreadpool" class="sidebar-link">4.4. newScheduleThreadPool</a></li><li class="sidebar-sub-header"><a href="/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_4-5-newworkstealingpool" class="sidebar-link">4.5. newWorkStealingPool</a></li></ul></li><li><a href="/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_5-çº¿ç¨‹æ± æœ€ä½³å®è·µ" class="sidebar-link">5. çº¿ç¨‹æ± æœ€ä½³å®è·µ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_5-1-è®¡ç®—çº¿ç¨‹æ•°é‡" class="sidebar-link">5.1. è®¡ç®—çº¿ç¨‹æ•°é‡</a></li><li class="sidebar-sub-header"><a href="/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_5-2-å»ºè®®ä½¿ç”¨æœ‰ç•Œé˜»å¡é˜Ÿåˆ—" class="sidebar-link">5.2. å»ºè®®ä½¿ç”¨æœ‰ç•Œé˜»å¡é˜Ÿåˆ—</a></li><li class="sidebar-sub-header"><a href="/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_5-3-é‡è¦ä»»åŠ¡åº”è¯¥è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥" class="sidebar-link">5.3. é‡è¦ä»»åŠ¡åº”è¯¥è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥</a></li></ul></li><li><a href="/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_6-å‚è€ƒèµ„æ–™" class="sidebar-link">6. å‚è€ƒèµ„æ–™</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="java-çº¿ç¨‹æ± "><a href="#java-çº¿ç¨‹æ± " class="header-anchor">#</a> Java çº¿ç¨‹æ± </h1> <blockquote><p><strong>ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ <a href="https://github.com/dunwu/javacore/" target="_blank" rel="noopener noreferrer">javacore<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong></p></blockquote> <ul><li><a href="#1-%E7%AE%80%E4%BB%8B">1. ç®€ä»‹</a> <ul><li><a href="#11-%E4%BB%80%E4%B9%88%E6%98%AF%E7%BA%BF%E7%A8%8B%E6%B1%A0">1.1. ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± </a></li> <li><a href="#12-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E7%94%A8%E7%BA%BF%E7%A8%8B%E6%B1%A0">1.2. ä¸ºä»€ä¹ˆè¦ç”¨çº¿ç¨‹æ± </a></li></ul></li> <li><a href="#2-executor-%E6%A1%86%E6%9E%B6">2. Executor æ¡†æ¶</a> <ul><li><a href="#21-%E6%A0%B8%E5%BF%83-api-%E6%A6%82%E8%BF%B0">2.1. æ ¸å¿ƒ API æ¦‚è¿°</a></li> <li><a href="#22-executor">2.2. Executor</a></li> <li><a href="#23-executorservice">2.3. ExecutorService</a></li> <li><a href="#24-scheduledexecutorservice">2.4. ScheduledExecutorService</a></li></ul></li> <li><a href="#3-threadpoolexecutor">3. ThreadPoolExecutor</a> <ul><li><a href="#31-%E9%87%8D%E8%A6%81%E5%AD%97%E6%AE%B5">3.1. é‡è¦å­—æ®µ</a></li> <li><a href="#32-%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95">3.2. æ„é€ æ–¹æ³•</a></li> <li><a href="#33-execute-%E6%96%B9%E6%B3%95">3.3. execute æ–¹æ³•</a></li> <li><a href="#34-%E5%85%B6%E4%BB%96%E9%87%8D%E8%A6%81%E6%96%B9%E6%B3%95">3.4. å…¶ä»–é‡è¦æ–¹æ³•</a></li> <li><a href="#35-%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B">3.5. ä½¿ç”¨ç¤ºä¾‹</a></li></ul></li> <li><a href="#4-executors">4. Executors</a> <ul><li><a href="#41-newsinglethreadexecutor">4.1. newSingleThreadExecutor</a></li> <li><a href="#42-newfixedthreadpool">4.2. newFixedThreadPool</a></li> <li><a href="#43-newcachedthreadpool">4.3. newCachedThreadPool</a></li> <li><a href="#44-newschedulethreadpool">4.4. newScheduleThreadPool</a></li> <li><a href="#45-newworkstealingpool">4.5. newWorkStealingPool</a></li></ul></li> <li><a href="#5-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">5. çº¿ç¨‹æ± æœ€ä½³å®è·µ</a> <ul><li><a href="#51-%E8%AE%A1%E7%AE%97%E7%BA%BF%E7%A8%8B%E6%95%B0%E9%87%8F">5.1. è®¡ç®—çº¿ç¨‹æ•°é‡</a></li> <li><a href="#52-%E5%BB%BA%E8%AE%AE%E4%BD%BF%E7%94%A8%E6%9C%89%E7%95%8C%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97">5.2. å»ºè®®ä½¿ç”¨æœ‰ç•Œé˜»å¡é˜Ÿåˆ—</a></li> <li><a href="#53-%E9%87%8D%E8%A6%81%E4%BB%BB%E5%8A%A1%E5%BA%94%E8%AF%A5%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8B%92%E7%BB%9D%E7%AD%96%E7%95%A5">5.3. é‡è¦ä»»åŠ¡åº”è¯¥è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥</a></li></ul></li> <li><a href="#6-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">6. å‚è€ƒèµ„æ–™</a></li></ul> <h2 id="_1-ç®€ä»‹"><a href="#_1-ç®€ä»‹" class="header-anchor">#</a> 1. ç®€ä»‹</h2> <h3 id="_1-1-ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± "><a href="#_1-1-ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± " class="header-anchor">#</a> 1.1. ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± </h3> <p>çº¿ç¨‹æ± æ˜¯ä¸€ç§å¤šçº¿ç¨‹å¤„ç†å½¢å¼ï¼Œå¤„ç†è¿‡ç¨‹ä¸­å°†ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—ï¼Œç„¶ååœ¨åˆ›å»ºçº¿ç¨‹åè‡ªåŠ¨å¯åŠ¨è¿™äº›ä»»åŠ¡ã€‚</p> <h3 id="_1-2-ä¸ºä»€ä¹ˆè¦ç”¨çº¿ç¨‹æ± "><a href="#_1-2-ä¸ºä»€ä¹ˆè¦ç”¨çº¿ç¨‹æ± " class="header-anchor">#</a> 1.2. ä¸ºä»€ä¹ˆè¦ç”¨çº¿ç¨‹æ± </h3> <p>å¦‚æœå¹¶å‘è¯·æ±‚æ•°é‡å¾ˆå¤šï¼Œä½†æ¯ä¸ªçº¿ç¨‹æ‰§è¡Œçš„æ—¶é—´å¾ˆçŸ­ï¼Œå°±ä¼šå‡ºç°é¢‘ç¹çš„åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œä¼šå¤§å¤§é™ä½ç³»ç»Ÿçš„æ•ˆç‡ï¼Œå¯èƒ½é¢‘ç¹åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹çš„æ—¶é—´ã€èµ„æºå¼€é”€è¦å¤§äºå®é™…å·¥ä½œçš„æ‰€éœ€ã€‚</p> <p>æ­£æ˜¯ç”±äºè¿™ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥æœ‰å¿…è¦å¼•å…¥çº¿ç¨‹æ± ã€‚ä½¿ç”¨ <strong>çº¿ç¨‹æ± çš„å¥½å¤„</strong> æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š</p> <ul><li><strong>é™ä½èµ„æºæ¶ˆè€—</strong> - é€šè¿‡é‡å¤åˆ©ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹é™ä½çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯é€ æˆçš„æ¶ˆè€—ã€‚</li> <li><strong>æé«˜å“åº”é€Ÿåº¦</strong> - å½“ä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œä»»åŠ¡å¯ä»¥ä¸éœ€è¦ç­‰åˆ°çº¿ç¨‹åˆ›å»ºå°±èƒ½ç«‹å³æ‰§è¡Œã€‚</li> <li><strong>æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§</strong> - çº¿ç¨‹æ˜¯ç¨€ç¼ºèµ„æºï¼Œå¦‚æœæ— é™åˆ¶çš„åˆ›å»ºï¼Œä¸ä»…ä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œè¿˜ä¼šé™ä½ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥è¿›è¡Œç»Ÿä¸€çš„åˆ†é…ï¼Œè°ƒä¼˜å’Œç›‘æ§ã€‚ä½†æ˜¯è¦åšåˆ°åˆç†çš„åˆ©ç”¨çº¿ç¨‹æ± ï¼Œå¿…é¡»å¯¹å…¶åŸç†äº†å¦‚æŒ‡æŒã€‚</li></ul> <h2 id="_2-executor-æ¡†æ¶"><a href="#_2-executor-æ¡†æ¶" class="header-anchor">#</a> 2. Executor æ¡†æ¶</h2> <blockquote><p>Executor æ¡†æ¶æ˜¯ä¸€ä¸ªæ ¹æ®ä¸€ç»„æ‰§è¡Œç­–ç•¥è°ƒç”¨ï¼Œè°ƒåº¦ï¼Œæ‰§è¡Œå’Œæ§åˆ¶çš„å¼‚æ­¥ä»»åŠ¡çš„æ¡†æ¶ï¼Œç›®çš„æ˜¯æä¾›ä¸€ç§å°†â€ä»»åŠ¡æäº¤â€ä¸â€ä»»åŠ¡å¦‚ä½•è¿è¡Œâ€åˆ†ç¦»å¼€æ¥çš„æœºåˆ¶ã€‚</p></blockquote> <h3 id="_2-1-æ ¸å¿ƒ-api-æ¦‚è¿°"><a href="#_2-1-æ ¸å¿ƒ-api-æ¦‚è¿°" class="header-anchor">#</a> 2.1. æ ¸å¿ƒ API æ¦‚è¿°</h3> <p>Executor æ¡†æ¶æ ¸å¿ƒ API å¦‚ä¸‹ï¼š</p> <ul><li><code>Executor</code> - è¿è¡Œä»»åŠ¡çš„ç®€å•æ¥å£ã€‚</li> <li><code>ExecutorService</code> - æ‰©å±•äº† <code>Executor</code> æ¥å£ã€‚æ‰©å±•èƒ½åŠ›ï¼š
<ul><li>æ”¯æŒæœ‰è¿”å›å€¼çš„çº¿ç¨‹ï¼›</li> <li>æ”¯æŒç®¡ç†çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸã€‚</li></ul></li> <li><code>ScheduledExecutorService</code> - æ‰©å±•äº† <code>ExecutorService</code> æ¥å£ã€‚æ‰©å±•èƒ½åŠ›ï¼šæ”¯æŒå®šæœŸæ‰§è¡Œä»»åŠ¡ã€‚</li> <li><code>AbstractExecutorService</code> - <code>ExecutorService</code> æ¥å£çš„é»˜è®¤å®ç°ã€‚</li> <li><code>ThreadPoolExecutor</code> - Executor æ¡†æ¶æœ€æ ¸å¿ƒçš„ç±»ï¼Œå®ƒç»§æ‰¿äº† <code>AbstractExecutorService</code> ç±»ã€‚</li> <li><code>ScheduledThreadPoolExecutor</code> - <code>ScheduledExecutorService</code> æ¥å£çš„å®ç°ï¼Œä¸€ä¸ªå¯å®šæ—¶è°ƒåº¦ä»»åŠ¡çš„çº¿ç¨‹æ± ã€‚</li> <li><code>Executors</code> - å¯ä»¥é€šè¿‡è°ƒç”¨ <code>Executors</code> çš„é™æ€å·¥å‚æ–¹æ³•æ¥åˆ›å»ºçº¿ç¨‹æ± å¹¶è¿”å›ä¸€ä¸ª <code>ExecutorService</code> å¯¹è±¡ã€‚</li></ul> <p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/concurrent/exexctor-uml.png" alt="img"></p> <h3 id="_2-2-executor"><a href="#_2-2-executor" class="header-anchor">#</a> 2.2. Executor</h3> <p><code>Executor</code> æ¥å£ä¸­åªå®šä¹‰äº†ä¸€ä¸ª <code>execute</code> æ–¹æ³•ï¼Œç”¨äºæ¥æ”¶ä¸€ä¸ª <code>Runnable</code> å¯¹è±¡ã€‚</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Executor</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> command<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-3-executorservice"><a href="#_2-3-executorservice" class="header-anchor">#</a> 2.3. ExecutorService</h3> <p><code>ExecutorService</code> æ¥å£ç»§æ‰¿äº† <code>Executor</code> æ¥å£ï¼Œå®ƒè¿˜æä¾›äº† <code>invokeAll</code>ã€<code>invokeAny</code>ã€<code>shutdown</code>ã€<code>submit</code> ç­‰æ–¹æ³•ã€‚</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ExecutorService</span> <span class="token keyword">extends</span> <span class="token class-name">Executor</span> <span class="token punctuation">{</span>

    <span class="token keyword">void</span> <span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span> <span class="token function">shutdownNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">boolean</span> <span class="token function">isShutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">boolean</span> <span class="token function">isTerminated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">boolean</span> <span class="token function">awaitTermination</span><span class="token punctuation">(</span><span class="token keyword">long</span> timeout<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">;</span>

    <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">submit</span><span class="token punctuation">(</span><span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> task<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">submit</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> task<span class="token punctuation">,</span> <span class="token class-name">T</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">submit</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> task<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Future</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">invokeAll</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Callable</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> tasks<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">;</span>

    <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Future</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">invokeAll</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Callable</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> tasks<span class="token punctuation">,</span>
                                  <span class="token keyword">long</span> timeout<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">;</span>

    <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">invokeAny</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Callable</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> tasks<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">;</span>

    <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">invokeAny</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Callable</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> tasks<span class="token punctuation">,</span>
                    <span class="token keyword">long</span> timeout<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">TimeoutException</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ä»å…¶æ”¯æŒçš„æ–¹æ³•å®šä¹‰ï¼Œä¸éš¾çœ‹å‡ºï¼šç›¸æ¯”äº <code>Executor</code> æ¥å£ï¼Œ<code>ExecutorService</code> æ¥å£ä¸»è¦çš„æ‰©å±•æ˜¯ï¼š</p> <ul><li>æ”¯æŒæœ‰è¿”å›å€¼çš„çº¿ç¨‹ - <code>sumbit</code>ã€<code>invokeAll</code>ã€<code>invokeAny</code> æ–¹æ³•ä¸­éƒ½æ”¯æŒä¼ å…¥<code>Callable</code> å¯¹è±¡ã€‚</li> <li>æ”¯æŒç®¡ç†çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ - <code>shutdown</code>ã€<code>shutdownNow</code>ã€<code>isShutdown</code> ç­‰æ–¹æ³•ã€‚</li></ul> <h3 id="_2-4-scheduledexecutorservice"><a href="#_2-4-scheduledexecutorservice" class="header-anchor">#</a> 2.4. ScheduledExecutorService</h3> <p><code>ScheduledExecutorService</code> æ¥å£æ‰©å±•äº† <code>ExecutorService</code> æ¥å£ã€‚</p> <p>å®ƒé™¤äº†æ”¯æŒå‰é¢ä¸¤ä¸ªæ¥å£çš„æ‰€æœ‰èƒ½åŠ›ä»¥å¤–ï¼Œè¿˜æ”¯æŒå®šæ—¶è°ƒåº¦çº¿ç¨‹ã€‚</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ScheduledExecutorService</span> <span class="token keyword">extends</span> <span class="token class-name">ExecutorService</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">ScheduledFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">schedule</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> command<span class="token punctuation">,</span>
                                       <span class="token keyword">long</span> delay<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">ScheduledFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token function">schedule</span><span class="token punctuation">(</span><span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> callable<span class="token punctuation">,</span>
                                           <span class="token keyword">long</span> delay<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">ScheduledFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">scheduleAtFixedRate</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> command<span class="token punctuation">,</span>
                                                  <span class="token keyword">long</span> initialDelay<span class="token punctuation">,</span>
                                                  <span class="token keyword">long</span> period<span class="token punctuation">,</span>
                                                  <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">ScheduledFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">scheduleWithFixedDelay</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> command<span class="token punctuation">,</span>
                                                     <span class="token keyword">long</span> initialDelay<span class="token punctuation">,</span>
                                                     <span class="token keyword">long</span> delay<span class="token punctuation">,</span>
                                                     <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><p>å…¶æ‰©å±•çš„æ¥å£æä¾›ä»¥ä¸‹èƒ½åŠ›ï¼š</p> <ul><li><code>schedule</code> æ–¹æ³•å¯ä»¥åœ¨æŒ‡å®šçš„å»¶æ—¶åæ‰§è¡Œä¸€ä¸ª <code>Runnable</code> æˆ–è€… <code>Callable</code> ä»»åŠ¡ã€‚</li> <li><code>scheduleAtFixedRate</code> æ–¹æ³•å’Œ <code>scheduleWithFixedDelay</code> æ–¹æ³•å¯ä»¥æŒ‰ç…§æŒ‡å®šæ—¶é—´é—´éš”ï¼Œå®šæœŸæ‰§è¡Œä»»åŠ¡ã€‚</li></ul> <h2 id="_3-threadpoolexecutor"><a href="#_3-threadpoolexecutor" class="header-anchor">#</a> 3. ThreadPoolExecutor</h2> <p><code>java.uitl.concurrent.ThreadPoolExecutor</code> ç±»æ˜¯ <code>Executor</code> æ¡†æ¶ä¸­æœ€æ ¸å¿ƒçš„ç±»ã€‚æ‰€ä»¥ï¼Œæœ¬æ–‡å°†ç€é‡è®²è¿°ä¸€ä¸‹è¿™ä¸ªç±»ã€‚</p> <h3 id="_3-1-é‡è¦å­—æ®µ"><a href="#_3-1-é‡è¦å­—æ®µ" class="header-anchor">#</a> 3.1. é‡è¦å­—æ®µ</h3> <p><code>ThreadPoolExecutor</code> æœ‰ä»¥ä¸‹é‡è¦å­—æ®µï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">AtomicInteger</span> ctl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token function">ctlOf</span><span class="token punctuation">(</span>RUNNING<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> COUNT_BITS <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span>SIZE <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> CAPACITY   <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> COUNT_BITS<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment">// runState is stored in the high-order bits</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> RUNNING    <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> COUNT_BITS<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> SHUTDOWN   <span class="token operator">=</span>  <span class="token number">0</span> <span class="token operator">&lt;&lt;</span> COUNT_BITS<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> STOP       <span class="token operator">=</span>  <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> COUNT_BITS<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> TIDYING    <span class="token operator">=</span>  <span class="token number">2</span> <span class="token operator">&lt;&lt;</span> COUNT_BITS<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> TERMINATED <span class="token operator">=</span>  <span class="token number">3</span> <span class="token operator">&lt;&lt;</span> COUNT_BITS<span class="token punctuation">;</span>
</code></pre></div><p>å‚æ•°è¯´æ˜ï¼š</p> <ul><li><code>ctl</code> - <strong>ç”¨äºæ§åˆ¶çº¿ç¨‹æ± çš„è¿è¡ŒçŠ¶æ€å’Œçº¿ç¨‹æ± ä¸­çš„æœ‰æ•ˆçº¿ç¨‹æ•°é‡</strong>ã€‚å®ƒåŒ…å«ä¸¤éƒ¨åˆ†çš„ä¿¡æ¯ï¼š
<ul><li>çº¿ç¨‹æ± çš„è¿è¡ŒçŠ¶æ€ (<code>runState</code>)</li> <li>çº¿ç¨‹æ± å†…æœ‰æ•ˆçº¿ç¨‹çš„æ•°é‡ (<code>workerCount</code>)</li> <li>å¯ä»¥çœ‹åˆ°ï¼Œ<code>ctl</code> ä½¿ç”¨äº† <code>Integer</code> ç±»å‹æ¥ä¿å­˜ï¼Œé«˜ 3 ä½ä¿å­˜ <code>runState</code>ï¼Œä½ 29 ä½ä¿å­˜ <code>workerCount</code>ã€‚<code>COUNT_BITS</code> å°±æ˜¯ 29ï¼Œ<code>CAPACITY</code> å°±æ˜¯ 1 å·¦ç§» 29 ä½å‡ 1ï¼ˆ29 ä¸ª 1ï¼‰ï¼Œè¿™ä¸ªå¸¸é‡è¡¨ç¤º <code>workerCount</code> çš„ä¸Šé™å€¼ï¼Œå¤§çº¦æ˜¯ 5 äº¿ã€‚</li></ul></li> <li>è¿è¡ŒçŠ¶æ€ - çº¿ç¨‹æ± ä¸€å…±æœ‰äº”ç§è¿è¡ŒçŠ¶æ€ï¼š
<ul><li><code>RUNNING</code> - <strong>è¿è¡ŒçŠ¶æ€</strong>ã€‚æ¥å—æ–°ä»»åŠ¡ï¼Œå¹¶ä¸”ä¹Ÿèƒ½å¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚</li> <li><code>SHUTDOWN</code> - <strong>å…³é—­çŠ¶æ€</strong>ã€‚ä¸æ¥å—æ–°ä»»åŠ¡ï¼Œä½†å¯ä»¥å¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚
<ul><li>åœ¨çº¿ç¨‹æ± å¤„äº <code>RUNNING</code> çŠ¶æ€æ—¶ï¼Œè°ƒç”¨ <code>shutdown</code> æ–¹æ³•ä¼šä½¿çº¿ç¨‹æ± è¿›å…¥åˆ°è¯¥çŠ¶æ€ã€‚</li> <li><code>finalize</code> æ–¹æ³•åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¹Ÿä¼šè°ƒç”¨ <code>shutdown</code> æ–¹æ³•è¿›å…¥è¯¥çŠ¶æ€ã€‚</li></ul></li> <li><code>STOP</code> - <strong>åœæ­¢çŠ¶æ€</strong>ã€‚ä¸æ¥å—æ–°ä»»åŠ¡ï¼Œä¹Ÿä¸å¤„ç†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚ä¼šä¸­æ–­æ­£åœ¨å¤„ç†ä»»åŠ¡çš„çº¿ç¨‹ã€‚åœ¨çº¿ç¨‹æ± å¤„äº <code>RUNNING</code> æˆ– <code>SHUTDOWN</code> çŠ¶æ€æ—¶ï¼Œè°ƒç”¨ <code>shutdownNow</code> æ–¹æ³•ä¼šä½¿çº¿ç¨‹æ± è¿›å…¥åˆ°è¯¥çŠ¶æ€ã€‚</li> <li><code>TIDYING</code> - <strong>æ•´ç†çŠ¶æ€</strong>ã€‚å¦‚æœæ‰€æœ‰çš„ä»»åŠ¡éƒ½å·²ç»ˆæ­¢äº†ï¼Œ<code>workerCount</code> (æœ‰æ•ˆçº¿ç¨‹æ•°) ä¸º 0ï¼Œçº¿ç¨‹æ± è¿›å…¥è¯¥çŠ¶æ€åä¼šè°ƒç”¨ <code>terminated</code> æ–¹æ³•è¿›å…¥ <code>TERMINATED</code> çŠ¶æ€ã€‚</li> <li><code>TERMINATED</code> - <strong>å·²ç»ˆæ­¢çŠ¶æ€</strong>ã€‚åœ¨ <code>terminated</code> æ–¹æ³•æ‰§è¡Œå®Œåè¿›å…¥è¯¥çŠ¶æ€ã€‚é»˜è®¤ <code>terminated</code> æ–¹æ³•ä¸­ä»€ä¹ˆä¹Ÿæ²¡æœ‰åšã€‚è¿›å…¥ <code>TERMINATED</code> çš„æ¡ä»¶å¦‚ä¸‹ï¼š
<ul><li>çº¿ç¨‹æ± ä¸æ˜¯ <code>RUNNING</code> çŠ¶æ€ï¼›</li> <li>çº¿ç¨‹æ± çŠ¶æ€ä¸æ˜¯ <code>TIDYING</code> çŠ¶æ€æˆ– <code>TERMINATED</code> çŠ¶æ€ï¼›</li> <li>å¦‚æœçº¿ç¨‹æ± çŠ¶æ€æ˜¯ <code>SHUTDOWN</code> å¹¶ä¸” <code>workerQueue</code> ä¸ºç©ºï¼›</li> <li><code>workerCount</code> ä¸º 0ï¼›</li> <li>è®¾ç½® <code>TIDYING</code> çŠ¶æ€æˆåŠŸã€‚</li></ul></li></ul></li></ul> <p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/concurrent/java-thread-pool_2.png" alt="img"></p> <h3 id="_3-2-æ„é€ æ–¹æ³•"><a href="#_3-2-æ„é€ æ–¹æ³•" class="header-anchor">#</a> 3.2. æ„é€ æ–¹æ³•</h3> <p><code>ThreadPoolExecutor</code> æœ‰å››ä¸ªæ„é€ æ–¹æ³•ï¼Œå‰ä¸‰ä¸ªéƒ½æ˜¯åŸºäºç¬¬å››ä¸ªå®ç°ã€‚ç¬¬å››ä¸ªæ„é€ æ–¹æ³•å®šä¹‰å¦‚ä¸‹ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token keyword">int</span> corePoolSize<span class="token punctuation">,</span>
                              <span class="token keyword">int</span> maximumPoolSize<span class="token punctuation">,</span>
                              <span class="token keyword">long</span> keepAliveTime<span class="token punctuation">,</span>
                              <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">,</span>
                              <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span> workQueue<span class="token punctuation">,</span>
                              <span class="token class-name">ThreadFactory</span> threadFactory<span class="token punctuation">,</span>
                              <span class="token class-name">RejectedExecutionHandler</span> handler<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</code></pre></div><p>å‚æ•°è¯´æ˜ï¼š</p> <ul><li><code>corePoolSize</code> - <strong>æ ¸å¿ƒçº¿ç¨‹æ•°é‡</strong>ã€‚å½“æœ‰æ–°ä»»åŠ¡é€šè¿‡ <code>execute</code> æ–¹æ³•æäº¤æ—¶ ï¼Œçº¿ç¨‹æ± ä¼šæ‰§è¡Œä»¥ä¸‹åˆ¤æ–­ï¼š
<ul><li>å¦‚æœè¿è¡Œçš„çº¿ç¨‹æ•°å°‘äº <code>corePoolSize</code>ï¼Œåˆ™åˆ›å»ºæ–°çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ï¼Œå³ä½¿çº¿ç¨‹æ± ä¸­çš„å…¶ä»–çº¿ç¨‹æ˜¯ç©ºé—²çš„ã€‚</li> <li>å¦‚æœçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å¤§äºç­‰äº <code>corePoolSize</code> ä¸”å°äº <code>maximumPoolSize</code>ï¼Œåˆ™åªæœ‰å½“ <code>workQueue</code> æ»¡æ—¶æ‰åˆ›å»ºæ–°çš„çº¿ç¨‹å»å¤„ç†ä»»åŠ¡ï¼›</li> <li>å¦‚æœè®¾ç½®çš„ <code>corePoolSize</code> å’Œ <code>maximumPoolSize</code> ç›¸åŒï¼Œåˆ™åˆ›å»ºçš„çº¿ç¨‹æ± çš„å¤§å°æ˜¯å›ºå®šçš„ã€‚è¿™æ—¶å¦‚æœæœ‰æ–°ä»»åŠ¡æäº¤ï¼Œè‹¥ <code>workQueue</code> æœªæ»¡ï¼Œåˆ™å°†è¯·æ±‚æ”¾å…¥ <code>workQueue</code> ä¸­ï¼Œç­‰å¾…æœ‰ç©ºé—²çš„çº¿ç¨‹å»ä» <code>workQueue</code> ä¸­å–ä»»åŠ¡å¹¶å¤„ç†ï¼›</li> <li>å¦‚æœè¿è¡Œçš„çº¿ç¨‹æ•°é‡å¤§äºç­‰äº <code>maximumPoolSize</code>ï¼Œè¿™æ—¶å¦‚æœ <code>workQueue</code> å·²ç»æ»¡äº†ï¼Œåˆ™ä½¿ç”¨ <code>handler</code> æ‰€æŒ‡å®šçš„ç­–ç•¥æ¥å¤„ç†ä»»åŠ¡ï¼›</li> <li>æ‰€ä»¥ï¼Œä»»åŠ¡æäº¤æ—¶ï¼Œåˆ¤æ–­çš„é¡ºåºä¸º <code>corePoolSize</code> =&gt; <code>workQueue</code> =&gt; <code>maximumPoolSize</code>ã€‚</li></ul></li> <li><code>maximumPoolSize</code> - <strong>æœ€å¤§çº¿ç¨‹æ•°é‡</strong>ã€‚
<ul><li>å¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼Œå¹¶ä¸”å·²åˆ›å»ºçš„çº¿ç¨‹æ•°å°äºæœ€å¤§çº¿ç¨‹æ•°ï¼Œåˆ™çº¿ç¨‹æ± ä¼šå†åˆ›å»ºæ–°çš„çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ã€‚</li> <li>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼šå¦‚æœä½¿ç”¨äº†æ— ç•Œçš„ä»»åŠ¡é˜Ÿåˆ—è¿™ä¸ªå‚æ•°å°±æ²¡ä»€ä¹ˆæ•ˆæœã€‚</li></ul></li> <li><code>keepAliveTime</code>ï¼š<strong>çº¿ç¨‹ä¿æŒæ´»åŠ¨çš„æ—¶é—´</strong>ã€‚
<ul><li>å½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å¤§äº <code>corePoolSize</code> çš„æ—¶å€™ï¼Œå¦‚æœè¿™æ—¶æ²¡æœ‰æ–°çš„ä»»åŠ¡æäº¤ï¼Œæ ¸å¿ƒçº¿ç¨‹å¤–çš„çº¿ç¨‹ä¸ä¼šç«‹å³é”€æ¯ï¼Œè€Œæ˜¯ä¼šç­‰å¾…ï¼Œç›´åˆ°ç­‰å¾…çš„æ—¶é—´è¶…è¿‡äº† <code>keepAliveTime</code>ã€‚</li> <li>æ‰€ä»¥ï¼Œå¦‚æœä»»åŠ¡å¾ˆå¤šï¼Œå¹¶ä¸”æ¯ä¸ªä»»åŠ¡æ‰§è¡Œçš„æ—¶é—´æ¯”è¾ƒçŸ­ï¼Œå¯ä»¥è°ƒå¤§è¿™ä¸ªæ—¶é—´ï¼Œæé«˜çº¿ç¨‹çš„åˆ©ç”¨ç‡ã€‚</li></ul></li> <li><code>unit</code> - <strong><code>keepAliveTime</code> çš„æ—¶é—´å•ä½</strong>ã€‚æœ‰ 7 ç§å–å€¼ã€‚å¯é€‰çš„å•ä½æœ‰å¤©ï¼ˆDAYSï¼‰ï¼Œå°æ—¶ï¼ˆHOURSï¼‰ï¼Œåˆ†é’Ÿï¼ˆMINUTESï¼‰ï¼Œæ¯«ç§’(MILLISECONDS)ï¼Œå¾®ç§’(MICROSECONDS, åƒåˆ†ä¹‹ä¸€æ¯«ç§’)å’Œæ¯«å¾®ç§’(NANOSECONDS, åƒåˆ†ä¹‹ä¸€å¾®ç§’)ã€‚</li> <li><code>workQueue</code> - <strong>ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡é˜Ÿåˆ—</strong>ã€‚ç”¨äºä¿å­˜ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡çš„é˜»å¡é˜Ÿåˆ—ã€‚ å¯ä»¥é€‰æ‹©ä»¥ä¸‹å‡ ä¸ªé˜»å¡é˜Ÿåˆ—ã€‚
<ul><li><code>ArrayBlockingQueue</code> - <strong>æœ‰ç•Œé˜»å¡é˜Ÿåˆ—</strong>ã€‚
<ul><li>æ­¤é˜Ÿåˆ—æ˜¯<strong>åŸºäºæ•°ç»„çš„å…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—ï¼ˆFIFOï¼‰</strong>ã€‚</li> <li>æ­¤é˜Ÿåˆ—åˆ›å»ºæ—¶å¿…é¡»æŒ‡å®šå¤§å°ã€‚</li></ul></li> <li><code>LinkedBlockingQueue</code> - <strong>æ— ç•Œé˜»å¡é˜Ÿåˆ—</strong>ã€‚
<ul><li>æ­¤é˜Ÿåˆ—æ˜¯<strong>åŸºäºé“¾è¡¨çš„å…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—ï¼ˆFIFOï¼‰</strong>ã€‚</li> <li>å¦‚æœåˆ›å»ºæ—¶æ²¡æœ‰æŒ‡å®šæ­¤é˜Ÿåˆ—å¤§å°ï¼Œåˆ™é»˜è®¤ä¸º <code>Integer.MAX_VALUE</code>ã€‚</li> <li>ååé‡é€šå¸¸è¦é«˜äº <code>ArrayBlockingQueue</code>ã€‚</li> <li>ä½¿ç”¨ <code>LinkedBlockingQueue</code> æ„å‘³ç€ï¼š <code>maximumPoolSize</code> å°†ä¸èµ·ä½œç”¨ï¼Œçº¿ç¨‹æ± èƒ½åˆ›å»ºçš„æœ€å¤§çº¿ç¨‹æ•°ä¸º <code>corePoolSize</code>ï¼Œå› ä¸ºä»»åŠ¡ç­‰å¾…é˜Ÿåˆ—æ˜¯æ— ç•Œé˜Ÿåˆ—ã€‚</li> <li><code>Executors.newFixedThreadPool</code> ä½¿ç”¨äº†è¿™ä¸ªé˜Ÿåˆ—ã€‚</li></ul></li> <li><code>SynchronousQueue</code> - <strong>ä¸ä¼šä¿å­˜æäº¤çš„ä»»åŠ¡ï¼Œè€Œæ˜¯å°†ç›´æ¥æ–°å»ºä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œæ–°æ¥çš„ä»»åŠ¡</strong>ã€‚
<ul><li>æ¯ä¸ªæ’å…¥æ“ä½œå¿…é¡»ç­‰åˆ°å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ç§»é™¤æ“ä½œï¼Œå¦åˆ™æ’å…¥æ“ä½œä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ã€‚</li> <li>ååé‡é€šå¸¸è¦é«˜äº <code>LinkedBlockingQueue</code>ã€‚</li> <li><code>Executors.newCachedThreadPool</code> ä½¿ç”¨äº†è¿™ä¸ªé˜Ÿåˆ—ã€‚</li></ul></li> <li><code>PriorityBlockingQueue</code> - <strong>å…·æœ‰ä¼˜å…ˆçº§çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—</strong>ã€‚</li></ul></li> <li><code>threadFactory</code> - <strong>çº¿ç¨‹å·¥å‚</strong>ã€‚å¯ä»¥é€šè¿‡çº¿ç¨‹å·¥å‚ç»™æ¯ä¸ªåˆ›å»ºå‡ºæ¥çš„çº¿ç¨‹è®¾ç½®æ›´æœ‰æ„ä¹‰çš„åå­—ã€‚</li> <li><code>handler</code> - <strong>é¥±å’Œç­–ç•¥</strong>ã€‚å®ƒæ˜¯ <code>RejectedExecutionHandler</code> ç±»å‹çš„å˜é‡ã€‚å½“é˜Ÿåˆ—å’Œçº¿ç¨‹æ± éƒ½æ»¡äº†ï¼Œè¯´æ˜çº¿ç¨‹æ± å¤„äºé¥±å’ŒçŠ¶æ€ï¼Œé‚£ä¹ˆå¿…é¡»é‡‡å–ä¸€ç§ç­–ç•¥å¤„ç†æäº¤çš„æ–°ä»»åŠ¡ã€‚çº¿ç¨‹æ± æ”¯æŒä»¥ä¸‹ç­–ç•¥ï¼š
<ul><li><code>AbortPolicy</code> - ä¸¢å¼ƒä»»åŠ¡å¹¶æŠ›å‡ºå¼‚å¸¸ã€‚è¿™ä¹Ÿæ˜¯é»˜è®¤ç­–ç•¥ã€‚</li> <li><code>DiscardPolicy</code> - ä¸¢å¼ƒä»»åŠ¡ï¼Œä½†ä¸æŠ›å‡ºå¼‚å¸¸ã€‚</li> <li><code>DiscardOldestPolicy</code> - ä¸¢å¼ƒé˜Ÿåˆ—æœ€å‰é¢çš„ä»»åŠ¡ï¼Œç„¶åé‡æ–°å°è¯•æ‰§è¡Œä»»åŠ¡ï¼ˆé‡å¤æ­¤è¿‡ç¨‹ï¼‰ã€‚</li> <li><code>CallerRunsPolicy</code> - ç›´æ¥è°ƒç”¨ <code>run</code> æ–¹æ³•å¹¶ä¸”é˜»å¡æ‰§è¡Œã€‚</li> <li>å¦‚æœä»¥ä¸Šç­–ç•¥éƒ½ä¸èƒ½æ»¡è¶³éœ€è¦ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å®ç° <code>RejectedExecutionHandler</code> æ¥å£æ¥å®šåˆ¶å¤„ç†ç­–ç•¥ã€‚å¦‚è®°å½•æ—¥å¿—æˆ–æŒä¹…åŒ–ä¸èƒ½å¤„ç†çš„ä»»åŠ¡ã€‚</li></ul></li></ul> <h3 id="_3-3-execute-æ–¹æ³•"><a href="#_3-3-execute-æ–¹æ³•" class="header-anchor">#</a> 3.3. execute æ–¹æ³•</h3> <p>é»˜è®¤æƒ…å†µä¸‹ï¼Œåˆ›å»ºçº¿ç¨‹æ± ä¹‹åï¼Œçº¿ç¨‹æ± ä¸­æ˜¯æ²¡æœ‰çº¿ç¨‹çš„ï¼Œéœ€è¦æäº¤ä»»åŠ¡ä¹‹åæ‰ä¼šåˆ›å»ºçº¿ç¨‹ã€‚</p> <p>æäº¤ä»»åŠ¡å¯ä»¥ä½¿ç”¨ <code>execute</code> æ–¹æ³•ï¼Œå®ƒæ˜¯ <code>ThreadPoolExecutor</code> çš„æ ¸å¿ƒæ–¹æ³•ï¼Œé€šè¿‡è¿™ä¸ªæ–¹æ³•å¯ä»¥<strong>å‘çº¿ç¨‹æ± æäº¤ä¸€ä¸ªä»»åŠ¡ï¼Œäº¤ç”±çº¿ç¨‹æ± å»æ‰§è¡Œ</strong>ã€‚</p> <p><code>execute</code> æ–¹æ³•å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š</p> <ol><li>å¦‚æœ <code>workerCount &lt; corePoolSize</code>ï¼Œåˆ™åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œæ–°æäº¤çš„ä»»åŠ¡ï¼›</li> <li>å¦‚æœ <code>workerCount &gt;= corePoolSize</code>ï¼Œä¸”çº¿ç¨‹æ± å†…çš„é˜»å¡é˜Ÿåˆ—æœªæ»¡ï¼Œåˆ™å°†ä»»åŠ¡æ·»åŠ åˆ°è¯¥é˜»å¡é˜Ÿåˆ—ä¸­ï¼›</li> <li>å¦‚æœ <code>workerCount &gt;= corePoolSize &amp;&amp; workerCount &lt; maximumPoolSize</code>ï¼Œä¸”çº¿ç¨‹æ± å†…çš„é˜»å¡é˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œæ–°æäº¤çš„ä»»åŠ¡ï¼›</li> <li>å¦‚æœ<code>workerCount &gt;= maximumPoolSize</code>ï¼Œå¹¶ä¸”çº¿ç¨‹æ± å†…çš„é˜»å¡é˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™æ ¹æ®æ‹’ç»ç­–ç•¥æ¥å¤„ç†è¯¥ä»»åŠ¡, é»˜è®¤çš„å¤„ç†æ–¹å¼æ˜¯ç›´æ¥æŠ›å¼‚å¸¸ã€‚</li></ol> <p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/concurrent/java-thread-pool_1.png" alt="img"></p> <h3 id="_3-4-å…¶ä»–é‡è¦æ–¹æ³•"><a href="#_3-4-å…¶ä»–é‡è¦æ–¹æ³•" class="header-anchor">#</a> 3.4. å…¶ä»–é‡è¦æ–¹æ³•</h3> <p>åœ¨ <code>ThreadPoolExecutor</code> ç±»ä¸­è¿˜æœ‰ä¸€äº›é‡è¦çš„æ–¹æ³•ï¼š</p> <ul><li><code>submit</code> - ç±»ä¼¼äº <code>execute</code>ï¼Œä½†æ˜¯é’ˆå¯¹çš„æ˜¯æœ‰è¿”å›å€¼çš„çº¿ç¨‹ã€‚<code>submit</code> æ–¹æ³•æ˜¯åœ¨ <code>ExecutorService</code> ä¸­å£°æ˜çš„æ–¹æ³•ï¼Œåœ¨ <code>AbstractExecutorService</code> å°±å·²ç»æœ‰äº†å…·ä½“çš„å®ç°ã€‚<code>ThreadPoolExecutor</code> ç›´æ¥å¤ç”¨ <code>AbstractExecutorService</code> çš„ <code>submit</code> æ–¹æ³•ã€‚</li> <li><code>shutdown</code> - ä¸ä¼šç«‹å³ç»ˆæ­¢çº¿ç¨‹æ± ï¼Œè€Œæ˜¯è¦ç­‰æ‰€æœ‰ä»»åŠ¡ç¼“å­˜é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡éƒ½æ‰§è¡Œå®Œåæ‰ç»ˆæ­¢ï¼Œä½†å†ä¹Ÿä¸ä¼šæ¥å—æ–°çš„ä»»åŠ¡ã€‚
<ul><li>å°†çº¿ç¨‹æ± åˆ‡æ¢åˆ° <code>SHUTDOWN</code> çŠ¶æ€ï¼›</li> <li>å¹¶è°ƒç”¨ <code>interruptIdleWorkers</code> æ–¹æ³•è¯·æ±‚ä¸­æ–­æ‰€æœ‰ç©ºé—²çš„ workerï¼›</li> <li>æœ€åè°ƒç”¨ <code>tryTerminate</code> å°è¯•ç»“æŸçº¿ç¨‹æ± ã€‚</li></ul></li> <li><code>shutdownNow</code> - ç«‹å³ç»ˆæ­¢çº¿ç¨‹æ± ï¼Œå¹¶å°è¯•æ‰“æ–­æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¹¶ä¸”æ¸…ç©ºä»»åŠ¡ç¼“å­˜é˜Ÿåˆ—ï¼Œè¿”å›å°šæœªæ‰§è¡Œçš„ä»»åŠ¡ã€‚ä¸ <code>shutdown</code> æ–¹æ³•ç±»ä¼¼ï¼Œä¸åŒçš„åœ°æ–¹åœ¨äºï¼š
<ul><li>è®¾ç½®çŠ¶æ€ä¸º <code>STOP</code>ï¼›</li> <li>ä¸­æ–­æ‰€æœ‰å·¥ä½œçº¿ç¨‹ï¼Œæ— è®ºæ˜¯å¦æ˜¯ç©ºé—²çš„ï¼›</li> <li>å–å‡ºé˜»å¡é˜Ÿåˆ—ä¸­æ²¡æœ‰è¢«æ‰§è¡Œçš„ä»»åŠ¡å¹¶è¿”å›ã€‚</li></ul></li> <li><code>isShutdown</code> - è°ƒç”¨äº† <code>shutdown</code> æˆ– <code>shutdownNow</code> æ–¹æ³•åï¼Œ<code>isShutdown</code> æ–¹æ³•å°±ä¼šè¿”å› trueã€‚</li> <li><code>isTerminaed</code> - å½“æ‰€æœ‰çš„ä»»åŠ¡éƒ½å·²å…³é—­åï¼Œæ‰è¡¨ç¤ºçº¿ç¨‹æ± å…³é—­æˆåŠŸï¼Œè¿™æ—¶è°ƒç”¨ <code>isTerminaed</code> æ–¹æ³•ä¼šè¿”å› trueã€‚</li> <li><code>setCorePoolSize</code> - è®¾ç½®æ ¸å¿ƒçº¿ç¨‹æ•°å¤§å°ã€‚</li> <li><code>setMaximumPoolSize</code> - è®¾ç½®æœ€å¤§çº¿ç¨‹æ•°å¤§å°ã€‚</li> <li><code>getTaskCount</code> - çº¿ç¨‹æ± å·²ç»æ‰§è¡Œçš„å’Œæœªæ‰§è¡Œçš„ä»»åŠ¡æ€»æ•°ï¼›</li> <li><code>getCompletedTaskCount</code> - çº¿ç¨‹æ± å·²å®Œæˆçš„ä»»åŠ¡æ•°é‡ï¼Œè¯¥å€¼å°äºç­‰äº <code>taskCount</code>ï¼›</li> <li><code>getLargestPoolSize</code> - çº¿ç¨‹æ± æ›¾ç»åˆ›å»ºè¿‡çš„æœ€å¤§çº¿ç¨‹æ•°é‡ã€‚é€šè¿‡è¿™ä¸ªæ•°æ®å¯ä»¥çŸ¥é“çº¿ç¨‹æ± æ˜¯å¦æ»¡è¿‡ï¼Œä¹Ÿå°±æ˜¯è¾¾åˆ°äº† <code>maximumPoolSize</code>ï¼›</li> <li><code>getPoolSize</code> - çº¿ç¨‹æ± å½“å‰çš„çº¿ç¨‹æ•°é‡ï¼›</li> <li><code>getActiveCount</code> - å½“å‰çº¿ç¨‹æ± ä¸­æ­£åœ¨æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹æ•°é‡ã€‚</li></ul> <h3 id="_3-5-ä½¿ç”¨ç¤ºä¾‹"><a href="#_3-5-ä½¿ç”¨ç¤ºä¾‹" class="header-anchor">#</a> 3.5. ä½¿ç”¨ç¤ºä¾‹</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadPoolExecutorDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ThreadPoolExecutor</span> threadPoolExecutor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">defaultThreadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor<span class="token punctuation">.</span>AbortPolicy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            threadPoolExecutor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> info <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°ç›®ï¼š%sï¼Œé˜Ÿåˆ—ä¸­ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡æ•°ç›®ï¼š%sï¼Œå·²æ‰§è¡Œç©åˆ«çš„ä»»åŠ¡æ•°ç›®ï¼š%s&quot;</span><span class="token punctuation">,</span>
                threadPoolExecutor<span class="token punctuation">.</span><span class="token function">getPoolSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                threadPoolExecutor<span class="token punctuation">.</span><span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                threadPoolExecutor<span class="token punctuation">.</span><span class="token function">getCompletedTaskCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        threadPoolExecutor<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; æ‰§è¡Œ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h2 id="_4-executors"><a href="#_4-executors" class="header-anchor">#</a> 4. Executors</h2> <p>JDK çš„ <code>Executors</code> ç±»ä¸­æä¾›äº†å‡ ç§å…·æœ‰ä»£è¡¨æ€§çš„çº¿ç¨‹æ± ï¼Œè¿™äº›çº¿ç¨‹æ±  <strong>éƒ½æ˜¯åŸºäº <code>ThreadPoolExecutor</code> çš„å®šåˆ¶åŒ–å®ç°</strong>ã€‚</p> <p>åœ¨å®é™…ä½¿ç”¨çº¿ç¨‹æ± çš„åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€ä¸æ˜¯ç›´æ¥ä½¿ç”¨ <code>ThreadPoolExecutor</code> ï¼Œè€Œæ˜¯ä½¿ç”¨ JDK ä¸­æä¾›çš„å…·æœ‰ä»£è¡¨æ€§çš„çº¿ç¨‹æ± å®ä¾‹ã€‚</p> <h3 id="_4-1-newsinglethreadexecutor"><a href="#_4-1-newsinglethreadexecutor" class="header-anchor">#</a> 4.1. newSingleThreadExecutor</h3> <p><strong>åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹çš„çº¿ç¨‹æ± </strong>ã€‚</p> <p>åªä¼šåˆ›å»ºå”¯ä¸€çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œä¿è¯æ‰€æœ‰ä»»åŠ¡æŒ‰ç…§æŒ‡å®šé¡ºåº(FIFO, LIFO, ä¼˜å…ˆçº§)æ‰§è¡Œã€‚ <strong>å¦‚æœè¿™ä¸ªå”¯ä¸€çš„çº¿ç¨‹å› ä¸ºå¼‚å¸¸ç»“æŸï¼Œé‚£ä¹ˆä¼šæœ‰ä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¥æ›¿ä»£å®ƒ</strong> ã€‚</p> <p>å•å·¥ä½œçº¿ç¨‹æœ€å¤§çš„ç‰¹ç‚¹æ˜¯ï¼š<strong>å¯ä¿è¯é¡ºåºåœ°æ‰§è¡Œå„ä¸ªä»»åŠ¡</strong>ã€‚</p> <p>ç¤ºä¾‹ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SingleThreadExecutorDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newSingleThreadExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            executorService<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; æ‰§è¡Œ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        executorService<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="_4-2-newfixedthreadpool"><a href="#_4-2-newfixedthreadpool" class="header-anchor">#</a> 4.2. newFixedThreadPool</h3> <p><strong>åˆ›å»ºä¸€ä¸ªå›ºå®šå¤§å°çš„çº¿ç¨‹æ± </strong>ã€‚</p> <p><strong>æ¯æ¬¡æäº¤ä¸€ä¸ªä»»åŠ¡å°±ä¼šæ–°åˆ›å»ºä¸€ä¸ªå·¥ä½œçº¿ç¨‹ï¼Œå¦‚æœå·¥ä½œçº¿ç¨‹æ•°é‡è¾¾åˆ°çº¿ç¨‹æ± æœ€å¤§çº¿ç¨‹æ•°ï¼Œåˆ™å°†æäº¤çš„ä»»åŠ¡å­˜å…¥åˆ°é˜»å¡é˜Ÿåˆ—ä¸­</strong>ã€‚</p> <p><code>FixedThreadPool</code> æ˜¯ä¸€ä¸ªå…¸å‹ä¸”ä¼˜ç§€çš„çº¿ç¨‹æ± ï¼Œå®ƒå…·æœ‰çº¿ç¨‹æ± æé«˜ç¨‹åºæ•ˆç‡å’ŒèŠ‚çœåˆ›å»ºçº¿ç¨‹æ—¶æ‰€è€—çš„å¼€é”€çš„ä¼˜ç‚¹ã€‚ä½†æ˜¯ï¼Œåœ¨çº¿ç¨‹æ± ç©ºé—²æ—¶ï¼Œå³çº¿ç¨‹æ± ä¸­æ²¡æœ‰å¯è¿è¡Œä»»åŠ¡æ—¶ï¼Œå®ƒä¸ä¼šé‡Šæ”¾å·¥ä½œçº¿ç¨‹ï¼Œè¿˜ä¼šå ç”¨ä¸€å®šçš„ç³»ç»Ÿèµ„æºã€‚</p> <p>ç¤ºä¾‹ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FixedThreadPoolDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            executorService<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; æ‰§è¡Œ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        executorService<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="_4-3-newcachedthreadpool"><a href="#_4-3-newcachedthreadpool" class="header-anchor">#</a> 4.3. newCachedThreadPool</h3> <p><strong>åˆ›å»ºä¸€ä¸ªå¯ç¼“å­˜çš„çº¿ç¨‹æ± </strong>ã€‚</p> <ul><li>å¦‚æœçº¿ç¨‹æ± å¤§å°è¶…è¿‡å¤„ç†ä»»åŠ¡æ‰€éœ€è¦çš„çº¿ç¨‹æ•°ï¼Œå°±ä¼šå›æ”¶éƒ¨åˆ†ç©ºé—²çš„çº¿ç¨‹ï¼›</li> <li>å¦‚æœé•¿æ—¶é—´æ²¡æœ‰å¾€çº¿ç¨‹æ± ä¸­æäº¤ä»»åŠ¡ï¼Œå³å¦‚æœå·¥ä½œçº¿ç¨‹ç©ºé—²äº†æŒ‡å®šçš„æ—¶é—´ï¼ˆé»˜è®¤ä¸º 1 åˆ†é’Ÿï¼‰ï¼Œåˆ™è¯¥å·¥ä½œçº¿ç¨‹å°†è‡ªåŠ¨ç»ˆæ­¢ã€‚ç»ˆæ­¢åï¼Œå¦‚æœä½ åˆæäº¤äº†æ–°çš„ä»»åŠ¡ï¼Œåˆ™çº¿ç¨‹æ± é‡æ–°åˆ›å»ºä¸€ä¸ªå·¥ä½œçº¿ç¨‹ã€‚</li> <li>æ­¤çº¿ç¨‹æ± ä¸ä¼šå¯¹çº¿ç¨‹æ± å¤§å°åšé™åˆ¶ï¼Œçº¿ç¨‹æ± å¤§å°å®Œå…¨ä¾èµ–äºæ“ä½œç³»ç»Ÿï¼ˆæˆ–è€…è¯´ JVMï¼‰èƒ½å¤Ÿåˆ›å»ºçš„æœ€å¤§çº¿ç¨‹å¤§å°ã€‚ å› æ­¤ï¼Œä½¿ç”¨ <code>CachedThreadPool</code> æ—¶ï¼Œä¸€å®šè¦æ³¨æ„æ§åˆ¶ä»»åŠ¡çš„æ•°é‡ï¼Œå¦åˆ™ï¼Œç”±äºå¤§é‡çº¿ç¨‹åŒæ—¶è¿è¡Œï¼Œå¾ˆæœ‰ä¼šé€ æˆç³»ç»Ÿç˜«ç—ªã€‚</li></ul> <p>ç¤ºä¾‹ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CachedThreadPoolDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            executorService<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; æ‰§è¡Œ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        executorService<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="_4-4-newschedulethreadpool"><a href="#_4-4-newschedulethreadpool" class="header-anchor">#</a> 4.4. newScheduleThreadPool</h3> <p>åˆ›å»ºä¸€ä¸ªå¤§å°æ— é™çš„çº¿ç¨‹æ± ã€‚æ­¤çº¿ç¨‹æ± æ”¯æŒå®šæ—¶ä»¥åŠå‘¨æœŸæ€§æ‰§è¡Œä»»åŠ¡çš„éœ€æ±‚ã€‚</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ScheduledThreadPoolDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">schedule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">scheduleAtFixedRate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">schedule</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ScheduledExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newScheduledThreadPool</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            executorService<span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; æ‰§è¡Œ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        executorService<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">scheduleAtFixedRate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ScheduledExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newScheduledThreadPool</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            executorService<span class="token punctuation">.</span><span class="token function">scheduleAtFixedRate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; æ‰§è¡Œ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        executorService<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="_4-5-newworkstealingpool"><a href="#_4-5-newworkstealingpool" class="header-anchor">#</a> 4.5. newWorkStealingPool</h3> <p>Java 8 æ‰å¼•å…¥ã€‚</p> <p>å…¶å†…éƒ¨ä¼šæ„å»º <code>ForkJoinPool</code>ï¼Œåˆ©ç”¨ <a href="https://en.wikipedia.org/wiki/Work_stealing" target="_blank" rel="noopener noreferrer">Work-Stealing<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ç®—æ³•ï¼Œå¹¶è¡Œåœ°å¤„ç†ä»»åŠ¡ï¼Œä¸ä¿è¯å¤„ç†é¡ºåºã€‚</p> <h2 id="_5-çº¿ç¨‹æ± æœ€ä½³å®è·µ"><a href="#_5-çº¿ç¨‹æ± æœ€ä½³å®è·µ" class="header-anchor">#</a> 5. çº¿ç¨‹æ± æœ€ä½³å®è·µ</h2> <h3 id="_5-1-è®¡ç®—çº¿ç¨‹æ•°é‡"><a href="#_5-1-è®¡ç®—çº¿ç¨‹æ•°é‡" class="header-anchor">#</a> 5.1. è®¡ç®—çº¿ç¨‹æ•°é‡</h3> <p>ä¸€èˆ¬å¤šçº¿ç¨‹æ‰§è¡Œçš„ä»»åŠ¡ç±»å‹å¯ä»¥åˆ†ä¸º CPU å¯†é›†å‹å’Œ I/O å¯†é›†å‹ï¼Œæ ¹æ®ä¸åŒçš„ä»»åŠ¡ç±»å‹ï¼Œæˆ‘ä»¬è®¡ç®—çº¿ç¨‹æ•°çš„æ–¹æ³•ä¹Ÿä¸ä¸€æ ·ã€‚</p> <p>**CPU å¯†é›†å‹ä»»åŠ¡ï¼š**è¿™ç§ä»»åŠ¡æ¶ˆè€—çš„ä¸»è¦æ˜¯ CPU èµ„æºï¼Œå¯ä»¥å°†çº¿ç¨‹æ•°è®¾ç½®ä¸º Nï¼ˆCPU æ ¸å¿ƒæ•°ï¼‰+1ï¼Œæ¯” CPU æ ¸å¿ƒæ•°å¤šå‡ºæ¥çš„ä¸€ä¸ªçº¿ç¨‹æ˜¯ä¸ºäº†é˜²æ­¢çº¿ç¨‹å¶å‘çš„ç¼ºé¡µä¸­æ–­ï¼Œæˆ–è€…å…¶å®ƒåŸå› å¯¼è‡´çš„ä»»åŠ¡æš‚åœè€Œå¸¦æ¥çš„å½±å“ã€‚ä¸€æ—¦ä»»åŠ¡æš‚åœï¼ŒCPU å°±ä¼šå¤„äºç©ºé—²çŠ¶æ€ï¼Œè€Œåœ¨è¿™ç§æƒ…å†µä¸‹å¤šå‡ºæ¥çš„ä¸€ä¸ªçº¿ç¨‹å°±å¯ä»¥å……åˆ†åˆ©ç”¨ CPU çš„ç©ºé—²æ—¶é—´ã€‚</p> <p>**I/O å¯†é›†å‹ä»»åŠ¡ï¼š**è¿™ç§ä»»åŠ¡åº”ç”¨èµ·æ¥ï¼Œç³»ç»Ÿä¼šç”¨å¤§éƒ¨åˆ†çš„æ—¶é—´æ¥å¤„ç† I/O äº¤äº’ï¼Œè€Œçº¿ç¨‹åœ¨å¤„ç† I/O çš„æ—¶é—´æ®µå†…ä¸ä¼šå ç”¨ CPU æ¥å¤„ç†ï¼Œè¿™æ—¶å°±å¯ä»¥å°† CPU äº¤å‡ºç»™å…¶å®ƒçº¿ç¨‹ä½¿ç”¨ã€‚å› æ­¤åœ¨ I/O å¯†é›†å‹ä»»åŠ¡çš„åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¤šé…ç½®ä¸€äº›çº¿ç¨‹ï¼Œå…·ä½“çš„è®¡ç®—æ–¹æ³•æ˜¯ 2Nã€‚</p> <h3 id="_5-2-å»ºè®®ä½¿ç”¨æœ‰ç•Œé˜»å¡é˜Ÿåˆ—"><a href="#_5-2-å»ºè®®ä½¿ç”¨æœ‰ç•Œé˜»å¡é˜Ÿåˆ—" class="header-anchor">#</a> 5.2. å»ºè®®ä½¿ç”¨æœ‰ç•Œé˜»å¡é˜Ÿåˆ—</h3> <p>ä¸å»ºè®®ä½¿ç”¨ <code>Executors</code> çš„æœ€é‡è¦çš„åŸå› æ˜¯ï¼š<code>Executors</code> æä¾›çš„å¾ˆå¤šæ–¹æ³•é»˜è®¤ä½¿ç”¨çš„éƒ½æ˜¯æ— ç•Œçš„ <code>LinkedBlockingQueue</code>ï¼Œé«˜è´Ÿè½½æƒ…å¢ƒä¸‹ï¼Œæ— ç•Œé˜Ÿåˆ—å¾ˆå®¹æ˜“å¯¼è‡´ OOMï¼Œè€Œ OOM ä¼šå¯¼è‡´æ‰€æœ‰è¯·æ±‚éƒ½æ— æ³•å¤„ç†ï¼Œè¿™æ˜¯è‡´å‘½é—®é¢˜ã€‚æ‰€ä»¥<strong>å¼ºçƒˆå»ºè®®ä½¿ç”¨æœ‰ç•Œé˜Ÿåˆ—</strong>ã€‚</p> <p>ã€Šé˜¿é‡Œå·´å·´ Java å¼€å‘æ‰‹å†Œã€‹ä¸­æåˆ°ï¼Œç¦æ­¢ä½¿ç”¨è¿™äº›æ–¹æ³•æ¥åˆ›å»ºçº¿ç¨‹æ± ï¼Œè€Œåº”è¯¥æ‰‹åŠ¨ <code>new ThreadPoolExecutor</code> æ¥åˆ›å»ºçº¿ç¨‹æ± ã€‚åˆ¶è®¢è¿™æ¡è§„åˆ™æ˜¯å› ä¸ºå®¹æ˜“å¯¼è‡´ç”Ÿäº§äº‹æ•…ï¼Œæœ€å…¸å‹çš„å°±æ˜¯ <code>newFixedThreadPool</code> å’Œ <code>newCachedThreadPool</code>ï¼Œå¯èƒ½å› ä¸ºèµ„æºè€—å°½å¯¼è‡´ OOM é—®é¢˜ã€‚</p> <p>ã€ç¤ºä¾‹ã€‘<code>newFixedThreadPool</code> OOM</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ThreadPoolExecutor</span> threadPool <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">)</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">printStats</span><span class="token punctuation">(</span>threadPool<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100000000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	threadPool<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
		<span class="token class-name">String</span> payload <span class="token operator">=</span> <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">rangeClosed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1000000</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">mapToObj</span><span class="token punctuation">(</span>__ <span class="token operator">-&gt;</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">joining</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			<span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>HOURS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token punctuation">}</span>
		log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

threadPool<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
threadPool<span class="token punctuation">.</span><span class="token function">awaitTermination</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>HOURS<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>newFixedThreadPool</code> ä½¿ç”¨çš„å·¥ä½œé˜Ÿåˆ—æ˜¯ <code>LinkedBlockingQueue</code> ï¼Œè€Œé»˜è®¤æ„é€ æ–¹æ³•çš„ <code>LinkedBlockingQueue</code> æ˜¯ä¸€ä¸ª <code>Integer.MAX_VALUE</code> é•¿åº¦çš„é˜Ÿåˆ—ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯æ— ç•Œçš„ã€‚å¦‚æœä»»åŠ¡è¾ƒå¤šå¹¶ä¸”æ‰§è¡Œè¾ƒæ…¢çš„è¯ï¼Œé˜Ÿåˆ—å¯èƒ½ä¼šå¿«é€Ÿç§¯å‹ï¼Œæ’‘çˆ†å†…å­˜å¯¼è‡´ OOMã€‚</p> <p>ã€ç¤ºä¾‹ã€‘<code>newCachedThreadPool</code> OOM</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ThreadPoolExecutor</span> threadPool <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">)</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">printStats</span><span class="token punctuation">(</span>threadPool<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100000000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	threadPool<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
		<span class="token class-name">String</span> payload <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			<span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>HOURS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token punctuation">}</span>
		log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
threadPool<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
threadPool<span class="token punctuation">.</span><span class="token function">awaitTermination</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>HOURS<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>newCachedThreadPool</code> çš„æœ€å¤§çº¿ç¨‹æ•°æ˜¯ <code>Integer.MAX_VALUE</code>ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯æ²¡æœ‰ä¸Šé™çš„ï¼Œè€Œå…¶å·¥ä½œé˜Ÿåˆ— <code>SynchronousQueue</code> æ˜¯ä¸€ä¸ªæ²¡æœ‰å­˜å‚¨ç©ºé—´çš„é˜»å¡é˜Ÿåˆ—ã€‚è¿™æ„å‘³ç€ï¼Œåªè¦æœ‰è¯·æ±‚åˆ°æ¥ï¼Œå°±å¿…é¡»æ‰¾åˆ°ä¸€æ¡å·¥ä½œçº¿ç¨‹æ¥å¤„ç†ï¼Œå¦‚æœå½“å‰æ²¡æœ‰ç©ºé—²çš„çº¿ç¨‹å°±å†åˆ›å»ºä¸€æ¡æ–°çš„ã€‚</p> <p>å¦‚æœå¤§é‡çš„ä»»åŠ¡è¿›æ¥åä¼šåˆ›å»ºå¤§é‡çš„çº¿ç¨‹ã€‚æˆ‘ä»¬çŸ¥é“çº¿ç¨‹æ˜¯éœ€è¦åˆ†é…ä¸€å®šçš„å†…å­˜ç©ºé—´ä½œä¸ºçº¿ç¨‹æ ˆçš„ï¼Œæ¯”å¦‚ 1MBï¼Œå› æ­¤æ— é™åˆ¶åˆ›å»ºçº¿ç¨‹å¿…ç„¶ä¼šå¯¼è‡´ OOMã€‚</p> <h3 id="_5-3-é‡è¦ä»»åŠ¡åº”è¯¥è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥"><a href="#_5-3-é‡è¦ä»»åŠ¡åº”è¯¥è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥" class="header-anchor">#</a> 5.3. é‡è¦ä»»åŠ¡åº”è¯¥è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥</h3> <p>ä½¿ç”¨æœ‰ç•Œé˜Ÿåˆ—ï¼Œå½“ä»»åŠ¡è¿‡å¤šæ—¶ï¼Œçº¿ç¨‹æ± ä¼šè§¦å‘æ‰§è¡Œæ‹’ç»ç­–ç•¥ï¼Œçº¿ç¨‹æ± é»˜è®¤çš„æ‹’ç»ç­–ç•¥ä¼š throw <code>RejectedExecutionException</code> è¿™æ˜¯ä¸ªè¿è¡Œæ—¶å¼‚å¸¸ï¼Œå¯¹äºè¿è¡Œæ—¶å¼‚å¸¸ç¼–è¯‘å™¨å¹¶ä¸å¼ºåˆ¶ <code>catch</code> å®ƒï¼Œæ‰€ä»¥å¼€å‘äººå‘˜å¾ˆå®¹æ˜“å¿½ç•¥ã€‚å› æ­¤<strong>é»˜è®¤æ‹’ç»ç­–ç•¥è¦æ…é‡ä½¿ç”¨</strong>ã€‚å¦‚æœçº¿ç¨‹æ± å¤„ç†çš„ä»»åŠ¡éå¸¸é‡è¦ï¼Œå»ºè®®è‡ªå®šä¹‰è‡ªå·±çš„æ‹’ç»ç­–ç•¥ï¼›å¹¶ä¸”åœ¨å®é™…å·¥ä½œä¸­ï¼Œè‡ªå®šä¹‰çš„æ‹’ç»ç­–ç•¥å¾€å¾€å’Œé™çº§ç­–ç•¥é…åˆä½¿ç”¨ã€‚</p> <h2 id="_6-å‚è€ƒèµ„æ–™"><a href="#_6-å‚è€ƒèµ„æ–™" class="header-anchor">#</a> 6. å‚è€ƒèµ„æ–™</h2> <ul><li><a href="https://book.douban.com/subject/10484692/" target="_blank" rel="noopener noreferrer">ã€ŠJava å¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://book.douban.com/subject/26591326/" target="_blank" rel="noopener noreferrer">ã€ŠJava å¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.jianshu.com/p/d2729853c4da" target="_blank" rel="noopener noreferrer">æ·±å…¥ç†è§£ Java çº¿ç¨‹æ± ï¼šThreadPoolExecutor<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.cnblogs.com/MOBIN/p/5436482.html" target="_blank" rel="noopener noreferrer">java å¹¶å‘ç¼–ç¨‹--Executor æ¡†æ¶<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/dunwu/javacore/edit/master/docs/concurrent/Javaçº¿ç¨‹æ± .md" target="_blank" rel="noopener noreferrer">å¸®åŠ©æˆ‘ä»¬æ”¹å–„æ­¤é¡µé¢ï¼</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">3 minutes ago</span></div></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/javacore/assets/js/app.62a93b3d.js" defer></script><script src="/javacore/assets/js/4.156ff030.js" defer></script><script src="/javacore/assets/js/40.09a7bf54.js" defer></script><script src="/javacore/assets/js/5.cb43ecfb.js" defer></script>
  </body>
</html>
