(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{422:function(v,_,t){"use strict";t.r(_);var a=t(15),e=Object(a.a)({},(function(){var v=this,_=v.$createElement,t=v._self._c||_;return t("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[t("h1",{attrs:{id:"java-å†…å­˜æ¨¡å‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#java-å†…å­˜æ¨¡å‹"}},[v._v("#")]),v._v(" Java å†…å­˜æ¨¡å‹")]),v._v(" "),t("blockquote",[t("p",[t("strong",[v._v("å…³é”®è¯")]),v._v("ï¼š"),t("code",[v._v("JMM")]),v._v("ã€"),t("code",[v._v("volatile")]),v._v("ã€"),t("code",[v._v("synchronized")]),v._v("ã€"),t("code",[v._v("final")]),v._v("ã€"),t("code",[v._v("Happens-Before")]),v._v("ã€"),t("code",[v._v("å†…å­˜å±éšœ")])]),v._v(" "),t("p",[t("strong",[v._v("æ‘˜è¦")]),v._v("ï¼šJava å†…å­˜æ¨¡å‹ï¼ˆJava Memory Modelï¼‰ï¼Œç®€ç§° "),t("strong",[v._v("JMM")]),v._v("ã€‚Java å†…å­˜æ¨¡å‹çš„ç›®æ ‡æ˜¯ä¸ºäº†è§£å†³ç”±å¯è§æ€§å’Œæœ‰åºæ€§å¯¼è‡´çš„å¹¶å‘å®‰å…¨é—®é¢˜ã€‚Java å†…å­˜æ¨¡å‹é€šè¿‡ "),t("strong",[v._v("å±è”½å„ç§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚ï¼Œä»¥å®ç°è®© Java ç¨‹åºåœ¨å„ç§å¹³å°ä¸‹éƒ½èƒ½è¾¾åˆ°ä¸€è‡´çš„å†…å­˜è®¿é—®æ•ˆæœ")]),v._v("ã€‚")]),v._v(" "),t("p",[t("strong",[v._v("ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ "),t("a",{attrs:{href:"https://github.com/dunwu/javacore/",target:"_blank",rel:"noopener noreferrer"}},[v._v("javacore"),t("OutboundLink")],1)])])]),v._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"#1-%E7%89%A9%E7%90%86%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B"}},[v._v("1. ç‰©ç†å†…å­˜æ¨¡å‹")]),v._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"#11-%E7%A1%AC%E4%BB%B6%E5%A4%84%E7%90%86%E6%95%88%E7%8E%87"}},[v._v("1.1. ç¡¬ä»¶å¤„ç†æ•ˆç‡")])]),v._v(" "),t("li",[t("a",{attrs:{href:"#12-%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7"}},[v._v("1.2. ç¼“å­˜ä¸€è‡´æ€§")])]),v._v(" "),t("li",[t("a",{attrs:{href:"#13-%E4%BB%A3%E7%A0%81%E4%B9%B1%E5%BA%8F%E6%89%A7%E8%A1%8C%E4%BC%98%E5%8C%96"}},[v._v("1.3. ä»£ç ä¹±åºæ‰§è¡Œä¼˜åŒ–")])])])]),v._v(" "),t("li",[t("a",{attrs:{href:"#2-java-%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B"}},[v._v("2. Java å†…å­˜æ¨¡å‹")]),v._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"#21-%E4%B8%BB%E5%86%85%E5%AD%98%E5%92%8C%E5%B7%A5%E4%BD%9C%E5%86%85%E5%AD%98"}},[v._v("2.1. ä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜")])]),v._v(" "),t("li",[t("a",{attrs:{href:"#22-jmm-%E5%86%85%E5%AD%98%E6%93%8D%E4%BD%9C%E7%9A%84%E9%97%AE%E9%A2%98"}},[v._v("2.2. JMM å†…å­˜æ“ä½œçš„é—®é¢˜")])]),v._v(" "),t("li",[t("a",{attrs:{href:"#23-%E5%86%85%E5%AD%98%E9%97%B4%E4%BA%A4%E4%BA%92%E6%93%8D%E4%BD%9C"}},[v._v("2.3. å†…å­˜é—´äº¤äº’æ“ä½œ")])]),v._v(" "),t("li",[t("a",{attrs:{href:"#24-%E5%B9%B6%E5%8F%91%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7"}},[v._v("2.4. å¹¶å‘å®‰å…¨ç‰¹æ€§")])])])]),v._v(" "),t("li",[t("a",{attrs:{href:"#3-happens-before"}},[v._v("3. Happens-Before")])]),v._v(" "),t("li",[t("a",{attrs:{href:"#4-%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C"}},[v._v("4. å†…å­˜å±éšœ")])]),v._v(" "),t("li",[t("a",{attrs:{href:"#5-volatile"}},[v._v("5. volatile")])]),v._v(" "),t("li",[t("a",{attrs:{href:"#6-synchronized"}},[v._v("6. synchronized")]),v._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"#61-long-%E5%92%8C-double-%E5%8F%98%E9%87%8F%E7%9A%84%E7%89%B9%E6%AE%8A%E8%A7%84%E5%88%99"}},[v._v("6.1. long å’Œ double å˜é‡çš„ç‰¹æ®Šè§„åˆ™")])]),v._v(" "),t("li",[t("a",{attrs:{href:"#62-final-%E5%9E%8B%E9%87%8F%E7%9A%84%E7%89%B9%E6%AE%8A%E8%A7%84%E5%88%99"}},[v._v("6.2. final å‹é‡çš„ç‰¹æ®Šè§„åˆ™")])])])]),v._v(" "),t("li",[t("a",{attrs:{href:"#7-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"}},[v._v("7. å‚è€ƒèµ„æ–™")])])]),v._v(" "),t("h2",{attrs:{id:"_1-ç‰©ç†å†…å­˜æ¨¡å‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-ç‰©ç†å†…å­˜æ¨¡å‹"}},[v._v("#")]),v._v(" 1. ç‰©ç†å†…å­˜æ¨¡å‹")]),v._v(" "),t("p",[v._v("ç‰©ç†æœºé‡åˆ°çš„å¹¶å‘é—®é¢˜ä¸è™šæ‹Ÿæœºä¸­çš„æƒ…å†µæœ‰ä¸å°‘ç›¸ä¼¼ä¹‹å¤„ï¼Œç‰©ç†æœºå¯¹å¹¶å‘çš„å¤„ç†æ–¹æ¡ˆå¯¹äºè™šæ‹Ÿæœºçš„å®ç°ä¹Ÿæœ‰ç›¸å½“å¤§çš„å‚è€ƒæ„ä¹‰ã€‚")]),v._v(" "),t("h3",{attrs:{id:"_1-1-ç¡¬ä»¶å¤„ç†æ•ˆç‡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-ç¡¬ä»¶å¤„ç†æ•ˆç‡"}},[v._v("#")]),v._v(" 1.1. ç¡¬ä»¶å¤„ç†æ•ˆç‡")]),v._v(" "),t("p",[v._v("ç‰©ç†å†…å­˜çš„ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯ï¼šç¡¬ä»¶å¤„ç†æ•ˆç‡ã€‚")]),v._v(" "),t("ul",[t("li",[v._v("ç»å¤§å¤šæ•°çš„è¿ç®—ä»»åŠ¡éƒ½ä¸å¯èƒ½åªé å¤„ç†å™¨â€œè®¡ç®—â€å°±èƒ½å®Œæˆï¼Œå¤„ç†å™¨è‡³å°‘éœ€è¦ä¸"),t("strong",[v._v("å†…å­˜äº¤äº’")]),v._v("ï¼Œå¦‚è¯»å–è¿ç®—æ•°æ®ã€å­˜å‚¨è¿ç®—ç»“æœï¼Œè¿™ä¸ª I/O æ“ä½œæ˜¯å¾ˆéš¾æ¶ˆé™¤çš„ï¼ˆæ— æ³•ä»…é å¯„å­˜å™¨å®Œæˆæ‰€æœ‰è¿ç®—ä»»åŠ¡ï¼‰ã€‚")]),v._v(" "),t("li",[t("strong",[v._v("ç”±äºè®¡ç®—æœºçš„å­˜å‚¨è®¾å¤‡ä¸å¤„ç†å™¨çš„è¿ç®—é€Ÿåº¦æœ‰å‡ ä¸ªæ•°é‡çº§çš„å·®è·")]),v._v(" ï¼Œè¿™ç§é€Ÿåº¦ä¸Šçš„çŸ›ç›¾ï¼Œä¼šé™ä½ç¡¬ä»¶çš„å¤„ç†æ•ˆç‡ã€‚æ‰€ä»¥ï¼Œç°ä»£è®¡ç®—æœºéƒ½ä¸å¾—ä¸ "),t("strong",[v._v("åŠ å…¥é«˜é€Ÿç¼“å­˜ï¼ˆCacheï¼‰ æ¥ä½œä¸ºå†…å­˜å’Œå¤„ç†å™¨ä¹‹é—´çš„ç¼“å†²")]),v._v("ã€‚å°†éœ€è¦ç”¨åˆ°çš„æ•°æ®å¤åˆ¶åˆ°ç¼“å­˜ä¸­ï¼Œè®©è¿ç®—èƒ½å¿«é€Ÿè¿›è¡Œï¼Œå½“è¿ç®—ç»“æŸåå†ä»ç¼“å­˜åŒæ­¥ä¼šå†…å­˜ä¸­ï¼Œè¿™æ ·å¤„ç†å™¨å°±æ— éœ€ç­‰å¾…ç¼“æ…¢çš„å†…å­˜è¯»å†™äº†ã€‚")])]),v._v(" "),t("h3",{attrs:{id:"_1-2-ç¼“å­˜ä¸€è‡´æ€§"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-ç¼“å­˜ä¸€è‡´æ€§"}},[v._v("#")]),v._v(" 1.2. ç¼“å­˜ä¸€è‡´æ€§")]),v._v(" "),t("p",[v._v("é«˜é€Ÿç¼“å­˜è§£å†³äº† "),t("strong",[v._v("ç¡¬ä»¶æ•ˆç‡é—®é¢˜")]),v._v("ï¼Œä½†æ˜¯å¼•å…¥äº†ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼š"),t("strong",[v._v("ç¼“å­˜ä¸€è‡´æ€§ï¼ˆCache Coherenceï¼‰")]),v._v("ã€‚")]),v._v(" "),t("p",[v._v("åœ¨å¤šå¤„ç†å™¨ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªå¤„ç†å™¨éƒ½æœ‰è‡ªå·±çš„é«˜é€Ÿç¼“å­˜ï¼Œè€Œå®ƒä»¬åˆå…±äº«åŒä¸€ä¸»å†…å­˜ã€‚å½“å¤šä¸ªå¤„ç†å™¨çš„è¿ç®—ä»»åŠ¡éƒ½æ¶‰åŠåŒä¸€å—ä¸»å†…å­˜åŒºåŸŸæ—¶ï¼Œå°†å¯èƒ½å¯¼è‡´å„è‡ªçš„ç¼“å­˜æ•°æ®ä¸ä¸€è‡´ã€‚")]),v._v(" "),t("p",[v._v("ä¸ºäº†è§£å†³ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ï¼Œ"),t("strong",[v._v("éœ€è¦å„ä¸ªå¤„ç†å™¨è®¿é—®ç¼“å­˜æ—¶éƒ½éµå¾ªä¸€äº›åè®®ï¼Œåœ¨è¯»å†™æ—¶è¦æ ¹æ®åè®®æ¥è¿›è¡Œæ“ä½œ")]),v._v("ã€‚")]),v._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/dunwu/images/dev/snap/20210102230327.png",alt:""}})]),v._v(" "),t("h3",{attrs:{id:"_1-3-ä»£ç ä¹±åºæ‰§è¡Œä¼˜åŒ–"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-ä»£ç ä¹±åºæ‰§è¡Œä¼˜åŒ–"}},[v._v("#")]),v._v(" 1.3. ä»£ç ä¹±åºæ‰§è¡Œä¼˜åŒ–")]),v._v(" "),t("p",[t("strong",[v._v("é™¤äº†é«˜é€Ÿç¼“å­˜ä»¥å¤–ï¼Œä¸ºäº†ä½¿å¾—å¤„ç†å™¨å†…éƒ¨çš„è¿ç®—å•å…ƒå°½é‡è¢«å……åˆ†åˆ©ç”¨")]),v._v("ï¼Œå¤„ç†å™¨å¯èƒ½ä¼šå¯¹è¾“å…¥ä»£ç è¿›è¡Œä¹±åºæ‰§è¡Œï¼ˆOut-Of-Order Executionï¼‰ä¼˜åŒ–ã€‚å¤„ç†å™¨ä¼šåœ¨è®¡ç®—ä¹‹åå°†ä¹±åºæ‰§è¡Œçš„ç»“æœé‡ç»„ï¼Œ"),t("strong",[v._v("ä¿è¯è¯¥ç»“æœä¸é¡ºåºæ‰§è¡Œçš„ç»“æœæ˜¯ä¸€è‡´çš„")]),v._v("ï¼Œä½†ä¸ä¿è¯ç¨‹åºä¸­å„ä¸ªè¯­å¥è®¡ç®—çš„å…ˆåé¡ºåºä¸è¾“å…¥ä»£ç ä¸­çš„é¡ºåºä¸€è‡´ã€‚")]),v._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/dunwu/images/dev/snap/20210102223609.png",alt:""}})]),v._v(" "),t("p",[v._v("ä¹±åºæ‰§è¡ŒæŠ€æœ¯æ˜¯å¤„ç†å™¨ä¸ºæé«˜è¿ç®—é€Ÿåº¦è€Œåšå‡ºè¿èƒŒä»£ç åŸæœ‰é¡ºåºçš„ä¼˜åŒ–ã€‚")]),v._v(" "),t("ul",[t("li",[t("strong",[v._v("å•æ ¸")]),v._v("ç¯å¢ƒä¸‹ï¼Œå¤„ç†å™¨ä¿è¯åšå‡ºçš„ä¼˜åŒ–ä¸ä¼šå¯¼è‡´æ‰§è¡Œç»“æœè¿œç¦»é¢„æœŸç›®æ ‡ï¼Œä½†åœ¨å¤šæ ¸ç¯å¢ƒä¸‹å´å¹¶éå¦‚æ­¤ã€‚")]),v._v(" "),t("li",[t("strong",[v._v("å¤šæ ¸")]),v._v("ç¯å¢ƒä¸‹ï¼Œ å¦‚æœå­˜åœ¨ä¸€ä¸ªæ ¸çš„è®¡ç®—ä»»åŠ¡ä¾èµ–å¦ä¸€ä¸ªæ ¸çš„è®¡ç®—ä»»åŠ¡çš„ä¸­é—´ç»“æœï¼Œè€Œä¸”å¯¹ç›¸å…³æ•°æ®è¯»å†™æ²¡åšä»»ä½•é˜²æŠ¤æªæ–½ï¼Œé‚£ä¹ˆå…¶é¡ºåºæ€§å¹¶ä¸èƒ½é ä»£ç çš„å…ˆåé¡ºåºæ¥ä¿è¯ã€‚")])]),v._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/dunwu/images/dev/snap/20210102224144.png",alt:""}})]),v._v(" "),t("h2",{attrs:{id:"_2-java-å†…å­˜æ¨¡å‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-java-å†…å­˜æ¨¡å‹"}},[v._v("#")]),v._v(" 2. Java å†…å­˜æ¨¡å‹")]),v._v(" "),t("p",[t("strong",[t("code",[v._v("å†…å­˜æ¨¡å‹")])]),v._v(" è¿™ä¸ªæ¦‚å¿µã€‚æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºï¼š"),t("strong",[v._v("åœ¨ç‰¹å®šçš„æ“ä½œåè®®ä¸‹ï¼Œå¯¹ç‰¹å®šçš„å†…å­˜æˆ–é«˜é€Ÿç¼“å­˜è¿›è¡Œè¯»å†™è®¿é—®çš„è¿‡ç¨‹æŠ½è±¡")]),v._v("ã€‚ä¸åŒæ¶æ„çš„ç‰©ç†è®¡ç®—æœºå¯ä»¥æœ‰ä¸ä¸€æ ·çš„å†…å­˜æ¨¡å‹ï¼ŒJVM ä¹Ÿæœ‰è‡ªå·±çš„å†…å­˜æ¨¡å‹ã€‚")]),v._v(" "),t("p",[v._v("JVM ä¸­è¯•å›¾å®šä¹‰ä¸€ç§ Java å†…å­˜æ¨¡å‹ï¼ˆJava Memory Model, JMMï¼‰æ¥"),t("strong",[v._v("å±è”½å„ç§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚")]),v._v("ï¼Œä»¥å®ç°è®© Java ç¨‹åº "),t("strong",[v._v("åœ¨å„ç§å¹³å°ä¸‹éƒ½èƒ½è¾¾åˆ°ä¸€è‡´çš„å†…å­˜è®¿é—®æ•ˆæœ")]),v._v("ã€‚")]),v._v(" "),t("p",[v._v("åœ¨ "),t("a",{attrs:{href:"https://github.com/dunwu/javacore/blob/master/docs/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.md",target:"_blank",rel:"noopener noreferrer"}},[v._v("Java å¹¶å‘ç®€ä»‹"),t("OutboundLink")],1),v._v(" ä¸­å·²ç»ä»‹ç»äº†ï¼Œå¹¶å‘å®‰å…¨éœ€è¦æ»¡è¶³å¯è§æ€§ã€æœ‰åºæ€§ã€åŸå­æ€§ã€‚å…¶ä¸­ï¼Œå¯¼è‡´å¯è§æ€§çš„åŸå› æ˜¯ç¼“å­˜ï¼Œå¯¼è‡´æœ‰åºæ€§çš„åŸå› æ˜¯ç¼–è¯‘ä¼˜åŒ–ã€‚é‚£è§£å†³å¯è§æ€§ã€æœ‰åºæ€§æœ€ç›´æ¥çš„åŠæ³•å°±æ˜¯"),t("strong",[v._v("ç¦ç”¨ç¼“å­˜å’Œç¼–è¯‘ä¼˜åŒ–")]),v._v(" ã€‚ä½†è¿™ä¹ˆåšï¼Œæ€§èƒ½å°±å ªå¿§äº†ã€‚")]),v._v(" "),t("p",[v._v("åˆç†çš„æ–¹æ¡ˆåº”è¯¥æ˜¯"),t("strong",[v._v("æŒ‰éœ€ç¦ç”¨ç¼“å­˜ä»¥åŠç¼–è¯‘ä¼˜åŒ–")]),v._v("ã€‚é‚£ä¹ˆï¼Œå¦‚ä½•åšåˆ°å‘¢ï¼Ÿï¼ŒJava å†…å­˜æ¨¡å‹è§„èŒƒäº† JVM å¦‚ä½•æä¾›æŒ‰éœ€ç¦ç”¨ç¼“å­˜å’Œç¼–è¯‘ä¼˜åŒ–çš„æ–¹æ³•ã€‚å…·ä½“æ¥è¯´ï¼Œè¿™äº›æ–¹æ³•åŒ…æ‹¬ "),t("strong",[v._v("volatile")]),v._v("ã€"),t("strong",[v._v("synchronized")]),v._v(" å’Œ "),t("strong",[v._v("final")]),v._v(" ä¸‰ä¸ªå…³é”®å­—ï¼Œä»¥åŠ "),t("strong",[v._v("Happens-Before è§„åˆ™")]),v._v("ã€‚")]),v._v(" "),t("h3",{attrs:{id:"_2-1-ä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-ä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜"}},[v._v("#")]),v._v(" 2.1. ä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜")]),v._v(" "),t("p",[v._v("JMM çš„ä¸»è¦ç›®æ ‡æ˜¯ "),t("strong",[v._v("å®šä¹‰ç¨‹åºä¸­å„ä¸ªå˜é‡çš„è®¿é—®è§„åˆ™ï¼Œå³åœ¨è™šæ‹Ÿæœºä¸­å°†å˜é‡å­˜å‚¨åˆ°å†…å­˜å’Œä»å†…å­˜ä¸­å–å‡ºå˜é‡è¿™æ ·çš„åº•å±‚ç»†èŠ‚")]),v._v("ã€‚æ­¤å¤„çš„å˜é‡ï¼ˆVariablesï¼‰ä¸ Java ç¼–ç¨‹ä¸­æ‰€è¯´çš„å˜é‡æœ‰æ‰€åŒºåˆ«ï¼Œå®ƒåŒ…æ‹¬äº†å®ä¾‹å­—æ®µã€é™æ€å­—æ®µå’Œæ„æˆæ•°å€¼å¯¹è±¡çš„å…ƒç´ ï¼Œä½†ä¸åŒ…æ‹¬å±€éƒ¨å˜é‡ä¸æ–¹æ³•å‚æ•°ï¼Œå› ä¸ºåè€…æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œä¸ä¼šè¢«å…±äº«ï¼Œè‡ªç„¶å°±ä¸ä¼šå­˜åœ¨ç«äº‰é—®é¢˜ã€‚ä¸ºäº†è·å¾—è¾ƒå¥½çš„æ‰§è¡Œæ•ˆèƒ½ï¼ŒJMM å¹¶æ²¡æœ‰é™åˆ¶æ‰§è¡Œå¼•æ“ä½¿ç”¨å¤„ç†å™¨çš„ç‰¹å®šå¯„å­˜å™¨æˆ–ç¼“å­˜æ¥å’Œä¸»å­˜è¿›è¡Œäº¤äº’ï¼Œä¹Ÿæ²¡æœ‰é™åˆ¶å³ä½¿ç¼–è¯‘å™¨è¿›è¡Œè°ƒæ•´ä»£ç æ‰§è¡Œé¡ºåºè¿™ç±»ä¼˜åŒ–æªæ–½ã€‚")]),v._v(" "),t("p",[v._v("JMM è§„å®šäº†"),t("strong",[v._v("æ‰€æœ‰çš„å˜é‡éƒ½å­˜å‚¨åœ¨ä¸»å†…å­˜ï¼ˆMain Memoryï¼‰ä¸­")]),v._v("ã€‚")]),v._v(" "),t("p",[v._v("æ¯æ¡çº¿ç¨‹è¿˜æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼ˆWorking Memoryï¼‰ï¼Œ"),t("strong",[v._v("å·¥ä½œå†…å­˜ä¸­ä¿ç•™äº†è¯¥çº¿ç¨‹ä½¿ç”¨åˆ°çš„å˜é‡çš„ä¸»å†…å­˜çš„å‰¯æœ¬")]),v._v("ã€‚å·¥ä½œå†…å­˜æ˜¯ JMM çš„ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œå¹¶ä¸çœŸå®å­˜åœ¨ï¼Œå®ƒæ¶µç›–äº†ç¼“å­˜ï¼Œå†™ç¼“å†²åŒºï¼Œå¯„å­˜å™¨ä»¥åŠå…¶ä»–çš„ç¡¬ä»¶å’Œç¼–è¯‘å™¨ä¼˜åŒ–ã€‚")]),v._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/dunwu/images/dev/snap/20210102225839.png",alt:""}})]),v._v(" "),t("p",[v._v("çº¿ç¨‹å¯¹å˜é‡çš„æ‰€æœ‰æ“ä½œéƒ½å¿…é¡»åœ¨å·¥ä½œå†…å­˜ä¸­è¿›è¡Œï¼Œè€Œä¸èƒ½ç›´æ¥è¯»å†™ä¸»å†…å­˜ä¸­çš„å˜é‡ã€‚ä¸åŒçš„çº¿ç¨‹é—´ä¹Ÿæ— æ³•ç›´æ¥è®¿é—®å¯¹æ–¹å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œ"),t("strong",[v._v("çº¿ç¨‹é—´å˜é‡å€¼çš„ä¼ é€’å‡éœ€è¦é€šè¿‡ä¸»å†…å­˜æ¥å®Œæˆ")]),v._v("ã€‚")]),v._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/dunwu/images/dev/snap/20210102225657.png",alt:""}})]),v._v(" "),t("blockquote",[t("p",[v._v("è¯´æ˜ï¼š")]),v._v(" "),t("p",[v._v("è¿™é‡Œè¯´çš„ä¸»å†…å­˜ã€å·¥ä½œå†…å­˜ä¸ Java å†…å­˜åŒºåŸŸä¸­çš„å †ã€æ ˆã€æ–¹æ³•åŒºç­‰ä¸æ˜¯åŒä¸€ä¸ªå±‚æ¬¡çš„å†…å­˜åˆ’åˆ†ã€‚")])]),v._v(" "),t("h3",{attrs:{id:"_2-2-jmm-å†…å­˜æ“ä½œçš„é—®é¢˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-jmm-å†…å­˜æ“ä½œçš„é—®é¢˜"}},[v._v("#")]),v._v(" 2.2. JMM å†…å­˜æ“ä½œçš„é—®é¢˜")]),v._v(" "),t("p",[v._v("ç±»ä¼¼äºç‰©ç†å†…å­˜æ¨¡å‹é¢ä¸´çš„é—®é¢˜ï¼ŒJMM å­˜åœ¨ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼š")]),v._v(" "),t("ul",[t("li",[t("strong",[v._v("å·¥ä½œå†…å­˜æ•°æ®ä¸€è‡´æ€§")]),v._v(" - å„ä¸ªçº¿ç¨‹æ“ä½œæ•°æ®æ—¶ä¼šä¿å­˜ä½¿ç”¨åˆ°çš„ä¸»å†…å­˜ä¸­çš„å…±äº«å˜é‡å‰¯æœ¬ï¼Œå½“å¤šä¸ªçº¿ç¨‹çš„è¿ç®—ä»»åŠ¡éƒ½æ¶‰åŠåŒä¸€ä¸ªå…±äº«å˜é‡æ—¶ï¼Œå°†å¯¼è‡´å„è‡ªçš„çš„å…±äº«å˜é‡å‰¯æœ¬ä¸ä¸€è‡´ã€‚å¦‚æœçœŸçš„å‘ç”Ÿè¿™ç§æƒ…å†µï¼Œæ•°æ®åŒæ­¥å›ä¸»å†…å­˜ä»¥è°çš„å‰¯æœ¬æ•°æ®ä¸ºå‡†ï¼Ÿ Java å†…å­˜æ¨¡å‹ä¸»è¦é€šè¿‡ä¸€ç³»åˆ—çš„æ•°æ®åŒæ­¥åè®®ã€è§„åˆ™æ¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚")]),v._v(" "),t("li",[t("strong",[v._v("æŒ‡ä»¤é‡æ’åºä¼˜åŒ–")]),v._v(" - Java ä¸­é‡æ’åºé€šå¸¸æ˜¯ç¼–è¯‘å™¨æˆ–è¿è¡Œæ—¶ç¯å¢ƒä¸ºäº†ä¼˜åŒ–ç¨‹åºæ€§èƒ½è€Œé‡‡å–çš„å¯¹æŒ‡ä»¤è¿›è¡Œé‡æ–°æ’åºæ‰§è¡Œçš„ä¸€ç§æ‰‹æ®µã€‚é‡æ’åºåˆ†ä¸ºä¸¤ç±»ï¼š"),t("strong",[v._v("ç¼–è¯‘æœŸé‡æ’åºå’Œè¿è¡ŒæœŸé‡æ’åº")]),v._v("ï¼Œåˆ†åˆ«å¯¹åº”ç¼–è¯‘æ—¶å’Œè¿è¡Œæ—¶ç¯å¢ƒã€‚ åŒæ ·çš„ï¼ŒæŒ‡ä»¤é‡æ’åºä¸æ˜¯éšæ„é‡æ’åºï¼Œå®ƒéœ€è¦æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶ï¼š\n"),t("ul",[t("li",[v._v("åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹ä¸èƒ½æ”¹å˜ç¨‹åºè¿è¡Œçš„ç»“æœã€‚å³æ—¶ç¼–è¯‘å™¨ï¼ˆå’Œå¤„ç†å™¨ï¼‰éœ€è¦ä¿è¯ç¨‹åºèƒ½å¤Ÿéµå®ˆ "),t("code",[v._v("as-if-serial")]),v._v(" å±æ€§ã€‚é€šä¿—åœ°è¯´ï¼Œå°±æ˜¯åœ¨å•çº¿ç¨‹æƒ…å†µä¸‹ï¼Œè¦ç»™ç¨‹åºä¸€ä¸ªé¡ºåºæ‰§è¡Œçš„å‡è±¡ã€‚å³ç»è¿‡é‡æ’åºçš„æ‰§è¡Œç»“æœè¦ä¸é¡ºåºæ‰§è¡Œçš„ç»“æœä¿æŒä¸€è‡´ã€‚")]),v._v(" "),t("li",[v._v("å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»çš„ä¸å…è®¸é‡æ’åºã€‚")]),v._v(" "),t("li",[v._v("å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¦‚æœçº¿ç¨‹å¤„ç†é€»è¾‘ä¹‹é—´å­˜åœ¨ä¾èµ–å…³ç³»ï¼Œæœ‰å¯èƒ½å› ä¸ºæŒ‡ä»¤é‡æ’åºå¯¼è‡´è¿è¡Œç»“æœä¸é¢„æœŸä¸åŒã€‚")])])])]),v._v(" "),t("h3",{attrs:{id:"_2-3-å†…å­˜é—´äº¤äº’æ“ä½œ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-å†…å­˜é—´äº¤äº’æ“ä½œ"}},[v._v("#")]),v._v(" 2.3. å†…å­˜é—´äº¤äº’æ“ä½œ")]),v._v(" "),t("p",[v._v("JMM å®šä¹‰äº† 8 ä¸ªæ“ä½œæ¥å®Œæˆä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜ä¹‹é—´çš„äº¤äº’æ“ä½œã€‚JVM å®ç°æ—¶å¿…é¡»ä¿è¯ä¸‹é¢ä»‹ç»çš„æ¯ç§æ“ä½œéƒ½æ˜¯ "),t("strong",[v._v("åŸå­çš„")]),v._v("ï¼ˆå¯¹äº double å’Œ long å‹çš„å˜é‡æ¥è¯´ï¼Œloadã€storeã€readã€å’Œ write æ“ä½œåœ¨æŸäº›å¹³å°ä¸Šå…è®¸æœ‰ä¾‹å¤– ï¼‰ã€‚")]),v._v(" "),t("ul",[t("li",[t("code",[v._v("lock")]),v._v(" (é”å®š) - ä½œç”¨äº"),t("strong",[v._v("ä¸»å†…å­˜")]),v._v("çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªå˜é‡æ ‡è¯†ä¸ºä¸€æ¡çº¿ç¨‹ç‹¬å çš„çŠ¶æ€ã€‚")]),v._v(" "),t("li",[t("code",[v._v("unlock")]),v._v(" (è§£é”) - ä½œç”¨äº"),t("strong",[v._v("ä¸»å†…å­˜")]),v._v("çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªå¤„äºé”å®šçŠ¶æ€çš„å˜é‡é‡Šæ”¾å‡ºæ¥ï¼Œé‡Šæ”¾åçš„å˜é‡æ‰å¯ä»¥è¢«å…¶ä»–çº¿ç¨‹é”å®šã€‚")]),v._v(" "),t("li",[t("code",[v._v("read")]),v._v(" (è¯»å–) - ä½œç”¨äº"),t("strong",[v._v("ä¸»å†…å­˜")]),v._v("çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªå˜é‡çš„å€¼ä»ä¸»å†…å­˜"),t("strong",[v._v("ä¼ è¾“")]),v._v("åˆ°çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ï¼Œä»¥ä¾¿éšåçš„ "),t("code",[v._v("load")]),v._v(" åŠ¨ä½œä½¿ç”¨ã€‚")]),v._v(" "),t("li",[t("code",[v._v("write")]),v._v(" (å†™å…¥) - ä½œç”¨äº"),t("strong",[v._v("ä¸»å†…å­˜")]),v._v("çš„å˜é‡ï¼Œå®ƒæŠŠ store æ“ä½œä»å·¥ä½œå†…å­˜ä¸­å¾—åˆ°çš„å˜é‡çš„å€¼æ”¾å…¥ä¸»å†…å­˜çš„å˜é‡ä¸­ã€‚")]),v._v(" "),t("li",[t("code",[v._v("load")]),v._v(" (è½½å…¥) - ä½œç”¨äº"),t("strong",[v._v("å·¥ä½œå†…å­˜")]),v._v("çš„å˜é‡ï¼Œå®ƒæŠŠ read æ“ä½œä»ä¸»å†…å­˜ä¸­å¾—åˆ°çš„å˜é‡å€¼æ”¾å…¥å·¥ä½œå†…å­˜çš„å˜é‡å‰¯æœ¬ä¸­ã€‚")]),v._v(" "),t("li",[t("code",[v._v("use")]),v._v(" (ä½¿ç”¨) - ä½œç”¨äº"),t("strong",[v._v("å·¥ä½œå†…å­˜")]),v._v("çš„å˜é‡ï¼Œå®ƒæŠŠå·¥ä½œå†…å­˜ä¸­ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€’ç»™æ‰§è¡Œå¼•æ“ï¼Œæ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªéœ€è¦ä½¿ç”¨åˆ°å˜é‡çš„å€¼å¾—å­—èŠ‚ç æŒ‡ä»¤æ—¶å°±ä¼šæ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚")]),v._v(" "),t("li",[t("code",[v._v("assign")]),v._v(" (èµ‹å€¼) - ä½œç”¨äº"),t("strong",[v._v("å·¥ä½œå†…å­˜")]),v._v("çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªä»æ‰§è¡Œå¼•æ“æ¥æ”¶åˆ°çš„å€¼èµ‹ç»™å·¥ä½œå†…å­˜çš„å˜é‡ï¼Œæ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªç»™å˜é‡èµ‹å€¼çš„å­—èŠ‚ç æŒ‡ä»¤æ—¶æ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚")]),v._v(" "),t("li",[t("code",[v._v("store")]),v._v(" (å­˜å‚¨) - ä½œç”¨äº"),t("strong",[v._v("å·¥ä½œå†…å­˜")]),v._v("çš„å˜é‡ï¼Œå®ƒæŠŠå·¥ä½œå†…å­˜ä¸­ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€åˆ°ä¸»å†…å­˜ä¸­ï¼Œä»¥ä¾¿éšå "),t("code",[v._v("write")]),v._v(" æ“ä½œä½¿ç”¨ã€‚")])]),v._v(" "),t("p",[v._v("å¦‚æœè¦æŠŠä¸€ä¸ªå˜é‡ä»ä¸»å†…å­˜ä¸­å¤åˆ¶åˆ°å·¥ä½œå†…å­˜ï¼Œå°±"),t("strong",[v._v("éœ€è¦æŒ‰åºæ‰§è¡Œ "),t("code",[v._v("read")]),v._v(" å’Œ "),t("code",[v._v("load")]),v._v(" æ“ä½œ")]),v._v("ï¼›å¦‚æœæŠŠå˜é‡ä»å·¥ä½œå†…å­˜ä¸­åŒæ­¥å›ä¸»å†…å­˜ä¸­ï¼Œå°±"),t("strong",[v._v("éœ€è¦æŒ‰åºæ‰§è¡Œ "),t("code",[v._v("store")]),v._v(" å’Œ "),t("code",[v._v("write")]),v._v(" æ“ä½œ")]),v._v("ã€‚ä½† Java å†…å­˜æ¨¡å‹åªè¦æ±‚ä¸Šè¿°æ“ä½œå¿…é¡»æŒ‰é¡ºåºæ‰§è¡Œï¼Œè€Œæ²¡æœ‰ä¿è¯å¿…é¡»æ˜¯è¿ç»­æ‰§è¡Œã€‚")]),v._v(" "),t("p",[v._v("JMM è¿˜è§„å®šäº†ä¸Šè¿° 8 ç§åŸºæœ¬æ“ä½œï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹è§„åˆ™ï¼š")]),v._v(" "),t("ul",[t("li",[t("strong",[v._v("read å’Œ load å¿…é¡»æˆå¯¹å‡ºç°")]),v._v("ï¼›"),t("strong",[v._v("store å’Œ write å¿…é¡»æˆå¯¹å‡ºç°")]),v._v("ã€‚å³ä¸å…è®¸ä¸€ä¸ªå˜é‡ä»ä¸»å†…å­˜è¯»å–äº†ä½†å·¥ä½œå†…å­˜ä¸æ¥å—ï¼Œæˆ–ä»å·¥ä½œå†…å­˜å‘èµ·å›å†™äº†ä½†ä¸»å†…å­˜ä¸æ¥å—çš„æƒ…å†µå‡ºç°ã€‚")]),v._v(" "),t("li",[t("strong",[v._v("ä¸å…è®¸ä¸€ä¸ªçº¿ç¨‹ä¸¢å¼ƒå®ƒçš„æœ€è¿‘ assign çš„æ“ä½œ")]),v._v("ï¼Œå³å˜é‡åœ¨å·¥ä½œå†…å­˜ä¸­æ”¹å˜äº†ä¹‹åå¿…é¡»æŠŠå˜åŒ–åŒæ­¥åˆ°ä¸»å†…å­˜ä¸­ã€‚")]),v._v(" "),t("li",[t("strong",[v._v("ä¸å…è®¸ä¸€ä¸ªçº¿ç¨‹æ— åŸå› çš„ï¼ˆæ²¡æœ‰å‘ç”Ÿè¿‡ä»»ä½• assign æ“ä½œï¼‰æŠŠæ•°æ®ä»å·¥ä½œå†…å­˜åŒæ­¥å›ä¸»å†…å­˜ä¸­")]),v._v("ã€‚")]),v._v(" "),t("li",[v._v("ä¸€ä¸ªæ–°çš„å˜é‡åªèƒ½åœ¨ä¸»å†…å­˜ä¸­è¯ç”Ÿï¼Œä¸å…è®¸åœ¨å·¥ä½œå†…å­˜ä¸­ç›´æ¥ä½¿ç”¨ä¸€ä¸ªæœªè¢«åˆå§‹åŒ–ï¼ˆload æˆ– assign ï¼‰çš„å˜é‡ã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯å¯¹ä¸€ä¸ªå˜é‡å®æ–½ use å’Œ store æ“ä½œä¹‹å‰ï¼Œå¿…é¡»å…ˆæ‰§è¡Œè¿‡äº† load æˆ– assign æ“ä½œã€‚")]),v._v(" "),t("li",[v._v("ä¸€ä¸ªå˜é‡åœ¨åŒä¸€ä¸ªæ—¶åˆ»åªå…è®¸ä¸€æ¡çº¿ç¨‹å¯¹å…¶è¿›è¡Œ lock æ“ä½œï¼Œä½† lock æ“ä½œå¯ä»¥è¢«åŒä¸€æ¡çº¿ç¨‹é‡å¤æ‰§è¡Œå¤šæ¬¡ï¼Œå¤šæ¬¡æ‰§è¡Œ lock åï¼Œåªæœ‰æ‰§è¡Œç›¸åŒæ¬¡æ•°çš„ unlock æ“ä½œï¼Œå˜é‡æ‰ä¼šè¢«è§£é”ã€‚æ‰€ä»¥ "),t("strong",[v._v("lock å’Œ unlock å¿…é¡»æˆå¯¹å‡ºç°")]),v._v("ã€‚")]),v._v(" "),t("li",[v._v("å¦‚æœå¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œ lock æ“ä½œï¼Œå°†ä¼šæ¸…ç©ºå·¥ä½œå†…å­˜ä¸­æ­¤å˜é‡çš„å€¼ï¼Œåœ¨æ‰§è¡Œå¼•æ“ä½¿ç”¨è¿™ä¸ªå˜é‡å‰ï¼Œéœ€è¦é‡æ–°æ‰§è¡Œ load æˆ– assign æ“ä½œåˆå§‹åŒ–å˜é‡çš„å€¼ã€‚")]),v._v(" "),t("li",[v._v("å¦‚æœä¸€ä¸ªå˜é‡äº‹å…ˆæ²¡æœ‰è¢« lock æ“ä½œé”å®šï¼Œåˆ™ä¸å…è®¸å¯¹å®ƒæ‰§è¡Œ unlock æ“ä½œï¼Œä¹Ÿä¸å…è®¸å» unlock ä¸€ä¸ªè¢«å…¶ä»–çº¿ç¨‹é”å®šçš„å˜é‡ã€‚")]),v._v(" "),t("li",[v._v("å¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œ unlock æ“ä½œä¹‹å‰ï¼Œå¿…é¡»å…ˆæŠŠæ­¤å˜é‡åŒæ­¥åˆ°ä¸»å†…å­˜ä¸­ï¼ˆæ‰§è¡Œ store å’Œ write æ“ä½œï¼‰")])]),v._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/dunwu/images/dev/snap/20210102230708.png",alt:""}})]),v._v(" "),t("h3",{attrs:{id:"_2-4-å¹¶å‘å®‰å…¨ç‰¹æ€§"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-å¹¶å‘å®‰å…¨ç‰¹æ€§"}},[v._v("#")]),v._v(" 2.4. å¹¶å‘å®‰å…¨ç‰¹æ€§")]),v._v(" "),t("p",[v._v("ä¸Šæ–‡ä»‹ç»äº† Java å†…å­˜äº¤äº’çš„ 8 ç§åŸºæœ¬æ“ä½œï¼Œå®ƒä»¬éµå¾ª Java å†…å­˜ä¸‰å¤§ç‰¹æ€§ï¼šåŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§ã€‚")]),v._v(" "),t("p",[v._v("è€Œè¿™ä¸‰å¤§ç‰¹æ€§ï¼Œå½’æ ¹ç»“åº•ï¼Œæ˜¯ä¸ºäº†å®ç°å¤šçº¿ç¨‹çš„ "),t("strong",[v._v("æ•°æ®ä¸€è‡´æ€§")]),v._v("ï¼Œä½¿å¾—ç¨‹åºåœ¨å¤šçº¿ç¨‹å¹¶å‘ï¼ŒæŒ‡ä»¤é‡æ’åºä¼˜åŒ–çš„ç¯å¢ƒä¸­èƒ½å¦‚é¢„æœŸè¿è¡Œã€‚")]),v._v(" "),t("h4",{attrs:{id:"åŸå­æ€§"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åŸå­æ€§"}},[v._v("#")]),v._v(" åŸå­æ€§")]),v._v(" "),t("p",[t("strong",[v._v("åŸå­æ€§å³ä¸€ä¸ªæ“ä½œæˆ–è€…å¤šä¸ªæ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼ˆæ‰§è¡Œçš„è¿‡ç¨‹ä¸ä¼šè¢«ä»»ä½•å› ç´ æ‰“æ–­ï¼‰ï¼Œè¦ä¹ˆå°±éƒ½ä¸æ‰§è¡Œ")]),v._v("ã€‚å³ä½¿åœ¨å¤šä¸ªçº¿ç¨‹ä¸€èµ·æ‰§è¡Œçš„æ—¶å€™ï¼Œä¸€ä¸ªæ“ä½œä¸€æ—¦å¼€å§‹ï¼Œå°±ä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹æ‰€å¹²æ‰°ã€‚")]),v._v(" "),t("p",[v._v("åœ¨ Java ä¸­ï¼Œä¸ºäº†ä¿è¯åŸå­æ€§ï¼Œæä¾›äº†ä¸¤ä¸ªé«˜çº§çš„å­—èŠ‚ç æŒ‡ä»¤ "),t("code",[v._v("monitorenter")]),v._v(" å’Œ "),t("code",[v._v("monitorexit")]),v._v("ã€‚è¿™ä¸¤ä¸ªå­—èŠ‚ç ï¼Œåœ¨ Java ä¸­å¯¹åº”çš„å…³é”®å­—å°±æ˜¯ "),t("code",[v._v("synchronized")]),v._v("ã€‚")]),v._v(" "),t("p",[v._v("å› æ­¤ï¼Œåœ¨ Java ä¸­å¯ä»¥ä½¿ç”¨ "),t("code",[v._v("synchronized")]),v._v(" æ¥ä¿è¯æ–¹æ³•å’Œä»£ç å—å†…çš„æ“ä½œæ˜¯åŸå­æ€§çš„ã€‚")]),v._v(" "),t("h4",{attrs:{id:"å¯è§æ€§"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¯è§æ€§"}},[v._v("#")]),v._v(" å¯è§æ€§")]),v._v(" "),t("p",[t("strong",[v._v("å¯è§æ€§æ˜¯æŒ‡å½“å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªå˜é‡æ—¶ï¼Œä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†è¿™ä¸ªå˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¤Ÿç«‹å³çœ‹å¾—åˆ°ä¿®æ”¹çš„å€¼")]),v._v("ã€‚")]),v._v(" "),t("p",[v._v("JMM æ˜¯é€šè¿‡ "),t("strong",[v._v('"å˜é‡ä¿®æ”¹åå°†æ–°å€¼åŒæ­¥å›ä¸»å†…å­˜')]),v._v("ï¼Œ "),t("strong",[v._v('å˜é‡è¯»å–å‰ä»ä¸»å†…å­˜åˆ·æ–°å˜é‡å€¼"')]),v._v(" è¿™ç§ä¾èµ–ä¸»å†…å­˜ä½œä¸ºä¼ é€’åª’ä»‹çš„æ–¹å¼æ¥å®ç°çš„ã€‚")]),v._v(" "),t("p",[v._v("Java å®ç°å¤šçº¿ç¨‹å¯è§æ€§çš„æ–¹å¼æœ‰ï¼š")]),v._v(" "),t("ul",[t("li",[t("code",[v._v("volatile")])]),v._v(" "),t("li",[t("code",[v._v("synchronized")])]),v._v(" "),t("li",[t("code",[v._v("final")])])]),v._v(" "),t("h4",{attrs:{id:"æœ‰åºæ€§"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æœ‰åºæ€§"}},[v._v("#")]),v._v(" æœ‰åºæ€§")]),v._v(" "),t("p",[v._v("æœ‰åºæ€§è§„åˆ™è¡¨ç°åœ¨ä»¥ä¸‹ä¸¤ç§åœºæ™¯: çº¿ç¨‹å†…å’Œçº¿ç¨‹é—´")]),v._v(" "),t("ul",[t("li",[v._v("çº¿ç¨‹å†… - ä»æŸä¸ªçº¿ç¨‹çš„è§’åº¦çœ‹æ–¹æ³•çš„æ‰§è¡Œï¼ŒæŒ‡ä»¤ä¼šæŒ‰ç…§ä¸€ç§å«â€œä¸²è¡Œâ€ï¼ˆ"),t("code",[v._v("as-if-serial")]),v._v("ï¼‰çš„æ–¹å¼æ‰§è¡Œï¼Œæ­¤ç§æ–¹å¼å·²ç»åº”ç”¨äºé¡ºåºç¼–ç¨‹è¯­è¨€ã€‚")]),v._v(" "),t("li",[v._v("çº¿ç¨‹é—´ - è¿™ä¸ªçº¿ç¨‹â€œè§‚å¯Ÿâ€åˆ°å…¶ä»–çº¿ç¨‹å¹¶å‘åœ°æ‰§è¡ŒéåŒæ­¥çš„ä»£ç æ—¶ï¼Œç”±äºæŒ‡ä»¤é‡æ’åºä¼˜åŒ–ï¼Œä»»ä½•ä»£ç éƒ½æœ‰å¯èƒ½äº¤å‰æ‰§è¡Œã€‚å”¯ä¸€èµ·ä½œç”¨çš„çº¦æŸæ˜¯ï¼šå¯¹äºåŒæ­¥æ–¹æ³•ï¼ŒåŒæ­¥å—ï¼ˆ"),t("code",[v._v("synchronized")]),v._v(" å…³é”®å­—ä¿®é¥°ï¼‰ä»¥åŠ "),t("code",[v._v("volatile")]),v._v(" å­—æ®µçš„æ“ä½œä»ç»´æŒç›¸å¯¹æœ‰åºã€‚")])]),v._v(" "),t("p",[v._v("åœ¨ Java ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ "),t("code",[v._v("synchronized")]),v._v(" å’Œ "),t("code",[v._v("volatile")]),v._v(" æ¥ä¿è¯å¤šçº¿ç¨‹ä¹‹é—´æ“ä½œçš„æœ‰åºæ€§ã€‚å®ç°æ–¹å¼æœ‰æ‰€åŒºåˆ«ï¼š")]),v._v(" "),t("ul",[t("li",[t("code",[v._v("volatile")]),v._v(" å…³é”®å­—ä¼šç¦æ­¢æŒ‡ä»¤é‡æ’åºã€‚")]),v._v(" "),t("li",[t("code",[v._v("synchronized")]),v._v(" å…³é”®å­—é€šè¿‡äº’æ–¥ä¿è¯åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€æ¡çº¿ç¨‹æ“ä½œã€‚")])]),v._v(" "),t("h2",{attrs:{id:"_3-happens-before"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-happens-before"}},[v._v("#")]),v._v(" 3. Happens-Before")]),v._v(" "),t("p",[v._v("JMM ä¸ºç¨‹åºä¸­æ‰€æœ‰çš„æ“ä½œå®šä¹‰äº†ä¸€ä¸ªååºå…³ç³»ï¼Œç§°ä¹‹ä¸º "),t("strong",[t("code",[v._v("å…ˆè¡Œå‘ç”ŸåŸåˆ™ï¼ˆHappens-Beforeï¼‰")])]),v._v("ã€‚")]),v._v(" "),t("p",[t("strong",[v._v("Happens-Before")]),v._v(" æ˜¯æŒ‡ "),t("strong",[v._v("å‰é¢ä¸€ä¸ªæ“ä½œçš„ç»“æœå¯¹åç»­æ“ä½œæ˜¯å¯è§çš„")]),v._v("ã€‚")]),v._v(" "),t("p",[t("strong",[v._v("Happens-Before")]),v._v(" éå¸¸é‡è¦ï¼Œå®ƒæ˜¯åˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨ç«äº‰ã€çº¿ç¨‹æ˜¯å¦å®‰å…¨çš„ä¸»è¦ä¾æ®ï¼Œä¾é è¿™ä¸ªåŸåˆ™ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å‡ æ¡è§„åˆ™ä¸€æ½å­åœ°è§£å†³å¹¶å‘ç¯å¢ƒä¸‹ä¸¤ä¸ªæ“ä½œé—´æ˜¯å¦å¯èƒ½å­˜åœ¨å†²çªçš„æ‰€æœ‰é—®é¢˜ã€‚")]),v._v(" "),t("ul",[t("li",[t("strong",[v._v("ç¨‹åºæ¬¡åºè§„åˆ™")]),v._v(" - ä¸€ä¸ªçº¿ç¨‹å†…ï¼ŒæŒ‰ç…§ä»£ç é¡ºåºï¼Œä¹¦å†™åœ¨å‰é¢çš„æ“ä½œå…ˆè¡Œå‘ç”Ÿäºä¹¦å†™åœ¨åé¢çš„æ“ä½œã€‚")]),v._v(" "),t("li",[t("strong",[v._v("é”å®šè§„åˆ™")]),v._v(" - ä¸€ä¸ª "),t("code",[v._v("unLock")]),v._v(" æ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢å¯¹åŒä¸€ä¸ªé”çš„ "),t("code",[v._v("lock")]),v._v(" æ“ä½œã€‚")]),v._v(" "),t("li",[t("strong",[v._v("volatile å˜é‡è§„åˆ™")]),v._v(" - å¯¹ä¸€ä¸ª "),t("code",[v._v("volatile")]),v._v(" å˜é‡çš„å†™æ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢å¯¹è¿™ä¸ªå˜é‡çš„è¯»æ“ä½œã€‚")]),v._v(" "),t("li",[t("strong",[v._v("çº¿ç¨‹å¯åŠ¨è§„åˆ™")]),v._v(" - "),t("code",[v._v("Thread")]),v._v(" å¯¹è±¡çš„ "),t("code",[v._v("start()")]),v._v(" æ–¹æ³•å…ˆè¡Œå‘ç”Ÿäºæ­¤çº¿ç¨‹çš„æ¯ä¸ªä¸€ä¸ªåŠ¨ä½œã€‚")]),v._v(" "),t("li",[t("strong",[v._v("çº¿ç¨‹ç»ˆæ­¢è§„åˆ™")]),v._v(" - çº¿ç¨‹ä¸­æ‰€æœ‰çš„æ“ä½œéƒ½å…ˆè¡Œå‘ç”Ÿäºçº¿ç¨‹çš„ç»ˆæ­¢æ£€æµ‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ "),t("code",[v._v("Thread.join()")]),v._v(" æ–¹æ³•ç»“æŸã€"),t("code",[v._v("Thread.isAlive()")]),v._v(" çš„è¿”å›å€¼æ‰‹æ®µæ£€æµ‹åˆ°çº¿ç¨‹å·²ç»ç»ˆæ­¢æ‰§è¡Œã€‚")]),v._v(" "),t("li",[t("strong",[v._v("çº¿ç¨‹ä¸­æ–­è§„åˆ™")]),v._v(" - å¯¹çº¿ç¨‹ "),t("code",[v._v("interrupt()")]),v._v(" æ–¹æ³•çš„è°ƒç”¨å…ˆè¡Œå‘ç”Ÿäºè¢«ä¸­æ–­çº¿ç¨‹çš„ä»£ç æ£€æµ‹åˆ°ä¸­æ–­äº‹ä»¶çš„å‘ç”Ÿï¼Œå¯ä»¥é€šè¿‡ "),t("code",[v._v("Thread.interrupted()")]),v._v(" æ–¹æ³•æ£€æµ‹åˆ°æ˜¯å¦æœ‰ä¸­æ–­å‘ç”Ÿã€‚")]),v._v(" "),t("li",[t("strong",[v._v("å¯¹è±¡ç»ˆç»“è§„åˆ™")]),v._v(" - ä¸€ä¸ªå¯¹è±¡çš„åˆå§‹åŒ–å®Œæˆå…ˆè¡Œå‘ç”Ÿäºå®ƒçš„ "),t("code",[v._v("finalize()")]),v._v(" æ–¹æ³•çš„å¼€å§‹ã€‚")]),v._v(" "),t("li",[t("strong",[v._v("ä¼ é€’æ€§")]),v._v(" - å¦‚æœæ“ä½œ A å…ˆè¡Œå‘ç”Ÿäº æ“ä½œ Bï¼Œè€Œæ“ä½œ B åˆ å…ˆè¡Œå‘ç”Ÿäº æ“ä½œ Cï¼Œåˆ™å¯ä»¥å¾—å‡ºæ“ä½œ A å…ˆè¡Œå‘ç”Ÿäº æ“ä½œ Cã€‚")])]),v._v(" "),t("h2",{attrs:{id:"_4-å†…å­˜å±éšœ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-å†…å­˜å±éšœ"}},[v._v("#")]),v._v(" 4. å†…å­˜å±éšœ")]),v._v(" "),t("p",[v._v("Java ä¸­å¦‚ä½•ä¿è¯åº•å±‚æ“ä½œçš„æœ‰åºæ€§å’Œå¯è§æ€§ï¼Ÿå¯ä»¥é€šè¿‡å†…å­˜å±éšœï¼ˆmemory barrierï¼‰ã€‚")]),v._v(" "),t("p",[v._v("å†…å­˜å±éšœæ˜¯è¢«æ’å…¥ä¸¤ä¸ª CPU æŒ‡ä»¤ä¹‹é—´çš„ä¸€ç§æŒ‡ä»¤ï¼Œç”¨æ¥ç¦æ­¢å¤„ç†å™¨æŒ‡ä»¤å‘ç”Ÿé‡æ’åºï¼ˆåƒå±éšœä¸€æ ·ï¼‰ï¼Œä»è€Œä¿éšœ"),t("strong",[v._v("æœ‰åºæ€§")]),v._v("çš„ã€‚å¦å¤–ï¼Œä¸ºäº†è¾¾åˆ°å±éšœçš„æ•ˆæœï¼Œå®ƒä¹Ÿä¼šä½¿å¤„ç†å™¨å†™å…¥ã€è¯»å–å€¼ä¹‹å‰ï¼Œå°†ä¸»å†…å­˜çš„å€¼å†™å…¥é«˜é€Ÿç¼“å­˜ï¼Œæ¸…ç©ºæ— æ•ˆé˜Ÿåˆ—ï¼Œä»è€Œä¿éšœ"),t("strong",[v._v("å¯è§æ€§")]),v._v("ã€‚")]),v._v(" "),t("p",[v._v("ä¸¾ä¸ªä¾‹å­ï¼š")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[v._v("Store1;\nStore2;\nLoad1;\nStoreLoad;  //å†…å­˜å±éšœ\nStore3;\nLoad2;\nLoad3;\nå¤åˆ¶ä»£ç \n")])])]),t("p",[v._v("å¯¹äºä¸Šé¢çš„ä¸€ç»„ CPU æŒ‡ä»¤ï¼ˆStore è¡¨ç¤ºå†™å…¥æŒ‡ä»¤ï¼ŒLoad è¡¨ç¤ºè¯»å–æŒ‡ä»¤ï¼‰ï¼ŒStoreLoad å±éšœä¹‹å‰çš„ Store æŒ‡ä»¤æ— æ³•ä¸ StoreLoad å±éšœä¹‹åçš„ Load æŒ‡ä»¤è¿›è¡Œäº¤æ¢ä½ç½®ï¼Œå³"),t("strong",[v._v("é‡æ’åº")]),v._v("ã€‚ä½†æ˜¯ StoreLoad å±éšœä¹‹å‰å’Œä¹‹åçš„æŒ‡ä»¤æ˜¯å¯ä»¥äº’æ¢ä½ç½®çš„ï¼Œå³ Store1 å¯ä»¥å’Œ Store2 äº’æ¢ï¼ŒLoad2 å¯ä»¥å’Œ Load3 äº’æ¢ã€‚")]),v._v(" "),t("p",[v._v("å¸¸è§æœ‰ 4 ç§å±éšœ")]),v._v(" "),t("ul",[t("li",[t("code",[v._v("LoadLoad")]),v._v(" å±éšœ - å¯¹äºè¿™æ ·çš„è¯­å¥ "),t("code",[v._v("Load1; LoadLoad; Load2")]),v._v("ï¼Œåœ¨ Load2 åŠåç»­è¯»å–æ“ä½œè¦è¯»å–çš„æ•°æ®è¢«è®¿é—®å‰ï¼Œä¿è¯ Load1 è¦è¯»å–çš„æ•°æ®è¢«è¯»å–å®Œæ¯•ã€‚")]),v._v(" "),t("li",[t("code",[v._v("StoreStore")]),v._v(" å±éšœ - å¯¹äºè¿™æ ·çš„è¯­å¥ "),t("code",[v._v("Store1; StoreStore; Store2")]),v._v("ï¼Œåœ¨ Store2 åŠåç»­å†™å…¥æ“ä½œæ‰§è¡Œå‰ï¼Œä¿è¯ Store1 çš„å†™å…¥æ“ä½œå¯¹å…¶å®ƒå¤„ç†å™¨å¯è§ã€‚")]),v._v(" "),t("li",[t("code",[v._v("LoadStore")]),v._v(" å±éšœ - å¯¹äºè¿™æ ·çš„è¯­å¥ "),t("code",[v._v("Load1; LoadStore; Store2")]),v._v("ï¼Œåœ¨ Store2 åŠåç»­å†™å…¥æ“ä½œè¢«æ‰§è¡Œå‰ï¼Œä¿è¯ Load1 è¦è¯»å–çš„æ•°æ®è¢«è¯»å–å®Œæ¯•ã€‚")]),v._v(" "),t("li",[t("code",[v._v("StoreLoad")]),v._v(" å±éšœ - å¯¹äºè¿™æ ·çš„è¯­å¥ "),t("code",[v._v("Store1; StoreLoad; Load2")]),v._v("ï¼Œåœ¨ Load2 åŠåç»­æ‰€æœ‰è¯»å–æ“ä½œæ‰§è¡Œå‰ï¼Œä¿è¯ Store1 çš„å†™å…¥å¯¹æ‰€æœ‰å¤„ç†å™¨å¯è§ã€‚å®ƒçš„å¼€é”€æ˜¯å››ç§å±éšœä¸­æœ€å¤§çš„ï¼ˆå†²åˆ·å†™ç¼“å†²å™¨ï¼Œæ¸…ç©ºæ— æ•ˆåŒ–é˜Ÿåˆ—ï¼‰ã€‚åœ¨å¤§å¤šæ•°å¤„ç†å™¨çš„å®ç°ä¸­ï¼Œè¿™ä¸ªå±éšœæ˜¯ä¸ªä¸‡èƒ½å±éšœï¼Œå…¼å…·å…¶å®ƒä¸‰ç§å†…å­˜å±éšœçš„åŠŸèƒ½ã€‚")])]),v._v(" "),t("p",[v._v("Java ä¸­å¯¹å†…å­˜å±éšœçš„ä½¿ç”¨åœ¨ä¸€èˆ¬çš„ä»£ç ä¸­ä¸å¤ªå®¹æ˜“è§åˆ°ï¼Œå¸¸è§çš„æœ‰ "),t("code",[v._v("volatile")]),v._v(" å’Œ "),t("code",[v._v("synchronized")]),v._v(" å…³é”®å­—ä¿®é¥°çš„ä»£ç å—(åé¢å†å±•å¼€ä»‹ç»)ï¼Œè¿˜å¯ä»¥é€šè¿‡ "),t("code",[v._v("Unsafe")]),v._v(" è¿™ä¸ªç±»æ¥ä½¿ç”¨å†…å­˜å±éšœã€‚")]),v._v(" "),t("h2",{attrs:{id:"_5-volatile"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-volatile"}},[v._v("#")]),v._v(" 5. volatile")]),v._v(" "),t("p",[t("code",[v._v("volatile")]),v._v(" æ˜¯ JVM æä¾›çš„ "),t("strong",[v._v("æœ€è½»é‡çº§çš„åŒæ­¥æœºåˆ¶")]),v._v("ã€‚")]),v._v(" "),t("p",[t("code",[v._v("volatile")]),v._v(" çš„ä¸­æ–‡æ„æ€æ˜¯ä¸ç¨³å®šçš„ï¼Œæ˜“å˜çš„ï¼Œç”¨ "),t("code",[v._v("volatile")]),v._v(" ä¿®é¥°å˜é‡æ˜¯ä¸ºäº†ä¿è¯å˜é‡åœ¨å¤šçº¿ç¨‹ä¸­çš„å¯è§æ€§ã€‚")]),v._v(" "),t("h4",{attrs:{id:"volatile-å˜é‡çš„ç‰¹æ€§"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#volatile-å˜é‡çš„ç‰¹æ€§"}},[v._v("#")]),v._v(" volatile å˜é‡çš„ç‰¹æ€§")]),v._v(" "),t("p",[t("code",[v._v("volatile")]),v._v(" å˜é‡å…·æœ‰ä¸¤ç§ç‰¹æ€§ï¼š")]),v._v(" "),t("ul",[t("li",[v._v("ä¿è¯å˜é‡å¯¹æ‰€æœ‰çº¿ç¨‹çš„å¯è§æ€§ã€‚")]),v._v(" "),t("li",[v._v("ç¦æ­¢è¿›è¡ŒæŒ‡ä»¤é‡æ’åº")])]),v._v(" "),t("h5",{attrs:{id:"ä¿è¯å˜é‡å¯¹æ‰€æœ‰çº¿ç¨‹çš„å¯è§æ€§"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¿è¯å˜é‡å¯¹æ‰€æœ‰çº¿ç¨‹çš„å¯è§æ€§"}},[v._v("#")]),v._v(" ä¿è¯å˜é‡å¯¹æ‰€æœ‰çº¿ç¨‹çš„å¯è§æ€§")]),v._v(" "),t("p",[v._v("è¿™é‡Œçš„å¯è§æ€§æ˜¯æŒ‡å½“ä¸€æ¡çº¿ç¨‹ä¿®æ”¹äº† volatile å˜é‡çš„å€¼ï¼Œæ–°å€¼å¯¹äºå…¶ä»–çº¿ç¨‹æ¥è¯´æ˜¯å¯ä»¥ç«‹å³å¾—çŸ¥çš„ã€‚è€Œæ™®é€šå˜é‡ä¸èƒ½åšåˆ°è¿™ä¸€ç‚¹ï¼Œæ™®é€šå˜é‡çš„å€¼åœ¨çº¿ç¨‹é—´ä¼ é€’å‡éœ€è¦é€šè¿‡ä¸»å†…å­˜æ¥å®Œæˆã€‚")]),v._v(" "),t("p",[t("strong",[v._v("çº¿ç¨‹å†™ volatile å˜é‡çš„è¿‡ç¨‹ï¼š")])]),v._v(" "),t("ol",[t("li",[v._v("æ”¹å˜çº¿ç¨‹å·¥ä½œå†…å­˜ä¸­ volatile å˜é‡å‰¯æœ¬çš„å€¼")]),v._v(" "),t("li",[v._v("å°†æ”¹å˜åçš„å‰¯æœ¬çš„å€¼ä»å·¥ä½œå†…å­˜åˆ·æ–°åˆ°ä¸»å†…å­˜")])]),v._v(" "),t("p",[t("strong",[v._v("çº¿ç¨‹è¯» volatile å˜é‡çš„è¿‡ç¨‹ï¼š")])]),v._v(" "),t("ol",[t("li",[v._v("ä»ä¸»å†…å­˜ä¸­è¯»å– volatile å˜é‡çš„æœ€æ–°å€¼åˆ°çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­")]),v._v(" "),t("li",[v._v("ä»å·¥ä½œå†…å­˜ä¸­è¯»å– volatile å˜é‡çš„å‰¯æœ¬")])]),v._v(" "),t("blockquote",[t("p",[v._v("æ³¨æ„ï¼š"),t("strong",[v._v("ä¿è¯å¯è§æ€§ä¸ç­‰åŒäº volatile å˜é‡ä¿è¯å¹¶å‘æ“ä½œçš„å®‰å…¨æ€§")])]),v._v(" "),t("p",[v._v("åœ¨ä¸ç¬¦åˆä»¥ä¸‹ä¸¤ç‚¹çš„åœºæ™¯ä¸­ï¼Œä»ç„¶è¦é€šè¿‡æ·é”æ¥ä¿è¯åŸå­æ€§ï¼š")]),v._v(" "),t("ul",[t("li",[v._v("è¿ç®—ç»“æœå¹¶ä¸ä¾èµ–å˜é‡çš„å½“å‰å€¼ï¼Œæˆ–è€…èƒ½å¤Ÿç¡®ä¿åªæœ‰å•ä¸€çš„çº¿ç¨‹ä¿®æ”¹å˜é‡çš„å€¼ã€‚")]),v._v(" "),t("li",[v._v("å˜é‡ä¸éœ€è¦ä¸å…¶ä»–çŠ¶æ€å˜é‡å…±åŒå‚ä¸ä¸å˜çº¦æŸã€‚")])])]),v._v(" "),t("p",[v._v("ä½†æ˜¯å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶æŠŠæ›´æ–°åçš„å˜é‡å€¼åŒæ—¶åˆ·æ–°å›ä¸»å†…å­˜ï¼Œå¯èƒ½å¯¼è‡´å¾—åˆ°çš„å€¼ä¸æ˜¯é¢„æœŸç»“æœï¼š")]),v._v(" "),t("p",[v._v("ä¸¾ä¸ªä¾‹å­ï¼š å®šä¹‰ "),t("code",[v._v("volatile int count = 0")]),v._v("ï¼Œ2 ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œ count++ æ“ä½œï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æ‰§è¡Œ 500 æ¬¡ï¼Œæœ€ç»ˆç»“æœå°äº 1000ï¼ŒåŸå› æ˜¯æ¯ä¸ªçº¿ç¨‹æ‰§è¡Œ count++ éœ€è¦ä»¥ä¸‹ 3 ä¸ªæ­¥éª¤ï¼š")]),v._v(" "),t("ol",[t("li",[v._v("çº¿ç¨‹ä»ä¸»å†…å­˜è¯»å–æœ€æ–°çš„ count çš„å€¼")]),v._v(" "),t("li",[v._v("æ‰§è¡Œå¼•æ“æŠŠ count å€¼åŠ  1ï¼Œå¹¶èµ‹å€¼ç»™çº¿ç¨‹å·¥ä½œå†…å­˜")]),v._v(" "),t("li",[v._v("çº¿ç¨‹å·¥ä½œå†…å­˜æŠŠ count å€¼ä¿å­˜åˆ°ä¸»å†…å­˜ æœ‰å¯èƒ½æŸä¸€æ—¶åˆ» 2 ä¸ªçº¿ç¨‹åœ¨æ­¥éª¤ 1 è¯»å–åˆ°çš„å€¼éƒ½æ˜¯ 100ï¼Œæ‰§è¡Œå®Œæ­¥éª¤ 2 å¾—åˆ°çš„å€¼éƒ½æ˜¯ 101ï¼Œæœ€ååˆ·æ–°äº† 2 æ¬¡ 101 ä¿å­˜åˆ°ä¸»å†…å­˜ã€‚")])]),v._v(" "),t("h5",{attrs:{id:"è¯­ä¹‰-2-ç¦æ­¢è¿›è¡ŒæŒ‡ä»¤é‡æ’åº"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è¯­ä¹‰-2-ç¦æ­¢è¿›è¡ŒæŒ‡ä»¤é‡æ’åº"}},[v._v("#")]),v._v(" è¯­ä¹‰ 2 ç¦æ­¢è¿›è¡ŒæŒ‡ä»¤é‡æ’åº")]),v._v(" "),t("p",[v._v("å…·ä½“ä¸€ç‚¹è§£é‡Šï¼Œç¦æ­¢é‡æ’åºçš„è§„åˆ™å¦‚ä¸‹ï¼š")]),v._v(" "),t("ul",[t("li",[v._v("å½“ç¨‹åºæ‰§è¡Œåˆ° "),t("code",[v._v("volatile")]),v._v(" å˜é‡çš„è¯»æ“ä½œæˆ–è€…å†™æ“ä½œæ—¶ï¼Œåœ¨å…¶å‰é¢çš„æ“ä½œçš„æ›´æ”¹è‚¯å®šå…¨éƒ¨å·²ç»è¿›è¡Œï¼Œä¸”ç»“æœå·²ç»å¯¹åé¢çš„æ“ä½œå¯è§ï¼›åœ¨å…¶åé¢çš„æ“ä½œè‚¯å®šè¿˜æ²¡æœ‰è¿›è¡Œï¼›")]),v._v(" "),t("li",[v._v("åœ¨è¿›è¡ŒæŒ‡ä»¤ä¼˜åŒ–æ—¶ï¼Œä¸èƒ½å°†åœ¨å¯¹ "),t("code",[v._v("volatile")]),v._v(" å˜é‡è®¿é—®çš„è¯­å¥æ”¾åœ¨å…¶åé¢æ‰§è¡Œï¼Œä¹Ÿä¸èƒ½æŠŠ "),t("code",[v._v("volatile")]),v._v(" å˜é‡åé¢çš„è¯­å¥æ”¾åˆ°å…¶å‰é¢æ‰§è¡Œã€‚")])]),v._v(" "),t("p",[v._v("æ™®é€šçš„å˜é‡ä»…ä»…ä¼šä¿è¯è¯¥æ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰€æœ‰ä¾èµ–èµ‹å€¼ç»“æœçš„åœ°æ–¹éƒ½èƒ½è·å–åˆ°æ­£ç¡®çš„ç»“æœï¼Œè€Œä¸èƒ½ä¿è¯èµ‹å€¼æ“ä½œçš„é¡ºåºä¸ç¨‹åºä»£ç ä¸­çš„æ‰§è¡Œé¡ºåºä¸€è‡´ã€‚")]),v._v(" "),t("p",[v._v("ä¸¾ä¸ªä¾‹å­ï¼š")]),v._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[v._v("volatile")]),v._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[v._v("boolean")]),v._v(" initialized "),t("span",{pre:!0,attrs:{class:"token operator"}},[v._v("=")]),v._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[v._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(";")]),v._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[v._v("// ä¸‹é¢ä»£ç çº¿ç¨‹Aä¸­æ‰§è¡Œ")]),v._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[v._v("// è¯»å–é…ç½®ä¿¡æ¯ï¼Œå½“è¯»å–å®Œæˆåå°†initializedè®¾ç½®ä¸ºtrueä»¥é€šçŸ¥å…¶ä»–çº¿ç¨‹é…ç½®å¯ç”¨")]),v._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[v._v("doSomethingReadConfg")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(";")]),v._v("\ninitialized "),t("span",{pre:!0,attrs:{class:"token operator"}},[v._v("=")]),v._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[v._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(";")]),v._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[v._v("// ä¸‹é¢ä»£ç çº¿ç¨‹Bä¸­æ‰§è¡Œ")]),v._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[v._v("// ç­‰å¾…initialized ä¸ºtrueï¼Œä»£è¡¨çº¿ç¨‹Aå·²ç»æŠŠé…ç½®ä¿¡æ¯åˆå§‹åŒ–å®Œæˆ")]),v._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[v._v("while")]),v._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[v._v("!")]),v._v("initialized"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(")")]),v._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v("{")]),v._v("\n     "),t("span",{pre:!0,attrs:{class:"token function"}},[v._v("sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(";")]),v._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v("}")]),v._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[v._v("// ä½¿ç”¨çº¿ç¨‹Aåˆå§‹åŒ–å¥½çš„é…ç½®ä¿¡æ¯")]),v._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[v._v("doSomethingWithConfig")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(";")]),v._v("\nå¤åˆ¶ä»£ç \n")])])]),t("p",[v._v('ä¸Šé¢ä»£ç ä¸­å¦‚æœå®šä¹‰ initialized å˜é‡æ—¶æ²¡æœ‰ä½¿ç”¨ volatile ä¿®é¥°ï¼Œå°±æœ‰å¯èƒ½ä¼šç”±äºæŒ‡ä»¤é‡æ’åºçš„ä¼˜åŒ–ï¼Œå¯¼è‡´çº¿ç¨‹ A ä¸­æœ€åä¸€å¥ä»£ç  "initialized = true" åœ¨ â€œdoSomethingReadConfg()â€ ä¹‹å‰è¢«æ‰§è¡Œï¼Œè¿™æ ·ä¼šå¯¼è‡´çº¿ç¨‹ B ä¸­ä½¿ç”¨é…ç½®ä¿¡æ¯çš„ä»£ç å°±å¯èƒ½å‡ºç°é”™è¯¯ï¼Œè€Œ volatile å…³é”®å­—å°±ç¦æ­¢é‡æ’åºçš„è¯­ä¹‰å¯ä»¥é¿å…æ­¤ç±»æƒ…å†µå‘ç”Ÿã€‚')]),v._v(" "),t("h4",{attrs:{id:"volatile-çš„åŸç†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#volatile-çš„åŸç†"}},[v._v("#")]),v._v(" volatile çš„åŸç†")]),v._v(" "),t("p",[v._v("å…·ä½“å®ç°æ–¹å¼æ˜¯åœ¨ç¼–è¯‘æœŸç”Ÿæˆå­—èŠ‚ç æ—¶ï¼Œä¼šåœ¨æŒ‡ä»¤åºåˆ—ä¸­å¢åŠ å†…å­˜å±éšœæ¥ä¿è¯ï¼Œä¸‹é¢æ˜¯åŸºäºä¿å®ˆç­–ç•¥çš„ JMM å†…å­˜å±éšœæ’å…¥ç­–ç•¥ï¼š")]),v._v(" "),t("ul",[t("li",[v._v("åœ¨æ¯ä¸ª volatile å†™æ“ä½œçš„å‰é¢æ’å…¥ä¸€ä¸ª StoreStore å±éšœã€‚ è¯¥å±éšœé™¤äº†ä¿è¯äº†å±éšœä¹‹å‰çš„å†™æ“ä½œå’Œè¯¥å±éšœä¹‹åçš„å†™æ“ä½œä¸èƒ½é‡æ’åºï¼Œè¿˜ä¼šä¿è¯äº† volatile å†™æ“ä½œä¹‹å‰ï¼Œä»»ä½•çš„è¯»å†™æ“ä½œéƒ½ä¼šå…ˆäº volatile è¢«æäº¤ã€‚")]),v._v(" "),t("li",[v._v("åœ¨æ¯ä¸ª volatile å†™æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ª StoreLoad å±éšœã€‚ è¯¥å±éšœé™¤äº†ä½¿ volatile å†™æ“ä½œä¸ä¼šä¸ä¹‹åçš„è¯»æ“ä½œé‡æ’åºå¤–ï¼Œè¿˜ä¼šåˆ·æ–°å¤„ç†å™¨ç¼“å­˜ï¼Œä½¿ volatile å˜é‡çš„å†™æ›´æ–°å¯¹å…¶ä»–çº¿ç¨‹å¯è§ã€‚")]),v._v(" "),t("li",[v._v("åœ¨æ¯ä¸ª volatile è¯»æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ª LoadLoad å±éšœã€‚ è¯¥å±éšœé™¤äº†ä½¿ volatile è¯»æ“ä½œä¸ä¼šä¸ä¹‹å‰çš„å†™æ“ä½œå‘ç”Ÿé‡æ’åºå¤–ï¼Œè¿˜ä¼šåˆ·æ–°å¤„ç†å™¨ç¼“å­˜ï¼Œä½¿ volatile å˜é‡è¯»å–çš„ä¸ºæœ€æ–°å€¼ã€‚")]),v._v(" "),t("li",[v._v("åœ¨æ¯ä¸ª volatile è¯»æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ª LoadStore å±éšœã€‚ è¯¥å±éšœé™¤äº†ç¦æ­¢äº† volatile è¯»æ“ä½œä¸å…¶ä¹‹åçš„ä»»ä½•å†™æ“ä½œè¿›è¡Œé‡æ’åºï¼Œè¿˜ä¼šåˆ·æ–°å¤„ç†å™¨ç¼“å­˜ï¼Œä½¿å…¶ä»–çº¿ç¨‹ volatile å˜é‡çš„å†™æ›´æ–°å¯¹ volatile è¯»æ“ä½œçš„çº¿ç¨‹å¯è§ã€‚")])]),v._v(" "),t("h4",{attrs:{id:"volatile-çš„ä½¿ç”¨åœºæ™¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#volatile-çš„ä½¿ç”¨åœºæ™¯"}},[v._v("#")]),v._v(" volatile çš„ä½¿ç”¨åœºæ™¯")]),v._v(" "),t("p",[v._v("æ€»ç»“èµ·æ¥ï¼Œå°±æ˜¯â€œä¸€æ¬¡å†™å…¥ï¼Œåˆ°å¤„è¯»å–â€ï¼ŒæŸä¸€çº¿ç¨‹è´Ÿè´£æ›´æ–°å˜é‡ï¼Œå…¶ä»–çº¿ç¨‹åªè¯»å–å˜é‡(ä¸æ›´æ–°å˜é‡)ï¼Œå¹¶æ ¹æ®å˜é‡çš„æ–°å€¼æ‰§è¡Œç›¸åº”é€»è¾‘ã€‚ä¾‹å¦‚çŠ¶æ€æ ‡å¿—ä½æ›´æ–°ï¼Œè§‚å¯Ÿè€…æ¨¡å‹å˜é‡å€¼å‘å¸ƒã€‚")]),v._v(" "),t("h2",{attrs:{id:"_6-synchronized"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-synchronized"}},[v._v("#")]),v._v(" 6. synchronized")]),v._v(" "),t("h3",{attrs:{id:"_6-1-long-å’Œ-double-å˜é‡çš„ç‰¹æ®Šè§„åˆ™"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-long-å’Œ-double-å˜é‡çš„ç‰¹æ®Šè§„åˆ™"}},[v._v("#")]),v._v(" 6.1. long å’Œ double å˜é‡çš„ç‰¹æ®Šè§„åˆ™")]),v._v(" "),t("p",[v._v("JMM è¦æ±‚ lockã€unlockã€readã€loadã€assignã€useã€storeã€write è¿™ 8 ç§æ“ä½œéƒ½å…·æœ‰åŸå­æ€§ï¼Œä½†æ˜¯å¯¹äº 64 ä½çš„æ•°æ®ç±»å‹ï¼ˆlong å’Œ doubleï¼‰ï¼Œåœ¨æ¨¡å‹ä¸­ç‰¹åˆ«å®šä¹‰ç›¸å¯¹å®½æ¾çš„è§„å®šï¼šå…è®¸è™šæ‹Ÿæœºå°†æ²¡æœ‰è¢« "),t("code",[v._v("volatile")]),v._v(" ä¿®é¥°çš„ 64 ä½æ•°æ®çš„è¯»å†™æ“ä½œåˆ†ä¸º 2 æ¬¡ 32 ä½çš„æ“ä½œæ¥è¿›è¡Œï¼Œå³å…è®¸è™šæ‹Ÿæœºå¯é€‰æ‹©ä¸ä¿è¯ 64 ä½æ•°æ®ç±»å‹çš„ loadã€storeã€read å’Œ write è¿™ 4 ä¸ªæ“ä½œçš„åŸå­æ€§ã€‚ç”±äºè¿™ç§éåŸå­æ€§ï¼Œæœ‰å¯èƒ½å¯¼è‡´å…¶ä»–çº¿ç¨‹è¯»åˆ°åŒæ­¥æœªå®Œæˆçš„â€œ32 ä½çš„åŠä¸ªå˜é‡â€çš„å€¼ã€‚")]),v._v(" "),t("p",[v._v("ä¸è¿‡å®é™…å¼€å‘ä¸­ï¼ŒJava å†…å­˜æ¨¡å‹å¼ºçƒˆå»ºè®®è™šæ‹ŸæœºæŠŠ 64 ä½æ•°æ®çš„è¯»å†™å®ç°ä¸ºå…·æœ‰åŸå­æ€§ï¼Œç›®å‰å„ç§å¹³å°ä¸‹çš„å•†ç”¨è™šæ‹Ÿæœºéƒ½é€‰æ‹©æŠŠ 64 ä½æ•°æ®çš„è¯»å†™æ“ä½œä½œä¸ºåŸå­æ“ä½œæ¥å¯¹å¾…ï¼Œå› æ­¤æˆ‘ä»¬åœ¨ç¼–å†™ä»£ç æ—¶ä¸€èˆ¬ä¸éœ€è¦æŠŠç”¨åˆ°çš„ long å’Œ double å˜é‡ä¸“é—¨å£°æ˜ä¸º volatileã€‚")]),v._v(" "),t("h3",{attrs:{id:"_6-2-final-å‹é‡çš„ç‰¹æ®Šè§„åˆ™"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-final-å‹é‡çš„ç‰¹æ®Šè§„åˆ™"}},[v._v("#")]),v._v(" 6.2. final å‹é‡çš„ç‰¹æ®Šè§„åˆ™")]),v._v(" "),t("p",[v._v("æˆ‘ä»¬çŸ¥é“ï¼Œfinal æˆå‘˜å˜é‡å¿…é¡»åœ¨å£°æ˜çš„æ—¶å€™åˆå§‹åŒ–æˆ–è€…åœ¨æ„é€ å™¨ä¸­åˆå§‹åŒ–ï¼Œå¦åˆ™å°±ä¼šæŠ¥ç¼–è¯‘é”™è¯¯ã€‚ final å…³é”®å­—çš„å¯è§æ€§æ˜¯æŒ‡ï¼šè¢« final ä¿®é¥°çš„å­—æ®µåœ¨å£°æ˜æ—¶æˆ–è€…æ„é€ å™¨ä¸­ï¼Œä¸€æ—¦åˆå§‹åŒ–å®Œæˆï¼Œé‚£ä¹ˆåœ¨å…¶ä»–çº¿ç¨‹æ— é¡»åŒæ­¥å°±èƒ½æ­£ç¡®çœ‹è§ final å­—æ®µçš„å€¼ã€‚è¿™æ˜¯å› ä¸ºä¸€æ—¦åˆå§‹åŒ–å®Œæˆï¼Œfinal å˜é‡çš„å€¼ç«‹åˆ»å›å†™åˆ°ä¸»å†…å­˜ã€‚")]),v._v(" "),t("h2",{attrs:{id:"_7-å‚è€ƒèµ„æ–™"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-å‚è€ƒèµ„æ–™"}},[v._v("#")]),v._v(" 7. å‚è€ƒèµ„æ–™")]),v._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://book.douban.com/subject/10484692/",target:"_blank",rel:"noopener noreferrer"}},[v._v("ã€ŠJava å¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹"),t("OutboundLink")],1)]),v._v(" "),t("li",[t("a",{attrs:{href:"https://book.douban.com/subject/26591326/",target:"_blank",rel:"noopener noreferrer"}},[v._v("ã€ŠJava å¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹"),t("OutboundLink")],1)]),v._v(" "),t("li",[t("a",{attrs:{href:"https://book.douban.com/subject/34907497/",target:"_blank",rel:"noopener noreferrer"}},[v._v("ã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºã€‹"),t("OutboundLink")],1)]),v._v(" "),t("li",[t("a",{attrs:{href:"https://juejin.im/post/5bf2977751882505d840321d",target:"_blank",rel:"noopener noreferrer"}},[v._v("ç†è§£ Java å†…å­˜æ¨¡å‹"),t("OutboundLink")],1)]),v._v(" "),t("li",[t("a",{attrs:{href:"https://time.geekbang.org/column/intro/100023901",target:"_blank",rel:"noopener noreferrer"}},[v._v("ã€ŠJava å¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);_.default=e.exports}}]);